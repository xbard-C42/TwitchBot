
<!-- saved from url=(0068)https://ai-overlord-bot-control-panel-770800897695.us-west1.run.app/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>
  @import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
  html {
    font-family: 'Google Sans Text', 'Google Sans';
    font-size: 14px;
    color-scheme: light dark;
    background: light-dark(white, black);
    color: light-dark(black, white);
  }
</style>
<style>
/* Basic Reset */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
  line-height: 1.6;
  background: linear-gradient(135deg, #121417 0%, #202329 100%); /* Dark gradient for depth */
  color: #e0e0e0; /* Light text */
  padding: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  background: rgba(30, 33, 40, 0.5); /* Darker glass base */
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
  padding: 15px 25px;
  text-align: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Subtle light border */
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  position: sticky; /* Keep header visible */
  top: 0;
  z-index: 100;
}

header h1 {
  color: #ffffff;
  font-size: 1.8em;
  font-weight: 500;
  letter-spacing: 1px;
}

.status-bar {
  background: rgba(25, 28, 34, 0.45); /* Slightly different glass for status */
  backdrop-filter: blur(10px) saturate(150%);
  -webkit-backdrop-filter: blur(10px) saturate(150%);
  padding: 10px 25px;
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  gap: 15px;
  font-size: 0.9em;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  position: sticky; /* Keep status bar visible */
  top: /* height of header, e.g., 60px - adjust if header padding changes */ 67px; 
  z-index: 99;
}

.status-bar span {
  color: #b0b0b0;
}

.status-bar strong {
  font-weight: 500;
  margin-left: 5px;
}

.status-online {
  color: #50fa7b; /* Brighter green */
}

.status-offline {
  color: #ff5555; /* Brighter red */
}

.status-vad-active {
  color: #ffb86c; /* Brighter orange */
  font-weight: bold;
}
.status-vad-inactive {
  color: #9e9e9e; 
}


.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
  gap: 20px;
  padding: 25px;
  flex-grow: 1;
}

.dashboard-module {
  background: rgba(255, 255, 255, 0.05); /* Core glass effect: light base, low opacity */
  backdrop-filter: blur(10px) saturate(180%);
  -webkit-backdrop-filter: blur(10px) saturate(180%);
  padding: 20px;
  border-radius: 12px; /* Slightly more rounded */
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25); /* Softer, more diffused shadow */
  border: 1px solid rgba(255, 255, 255, 0.125); /* Subtle light border */
  display: flex;
  flex-direction: column;
}

.dashboard-module h2 {
  font-size: 1.3em;
  color: #8be9fd; /* Cyan accent */
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  font-weight: 500;
}
.dashboard-module h3 {
  font-size: 1.1em;
  color: #f8f8f2; /* Brighter heading text */
  margin-top: 15px;
  margin-bottom: 8px;
  font-weight: 400;
}


.module-controls {
  margin-bottom: 15px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}
.module-controls p {
    margin-left: auto; 
}
#voice-log-module .module-controls p { 
    margin-left: 15px;
}


.control-button {
  background: linear-gradient(145deg, rgba(80, 250, 123, 0.2), rgba(142, 233, 253, 0.2)); /* Gradient with transparency */
  color: #f8f8f2;
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 0.95em;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
  font-weight: 500;
  min-height: 38px; 
  display: inline-flex; 
  align-items: center; 
  justify-content: center;
  text-align: center; 
  line-height: 1.2; 
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.control-button:hover:not(:disabled) {
  background: linear-gradient(145deg, rgba(80, 250, 123, 0.3), rgba(142, 233, 253, 0.3));
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transform: translateY(-1px);
}
.control-button:active:not(:disabled) {
  transform: translateY(0px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.control-button:disabled {
  background: rgba(100, 100, 100, 0.2);
  border-color: rgba(255,255,255,0.1);
  color: #aaa;
  cursor: not-allowed;
  opacity: 0.7;
}

.control-input, 
#ai-model-select,
.form-group input[type="text"], 
.form-group select,
.config-editor-textarea { /* Added textarea here */
  background: rgba(0, 0, 0, 0.25); /* Darker semi-transparent for inputs */
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #e0e0e0;
  padding: 8px 10px;
  border-radius: 8px;
  font-size: 0.95em;
  min-height: 38px; 
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
.control-input:focus,
#ai-model-select:focus,
.form-group input[type="text"]:focus, 
.form-group select:focus,
.config-editor-textarea:focus {
  outline: none;
  border-color: rgba(139, 233, 253, 0.7); /* Cyan focus */
  box-shadow: 0 0 0 2px rgba(139, 233, 253, 0.2);
}


.module-info p, .module-info code {
  margin-bottom: 8px;
  font-size: 0.95em;
  color: #c0c0c0;
}
.module-info code, .module-info strong { 
  background-color: rgba(0,0,0,0.2);
  padding: 3px 6px;
  border-radius: 5px;
  color: #ffb86c; /* Orange for code */
  font-family: 'Courier New', Courier, monospace;
  border: 1px solid rgba(255,255,255,0.05);
}
.module-info strong { 
    color: #8be9fd; 
    background-color: transparent;
    font-weight: bold;
}
#loyalty-user-details-display p strong {
    background-color: rgba(0,0,0,0.2); 
    border: 1px solid rgba(255,255,255,0.05);
}


#qs-ai-personality-prompt {
  white-space: pre-wrap; 
  max-height: 70px; 
  overflow-y: auto; 
  display: block; 
  background-color: rgba(0,0,0,0.2);
  padding: 8px;
  border-radius: 5px;
  border: 1px solid rgba(255,255,255,0.1);
  font-family: 'Courier New', Courier, monospace;
  color: #bd93f9; /* Purple for this specific code block */
}


.grid-display {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 8px;
}

.log-output, .list-output, .code-display {
  background-color: rgba(0, 0, 0, 0.3); /* Darker for logs, more depth */
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 8px;
  padding: 10px;
  height: 150px; 
  overflow-y: auto;
  font-size: 0.85em;
  flex-grow: 1; 
}
.list-output {
    padding-left: 0; 
}
.list-output li {
    margin-bottom: 5px;
    padding: 6px 12px; 
    list-style-type: none; 
    border-bottom: 1px solid rgba(255,255,255,0.07);
}
.list-output li:last-child {
    border-bottom: none;
}

.log-output .log-placeholder, .list-output .log-placeholder {
    color: #777;
    font-style: italic;
    text-align: center;
    padding-top: 20px;
}
.list-output .log-placeholder::before {
    content: ""; 
}


.log-entry {
  margin-bottom: 5px;
  padding: 3px 0;
  border-bottom: 1px dashed rgba(255,255,255,0.07);
}
.log-entry:last-child {
  border-bottom: none;
}
.log-entry .timestamp {
  color: #aaa;
  margin-right: 8px;
}
.log-entry .log-message strong { 
    color: #8be9fd; /* Cyan */
}
.log-entry.log-success .log-message { color: #50fa7b; }
.log-entry.log-error .log-message { color: #ff5555; }
.log-entry.log-info .log-message { color: #8be9fd; }


.code-display { 
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.9em;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: #50fa7b; /* Green for code output */
  min-height: 50px;
}

.form-group {
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
}
.form-group label {
  margin-bottom: 5px;
  font-size: 0.9em;
  color: #bbb;
}

.form-group .control-button {
    align-self: flex-start;
}

.form-group > .control-input + .control-button {
    margin-top: 8px;
}
.form-group > input[type="text"] + .control-button,
.form-group > textarea + .control-button { 
    width: 100%;
}


#decrees-loyalty-module .form-group { 
    margin-bottom: 10px;
}
#decrees-loyalty-module .control-button { 
    margin-top: 5px; 
}

#suggest-decree-button {
    background: linear-gradient(145deg, rgba(189, 147, 249, 0.2), rgba(255, 121, 198, 0.2)); /* Purple/Pink gradient */
    border-color: rgba(255,255,255,0.25);
}
#suggest-decree-button:hover:not(:disabled) {
    background: linear-gradient(145deg, rgba(189, 147, 249, 0.3), rgba(255, 121, 198, 0.3));
}

#decree-suggestions-area {
    background-color: rgba(0,0,0, 0.2); 
    border: 1px dashed rgba(139, 233, 253, 0.5); /* Cyan dashed border */
    padding: 10px;
    border-radius: 8px;
}
#decree-suggestions-area ul {
    list-style-type: none;
    padding-left: 0;
}
#decree-suggestions-area li {
    padding: 6px 0px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    color: #d0d0d0;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
}
#decree-suggestions-area li:hover {
    background-color: rgba(139, 233, 253, 0.1);
    color: #8be9fd;
}
#decree-suggestions-area li:last-child {
    border-bottom: none;
}


#chat-module .form-group { 
    margin-top: auto; 
    padding-top: 15px;
    border-top: 1px solid rgba(255,255,255,0.1);
}

.module-status-message {
    font-size: 0.85em;
    color: #50fa7b; 
    margin-top: 8px;
    min-height: 1.2em; 
}
.module-status-message.error {
    color: #ff5555; 
}
.module-status-message.info {
    color: #8be9fd; 
}


.button-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
    gap: 8px;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

footer {
  text-align: center;
  padding: 15px;
  background: rgba(30, 33, 40, 0.6); /* Consistent with header style */
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  font-size: 0.85em;
  color: #999;
}

/* Specific command list item styling */
#available-commands-list li {
    padding: 8px 10px; 
}
#available-commands-list .command-trigger {
    font-weight: bold;
    color: #8be9fd; 
    display: block; 
    margin-bottom: 3px;
}
#available-commands-list .command-description {
    font-size: 0.9em;
    color: #bbb;
    display: block;
    margin-left: 10px; 
    margin-bottom: 3px;
}
#available-commands-list .command-aliases {
    font-size: 0.85em;
    color: #999;
    display: block;
    margin-left: 10px; 
    font-style: italic;
    margin-bottom: 3px;
}
#available-commands-list .command-details {
    font-size: 0.85em;
    color: #aaa;
    display: block;
    margin-left: 10px;
    margin-bottom: 3px;
}
#available-commands-list .command-detail-label {
    font-weight: 500;
    color: #ccc;
}
#available-commands-list .command-detail-value {
    color: #eee; 
}
#available-commands-list .command-parameters {
    font-size: 0.85em;
    color: #aaa;
    display: block;
    margin-left: 10px;
}
#available-commands-list .parameter-name {
    font-style: italic;
    color: #8be9fd; 
}
#available-commands-list .parameter-type {
    color: #ffb86c; 
}


hr.separator {
    border: none;
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    margin: 10px 0;
}

/* Styles for Config Editor - uses .control-input styles now */
.config-editor-textarea {
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.9em;
    resize: vertical; 
    min-height: 200px; 
    color: #f8f8f2; /* Ensure light text for editor content */
}

.config-editor-status {
    font-size: 0.85em;
    color: #50fa7b; 
    margin-top: 8px;
    min-height: 1.2em;
}
.config-editor-status.error {
    color: #ff5555;
}
.config-editor-status.info {
    color: #8be9fd;
}


/* Tooltip Styles */
.tooltip-trigger {
  cursor: help;
  position: relative;
  display: inline-block;
  margin-left: 4px;
  color: #8be9fd; 
}

.tooltip-trigger::before,
.tooltip-trigger::after {
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
  position: absolute;
  z-index: 1000;
  pointer-events: none; 
}

.tooltip-trigger::before { /* Arrow */
  content: '';
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 6px 6px 0 6px; 
  border-color: rgba(30, 30, 30, 0.7) transparent transparent transparent; 
  bottom: 100%; 
  left: 50%;
  transform: translateX(-50%) translateY(-2px); 
}

.tooltip-trigger::after { /* Text box */
  content: attr(data-tooltip); 
  background: rgba(30, 30, 30, 0.7); 
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  color: #e0e0e0; 
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 0.85em;
  line-height: 1.4;
  width: max-content; 
  max-width: 250px; 
  bottom: 100%; 
  left: 50%;
  transform: translateX(-50%) translateY(-8px); 
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.1);
}

.tooltip-trigger:hover::before,
.tooltip-trigger:hover::after {
  visibility: visible;
  opacity: 1;
}

/* Key Status Styling */
.key-status-set {
    color: #50fa7b; /* Bright Green */
    font-weight: bold;
}
.key-status-not-set {
    color: #ffb86c; /* Orange/Amber */
    font-weight: bold;
}
.key-status-optional-not-set {
    color: #9e9e9e; 
    font-style: italic;
}

/* Setup Checklist Styles */
#setup-checklist-list li {
    padding: 6px 10px;
    font-size: 0.9em;
    color: #c0c0c0;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    position: relative; 
    padding-left: 25px; 
}
#setup-checklist-list li::before {
    content: "âž”"; 
    position: absolute;
    left: 8px;
    top: 6px;
    color: #8be9fd; 
    font-size: 0.9em;
}

#setup-checklist-list li:last-child {
    border-bottom: none;
}
#setup-checklist-list li code {
    background-color: rgba(0,0,0,0.15); 
    color: #ffb86c; 
    padding: 1px 4px;
    border-radius: 3px;
    font-family: 'Courier New', Courier, monospace;
}

/* Scrollbar styling for a more modern look */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 10px;
}
::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}
::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Ensure consistent font for all input like elements */
select, input, textarea, button {
    font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
}</style>
<script type="importmap">{"imports":{"@modelcontextprotocol/sdk/":"https://esm.sh/@modelcontextprotocol/sdk/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/client/index?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/client/index?target=es2022","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/types?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/types?target=es2022","@google/genai":"https://esm.sh/@google/genai@^1.4.0","marked":"https://esm.sh/marked@^15.0.12","path":"https://esm.sh/path@^0.12.7","vite":"https://esm.sh/vite@^6.3.5","@/index":"data:application/javascript;base64,LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDI1IEdvb2dsZSBMTEMKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAKICovCmltcG9ydCB7IEdvb2dsZUdlbkFJIH0gZnJvbSAiQGdvb2dsZS9nZW5haSI7Ci8vIC0tLSBET00gRWxlbWVudCBSZWZlcmVuY2VzIC0tLQovLyBTdGF0dXMgQmFyCmNvbnN0IGJvdFN0YXR1c0luZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3Qtc3RhdHVzLWluZGljYXRvcicpOwpjb25zdCB0d2l0Y2hTdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHdpdGNoLXN0YXR1cy1pbmRpY2F0b3InKTsKY29uc3Qgc3RyZWFtZXJib3RTdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtZXJib3Qtc3RhdHVzLWluZGljYXRvcicpOwpjb25zdCBsbm1TdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG5tLXN0YXR1cy1pbmRpY2F0b3InKTsKLy8gQm90IENvbnRyb2wKY29uc3QgdG9nZ2xlQm90QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1ib3QtYnV0dG9uJyk7CmNvbnN0IGN5Y2xlTW9vZEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjeWNsZS1tb29kLWJ1dHRvbicpOwpjb25zdCByZXF1ZXN0U3RhdHVzUmVwb3J0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcXVlc3Qtc3RhdHVzLXJlcG9ydC1idXR0b24nKTsKY29uc3QgYWlNb2RlbFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaS1tb2RlbC1zZWxlY3QnKTsKY29uc3QgYWlNb29kRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaS1tb29kJyk7CmNvbnN0IGFpUGVyc29uYWxpdHlEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpLXBlcnNvbmFsaXR5Jyk7CmNvbnN0IG1vb2RMb2dPdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9vZC1sb2ctb3V0cHV0Jyk7CmNvbnN0IGFpRmxpZ2h0Q29udGV4dERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktZmxpZ2h0LWNvbnRleHQnKTsKY29uc3QgZmxpZ2h0Q29udGV4dEJ1dHRvbnNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxpZ2h0LWNvbnRleHQtYnV0dG9ucycpOwovLyBWb2ljZSBDb21tYW5kIENlbnRlcgpjb25zdCB0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS12b2ljZS1jb21tYW5kcy1idXR0b24nKTsKY29uc3Qgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvaWNlLXN5c3RlbS1zdGF0dXMnKTsKY29uc3QgdmFkU3RhdHVzSW5kaWNhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhZC1zdGF0dXMtaW5kaWNhdG9yJyk7CmNvbnN0IHZvaWNlTG9nT3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvaWNlLWxvZy1vdXRwdXQnKTsKLy8gVm9pY2UgU3lzdGVtIERldGFpbHMKY29uc3QgdmRzU3R0RW5naW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1zdHQtZW5naW5lJyk7CmNvbnN0IHZkc0xhbmd1YWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1sYW5ndWFnZScpOwpjb25zdCB2ZHNDb25maWRlbmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1jb25maWRlbmNlJyk7CmNvbnN0IHZkc1RpbWVvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXRpbWVvdXQnKTsKY29uc3QgdmRzUGhyYXNlTGltaXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBocmFzZS1saW1pdCcpOwpjb25zdCB2ZHNFbmVyZ3lUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLWVuZXJneS10aHJlc2hvbGQnKTsKY29uc3QgdmRzRHluYW1pY0VuZXJneSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZHMtZHluYW1pYy1lbmVyZ3knKTsKY29uc3QgdmRzUGF1c2VUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBhdXNlLXRocmVzaG9sZCcpOwpjb25zdCB2ZHNQaHJhc2VUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBocmFzZS10aHJlc2hvbGQnKTsKY29uc3QgdmRzVmFkQWdncmVzc2l2ZW5lc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXZhZC1hZ2dyZXNzaXZlbmVzcycpOwpjb25zdCB2ZHNNaWNTYW1wbGVSYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1taWMtc2FtcGxlLXJhdGUnKTsKY29uc3QgdmRzTWljQ2h1bmtTaXplID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1taWMtY2h1bmstc2l6ZScpOwpjb25zdCB0b2dnbGVUdHNCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXR0cy1idXR0b24nKTsKY29uc3QgYXZhaWxhYmxlQ29tbWFuZHNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJsZS1jb21tYW5kcy1saXN0Jyk7Ci8vIEZsaWdodCBEYXRhCmNvbnN0IGZkQ2FsbHNpZ24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtY2FsbHNpZ24nKTsKY29uc3QgZmRBaXJjcmFmdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZC1haXJjcmFmdCcpOwpjb25zdCBmZEFsdGl0dWRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWFsdGl0dWRlJyk7CmNvbnN0IGZkU3BlZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtc3BlZWQnKTsKY29uc3QgZmRIZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWhlYWRpbmcnKTsKY29uc3QgZmRWc3BlZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtdnNwZWVkJyk7CmNvbnN0IGZkUGhhc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtcGhhc2UnKTsKY29uc3QgZmROZXh0V3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtbmV4dC13cCcpOwpjb25zdCBmZEV0YU5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtZXRhLW5leHQnKTsKY29uc3QgZmRGdWVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWZ1ZWwnKTsKY29uc3QgYW5hbHl6ZUZ1ZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZS1mdWVsLWJ1dHRvbicpOwovLyBGbGlnaHQgJiBBdXRvbWF0aW9uIEluc2lnaHRzCmNvbnN0IGZhTWlsZXN0b25lQWx0aXR1ZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhLW1pbGVzdG9uZS1hbHRpdHVkZXMnKTsKY29uc3QgZmFBdXRvU2NlbmVTdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmEtYXV0by1zY2VuZS1zdGF0dXMnKTsKY29uc3QgZmFXZWF0aGVySW50ZXJ2YWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmEtd2VhdGhlci1pbnRlcnZhbCcpOwpjb25zdCBmbGlnaHRNaWxlc3RvbmVzTG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZsaWdodC1taWxlc3RvbmVzLWxvZycpOwovLyBTeXN0ZW0gSGVhbHRoICYgTWV0cmljcwpjb25zdCBtZXRyaWNzU3lzdGVtU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3Mtc3lzdGVtLXN0YXR1cycpOwpjb25zdCBtZXRyaWNzVm9pY2VRdWV1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRyaWNzLXZvaWNlLXF1ZXVlJyk7CmNvbnN0IG1ldHJpY3NMYXN0Vm9pY2VDbWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0cmljcy1sYXN0LXZvaWNlLWNtZCcpOwpjb25zdCBtZXRyaWNzRGJDb25uZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3MtZGItY29ubmVjdGlvbicpOwpjb25zdCBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3Mtc2VudHJ5LXJlcG9ydGluZycpOwovLyBDb25maWcgRWRpdG9yCmNvbnN0IGNvbmZpZ0VkaXRvclRleHRhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZy1lZGl0b3ItdGV4dGFyZWEnKTsKY29uc3QgY29uZmlnRWRpdG9yU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZy1lZGl0b3Itc3RhdHVzJyk7CmNvbnN0IGxvYWREZWZhdWx0Q29uZmlnQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWQtZGVmYXVsdC1jb25maWctYnV0dG9uJyk7CmNvbnN0IHNhdmVDb25maWdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1jb25maWctYnV0dG9uJyk7Ci8vIERpYWdub3N0aWNzICYgVGVzdGluZwpjb25zdCBkaWFnVGVzdFR3aXRjaEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRlc3QtdHdpdGNoLWJ1dHRvbicpOwpjb25zdCBkaWFnVGVzdFN0cmVhbWVyYm90QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWctdGVzdC1zdHJlYW1lcmJvdC1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RMbm1CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LWxubS1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RPcGVuYWlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LW9wZW5haS1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RUdHNCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LXR0cy1idXR0b24nKTsKY29uc3QgZGlhZ1ZvaWNlSW50ZW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy12b2ljZS1pbnRlbnQtaW5wdXQnKTsKY29uc3QgZGlhZ0NsYXNzaWZ5SW50ZW50QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWctY2xhc3NpZnktaW50ZW50LWJ1dHRvbicpOwpjb25zdCBkaWFnVHJpZ2dlckRlY3JlZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRyaWdnZXItZGVjcmVlLWJ1dHRvbicpOwpjb25zdCBkaWFnVHJpZ2dlck1pbGVzdG9uZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRyaWdnZXItbWlsZXN0b25lLWJ1dHRvbicpOwpjb25zdCBkaWFnbm9zdGljc0xvZ091dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnbm9zdGljcy1sb2ctb3V0cHV0Jyk7Ci8vIFdlYXRoZXIKY29uc3QgZmV0Y2hXZWF0aGVyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZldGNoLXdlYXRoZXItYnV0dG9uJyk7CmNvbnN0IHdlYXRoZXJEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlYXRoZXItZGlzcGxheScpOwovLyBEZWNyZWVzICYgTG95YWx0eQpjb25zdCBpc3N1ZURlY3JlZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpc3N1ZS1kZWNyZWUtYnV0dG9uJyk7CmNvbnN0IHN1Z2dlc3REZWNyZWVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VnZ2VzdC1kZWNyZWUtYnV0dG9uJyk7CmNvbnN0IGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWNyZWUtc3VnZ2VzdGlvbnMtYXJlYScpOwpjb25zdCB0b2dnbGVTZWFzb25hbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtc2Vhc29uYWwtYnV0dG9uJyk7CmNvbnN0IGRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbC1sb3lhbHR5LW11bHRpcGxpZXItaW5wdXQnKTsKY29uc3QgZGxEZWNyZWVDb29sZG93bklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RsLWRlY3JlZS1jb29sZG93bi1pbnB1dCcpOwpjb25zdCBzYXZlQWlTZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLWFpLXNldHRpbmdzLWJ1dHRvbicpOwpjb25zdCBkbFNlYXNvbmFsU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RsLXNlYXNvbmFsLXN0YXR1cycpOwpjb25zdCBkZWNyZWVzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWNyZWVzLWxpc3QnKTsKY29uc3QgbG95YWx0eUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS1saXN0Jyk7Ci8vIFVzZXIgTG95YWx0eSBFeHBsb3Jlcgpjb25zdCBsb3lhbHR5U2VhcmNoSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS1zZWFyY2gtaW5wdXQnKTsKY29uc3QgbG95YWx0eUZpbmRVc2VyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktZmluZC11c2VyLWJ1dHRvbicpOwpjb25zdCBsb3lhbHR5VXNlck5hbWVEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1uYW1lJyk7CmNvbnN0IGxveWFsdHlVc2VyU2NvcmVEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1zY29yZScpOwpjb25zdCBsb3lhbHR5VXNlclJhbmtEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1yYW5rJyk7CmNvbnN0IGxveWFsdHlVc2VyTGFzdEludGVyYWN0aW9uRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LXVzZXItbGFzdC1pbnRlcmFjdGlvbicpOwpjb25zdCBsb3lhbHR5QWRqdXN0U2NvcmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LWFkanVzdC1zY29yZS1pbnB1dCcpOwpjb25zdCBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS11cGRhdGUtc2NvcmUtYnV0dG9uJyk7CmNvbnN0IGxveWFsdHlFeHBsb3JlclN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LWV4cGxvcmVyLXN0YXR1cycpOwovLyBTdHJlYW0gQXV0b21hdGlvbgpjb25zdCBzdHJlYW1UaXRsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVhbS10aXRsZS1pbnB1dCcpOwpjb25zdCB1cGRhdGVUaXRsZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGRhdGUtdGl0bGUtYnV0dG9uJyk7CmNvbnN0IGNoYXRBbm5vdW5jZW1lbnRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWFubm91bmNlbWVudC1pbnB1dCcpOwpjb25zdCBzZW5kQW5ub3VuY2VtZW50QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbmQtYW5ub3VuY2VtZW50LWJ1dHRvbicpOwpjb25zdCB0YWtlU2NyZWVuc2hvdEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWtlLXNjcmVlbnNob3QtYnV0dG9uJyk7CmNvbnN0IHNjZW5lQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY2VuZS1idXR0b24nKTsKLy8gQWlycG9ydCBJbmZvIExvb2t1cApjb25zdCBpY2FvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNhby1pbnB1dCcpOwpjb25zdCBsb29rdXBBaXJwb3J0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvb2t1cC1haXJwb3J0LWJ1dHRvbicpOwpjb25zdCBhaXJwb3J0SW5mb0Rpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlycG9ydC1pbmZvLWRpc3BsYXknKTsKLy8gVHdpdGNoIENoYXQKY29uc3QgY2hhdE91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LW91dHB1dCcpOwpjb25zdCBib3RDaGF0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm90LWNoYXQtaW5wdXQnKTsKY29uc3Qgc2VuZEJvdE1lc3NhZ2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZC1ib3QtbWVzc2FnZS1idXR0b24nKTsKLy8gUXVpY2sgU2V0dGluZ3MKY29uc3QgcXNWb2ljZVByZWZpeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy12b2ljZS1wcmVmaXgnKTsKY29uc3QgcXNWb2ljZUFjdGl2YXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtdm9pY2UtYWN0aXZhdGlvbicpOwpjb25zdCBxc0FpUGVyc29uYWxpdHlQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtYWktcGVyc29uYWxpdHktcHJvbXB0Jyk7CmNvbnN0IHFzQWlNb2RlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1haS1tb2RlbCcpOwpjb25zdCBxc0xhbmd1YWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FzLWxhbmd1YWdlJyk7CmNvbnN0IHFzQ29uZmlnRmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1jb25maWctZmlsZScpOwpjb25zdCBxc09wZW5BaUFwaUtleVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1vcGVuYWktYXBpLWtleS1zdGF0dXMnKTsKY29uc3QgcXNBaXJwb3J0QXBpS2V5U3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FzLWFpcnBvcnQtYXBpLWtleS1zdGF0dXMnKTsKY29uc3QgcXNBenVyZVNwZWVjaEtleVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1henVyZS1zcGVlY2gta2V5LXN0YXR1cycpOwpjb25zdCBxc1NlbnRyeVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1zZW50cnktc3RhdHVzJyk7CmNvbnN0IHFzVmVyYm9zZUxvZ2dpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtdmVyYm9zZS1sb2dnaW5nJyk7CmNvbnN0IHFzTG9nTGV2ZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtbG9nLWxldmVsJyk7CmNvbnN0IHNldExvZ0xldmVsU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldC1sb2ctbGV2ZWwnKTsKY29uc3QgYXBwbHlMb2dMZXZlbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBseS1sb2ctbGV2ZWwtYnV0dG9uJyk7CmNvbnN0IGxvZ0xldmVsU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZy1sZXZlbC1zdGF0dXMnKTsKLy8gR2VtaW5pIEFQSQpsZXQgYWkgPSBudWxsOwp0cnkgewogICAgaWYgKHByb2Nlc3MuZW52LkFQSV9LRVkpIHsKICAgICAgICBhaSA9IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuQVBJX0tFWSB9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBub3QgZm91bmQuIEdlbWluaSBBUEkgZmVhdHVyZXMgd2lsbCBiZSBkaXNhYmxlZC4iKTsKICAgICAgICBpZiAoZGlhZ1Rlc3RPcGVuYWlCdXR0b24pCiAgICAgICAgICAgIGRpYWdUZXN0T3BlbmFpQnV0dG9uLnRpdGxlID0gIkdlbWluaSBBUEkgS2V5IG5vdCBzZXQgaW4gZW52aXJvbm1lbnQiOwogICAgfQp9CmNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW5pdGlhbGl6aW5nIEdvb2dsZUdlbkFJOiIsIGVycm9yKTsKICAgIGFpID0gbnVsbDsKICAgIGlmIChkaWFnVGVzdE9wZW5haUJ1dHRvbikKICAgICAgICBkaWFnVGVzdE9wZW5haUJ1dHRvbi50aXRsZSA9ICJFcnJvciBpbml0aWFsaXppbmcgR2VtaW5pIEFQSSI7Cn0KLy8gLS0tIFN0YXRlIFZhcmlhYmxlcyAtLS0KbGV0IGlzQm90UnVubmluZyA9IGZhbHNlOwpsZXQgaXNWb2ljZUVuYWJsZWQgPSBmYWxzZTsKbGV0IGlzVHRzRW5hYmxlZCA9IGZhbHNlOwpsZXQgaXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPSBmYWxzZTsKY29uc3QgYWlNb29kcyA9IFsiQW5hbHl0aWNhbCIsICJEcmFtYXRpYyIsICJBbXVzZWQiLCAiSW1wYXRpZW50Il07CmxldCBjdXJyZW50TW9vZEluZGV4ID0gMDsKbGV0IGN1cnJlbnRBaU1vZGVsID0gIkdlbWluaSI7IC8vIERlZmF1bHQgQUkgTW9kZWwKY29uc3Qgdm9pY2VTeXN0ZW1TdGF0ZXMgPSBbIkxJU1RFTklORyIsICJQUk9DRVNTSU5HIiwgIkVYRUNVVElORyIsICJDT09MRE9XTiIsICJFUlJPUiJdOwpsZXQgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IDA7CmNvbnN0IGZsaWdodENvbnRleHRzID0gWyJHcm91bmQiLCAiVGF4aSIsICJDbGltYiIsICJDcnVpc2UiLCAiRGVzY2VudCIsICJBcHByb2FjaCIsICJMYW5kaW5nIl07CmxldCBjdXJyZW50RmxpZ2h0Q29udGV4dEluZGV4ID0gMDsKbGV0IGN1cnJlbnRMb3lhbHR5VXNlciA9IG51bGw7CmNvbnN0IGRlZmF1bHRDb25maWdZYW1sID0gYHBlcnNvbmFsaXR5OgogIGRlZmF1bHRfbW9vZDogImFuYWx5dGljYWwiCiAgbG95YWx0eV9tdWx0aXBsaWVyOiAxLjUKICBkZWNyZWVfY29vbGRvd246IDMwMCAjIHNlY29uZHMKCnZvaWNlOgogIGFjdGl2YXRpb25fcGhyYXNlczoKICAgIC0gIm92ZXJsb3JkIgogICAgLSAiaGV5IG92ZXJsb3JkIgogICAgLSAiYWkgb3ZlcmxvcmQiCiAgY29tbWFuZF90aW1lb3V0OiA1LjAgIyBzZWNvbmRzIGZvciBTVFQgdG8gd2FpdCBmb3IgcGhyYXNlCiAgcGhyYXNlX2xpbWl0OiAxMC4wICMgbWF4IGR1cmF0aW9uIG9mIGEgdm9pY2UgY29tbWFuZAoKZmxpZ2h0X2ludGVncmF0aW9uOgogIG1pbGVzdG9uZV9hbm5vdW5jZW1lbnRzOiB0cnVlCiAgYWx0aXR1ZGVfdGhyZXNob2xkczogWzEwMDAsIDUwMDAsIDEwMDAwLCAxODAwMCwgMzUwMDBdICMgZmVldAogIHdlYXRoZXJfdXBkYXRlX2ludGVydmFsOiAzMDAgIyBzZWNvbmRzCmA7Ci8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQpmdW5jdGlvbiB1cGRhdGVTdGF0dXNJbmRpY2F0b3IoZWxlbWVudCwgaXNPbmxpbmUsIG9ubGluZVRleHQgPSAiT25saW5lIiwgb2ZmbGluZVRleHQgPSAiT2ZmbGluZSIpIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LnRleHRDb250ZW50ID0gaXNPbmxpbmUgPyBvbmxpbmVUZXh0IDogb2ZmbGluZVRleHQ7CiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGlzT25saW5lID8gJ3N0YXR1cy1vbmxpbmUnIDogJ3N0YXR1cy1vZmZsaW5lJzsKfQpmdW5jdGlvbiB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoaXNBY3RpdmUpIHsKICAgIGlmICghdmFkU3RhdHVzSW5kaWNhdG9yKQogICAgICAgIHJldHVybjsKICAgIHZhZFN0YXR1c0luZGljYXRvci50ZXh0Q29udGVudCA9IGlzQWN0aXZlID8gIkFjdGl2ZSIgOiAiSW5hY3RpdmUiOwogICAgdmFkU3RhdHVzSW5kaWNhdG9yLmNsYXNzTmFtZSA9IGlzQWN0aXZlID8gJ3N0YXR1cy12YWQtYWN0aXZlJyA6ICdzdGF0dXMtdmFkLWluYWN0aXZlJzsKfQpmdW5jdGlvbiBhcHBlbmRUb0xvZyhsb2dFbGVtZW50LCBtZXNzYWdlLCB0eXBlID0gJ2luZm8nKSB7CiAgICBpZiAoIWxvZ0VsZW1lbnQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgcGxhY2Vob2xkZXIgPSBsb2dFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2ctcGxhY2Vob2xkZXInKTsKICAgIGlmIChwbGFjZWhvbGRlcikgewogICAgICAgIHBsYWNlaG9sZGVyLnJlbW92ZSgpOwogICAgfQogICAgY29uc3QgbG9nRW50cnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGxvZ0VudHJ5LmNsYXNzTGlzdC5hZGQoJ2xvZy1lbnRyeScsIGBsb2ctZW50cnktJHt0eXBlfWApOwogICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKTsKICAgIGxvZ0VudHJ5LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGltZXN0YW1wIj5bJHt0aW1lc3RhbXB9XTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImxvZy1tZXNzYWdlIj4ke21lc3NhZ2V9PC9zcGFuPmA7CiAgICBsb2dFbGVtZW50LmFwcGVuZENoaWxkKGxvZ0VudHJ5KTsKICAgIGxvZ0VsZW1lbnQuc2Nyb2xsVG9wID0gbG9nRWxlbWVudC5zY3JvbGxIZWlnaHQ7IC8vIEF1dG8tc2Nyb2xsCn0KZnVuY3Rpb24gYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhtZXNzYWdlLCB0eXBlID0gJ3Rlc3QtaW5mbycpIHsKICAgIGlmICghZGlhZ25vc3RpY3NMb2dPdXRwdXQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgcGxhY2Vob2xkZXIgPSBkaWFnbm9zdGljc0xvZ091dHB1dC5xdWVyeVNlbGVjdG9yKCcubG9nLXBsYWNlaG9sZGVyJyk7CiAgICBpZiAocGxhY2Vob2xkZXIpIHsKICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTsKICAgIH0KICAgIGNvbnN0IGxvZ0VudHJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBsb2dFbnRyeS5jbGFzc0xpc3QuYWRkKCdsb2ctZW50cnknKTsgLy8gR2VuZXJhbCBjbGFzcwogICAgaWYgKHR5cGUgPT09ICd0ZXN0LXN1Y2Nlc3MnKSB7CiAgICAgICAgbG9nRW50cnkuY2xhc3NMaXN0LmFkZCgnbG9nLXN1Y2Nlc3MnKTsKICAgIH0KICAgIGVsc2UgaWYgKHR5cGUgPT09ICd0ZXN0LWZhaWx1cmUnKSB7CiAgICAgICAgbG9nRW50cnkuY2xhc3NMaXN0LmFkZCgnbG9nLWVycm9yJyk7CiAgICB9CiAgICBlbHNlIHsgLy8gJ3Rlc3QtaW5mbycKICAgICAgICBsb2dFbnRyeS5jbGFzc0xpc3QuYWRkKCdsb2ctaW5mbycpOwogICAgfQogICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKTsKICAgIGxvZ0VudHJ5LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGltZXN0YW1wIj5bJHt0aW1lc3RhbXB9XTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImxvZy1tZXNzYWdlIj4ke21lc3NhZ2V9PC9zcGFuPmA7CiAgICBkaWFnbm9zdGljc0xvZ091dHB1dC5hcHBlbmRDaGlsZChsb2dFbnRyeSk7CiAgICBkaWFnbm9zdGljc0xvZ091dHB1dC5zY3JvbGxUb3AgPSBkaWFnbm9zdGljc0xvZ091dHB1dC5zY3JvbGxIZWlnaHQ7Cn0KZnVuY3Rpb24gc2V0UGxhY2Vob2xkZXIobG9nRWxlbWVudCwgdGV4dCkgewogICAgaWYgKCFsb2dFbGVtZW50KQogICAgICAgIHJldHVybjsKICAgIGxvZ0VsZW1lbnQuaW5uZXJIVE1MID0gYDxsaSBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9saT5gOyAvLyBVc2UgPGxpPiBmb3IgVUwKICAgIGlmIChsb2dFbGVtZW50LnRhZ05hbWUgIT09ICdVTCcgJiYgbG9nRWxlbWVudC5pZCAhPT0gJ2RlY3JlZS1zdWdnZXN0aW9ucy1hcmVhJykgeyAvLyBGb3IgZGl2IGxvZ3MsIG5vdCBkZWNyZWUgc3VnZ2VzdGlvbnMKICAgICAgICBsb2dFbGVtZW50LmlubmVySFRNTCA9IGA8cCBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9wPmA7CiAgICB9CiAgICBlbHNlIGlmIChsb2dFbGVtZW50LmlkID09PSAnZGVjcmVlLXN1Z2dlc3Rpb25zLWFyZWEnICYmIGxvZ0VsZW1lbnQudGFnTmFtZSA9PT0gJ0RJVicpIHsKICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBkZWNyZWUgc3VnZ2VzdGlvbnMgYXJlYSBpZiBpdCdzIGEgZGl2IGNsZWFyZWQgdG8gcGxhY2Vob2xkZXIKICAgICAgICBsb2dFbGVtZW50LmlubmVySFRNTCA9IGA8cCBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9wPmA7CiAgICB9Cn0KZnVuY3Rpb24gc2V0U3RhdHVzTWVzc2FnZShlbGVtZW50LCBtZXNzYWdlLCB0eXBlID0gJ3N1Y2Nlc3MnLCBkdXJhdGlvbiA9IDMwMDApIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTsKICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gYG1vZHVsZS1zdGF0dXMtbWVzc2FnZSAke3R5cGV9YDsKICAgIGlmIChkdXJhdGlvbiA+IDApIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9ICcnOwogICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICdtb2R1bGUtc3RhdHVzLW1lc3NhZ2UnOwogICAgICAgIH0sIGR1cmF0aW9uKTsKICAgIH0KfQpjb25zdCBzYW1wbGVWb2ljZUNvbW1hbmRzID0gWwogICAgewogICAgICAgIG5hbWU6ICJTZXQgQWx0aXR1ZGUiLAogICAgICAgIHRyaWdnZXI6ICJvdmVybG9yZCBzZXQgYWx0aXR1ZGUiLAogICAgICAgIGRlc2M6ICJTZXQgYXV0b3BpbG90IGFsdGl0dWRlIiwKICAgICAgICBhbGlhc2VzOiAic2V0IGFsdGl0dWRlLCBhbHRpdHVkZSB0byIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAic3RyZWFtZXIiLAogICAgICAgIGNvb2xkb3duOiAiMi4wcyIsCiAgICAgICAgZXhwZWN0ZWRQYXJhbWV0ZXJzOiBbeyBuYW1lOiAiYWx0aXR1ZGUiLCB0eXBlOiAibnVtYmVyIiwgZGVzY3JpcHRpb246ICJUYXJnZXQgYWx0aXR1ZGUgaW4gZmVldCIgfV0KICAgIH0sCiAgICB7CiAgICAgICAgbmFtZTogIlNldCBIZWFkaW5nIiwKICAgICAgICB0cmlnZ2VyOiAib3ZlcmxvcmQgc2V0IGhlYWRpbmciLAogICAgICAgIGRlc2M6ICJTZXQgYXV0b3BpbG90IGhlYWRpbmciLAogICAgICAgIGFsaWFzZXM6ICJzZXQgaGVhZGluZywgaGVhZGluZyB0bywgdHVybiB0byIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAic3RyZWFtZXIiLAogICAgICAgIGNvb2xkb3duOiAiMi4wcyIsCiAgICAgICAgZXhwZWN0ZWRQYXJhbWV0ZXJzOiBbeyBuYW1lOiAiaGVhZGluZyIsIHR5cGU6ICJudW1iZXIgKDAtMzU5KSIsIGRlc2NyaXB0aW9uOiAiVGFyZ2V0IGhlYWRpbmcgaW4gZGVncmVlcyIgfV0KICAgIH0sCiAgICB7CiAgICAgICAgbmFtZTogIkNvbnRhY3QgQVRDIiwKICAgICAgICB0cmlnZ2VyOiAib3ZlcmxvcmQgY29udGFjdCB0b3dlciIsCiAgICAgICAgZGVzYzogIkRpc3BsYXkgQVRDIGNvbnRhY3QgaW5mb3JtYXRpb24iLAogICAgICAgIGFsaWFzZXM6ICJjb250YWN0IGF0YywgY2FsbCB0b3dlciIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwKICAgICAgICBjb29sZG93bjogIjUuMHMiLAogICAgICAgIGV4cGVjdGVkUGFyYW1ldGVyczogW3sgbmFtZTogImZhY2lsaXR5IiwgdHlwZTogInRleHQgKGUuZy4sIHRvd2VyLCBncm91bmQpIiwgZGVzY3JpcHRpb246ICJTcGVjaWZpYyBBVEMgZmFjaWxpdHkiIH1dCiAgICB9LAogICAgeyBuYW1lOiAiRmxpZ2h0IFN0YXR1cyIsIHRyaWdnZXI6ICJvdmVybG9yZCBmbGlnaHQgc3RhdHVzIiwgZGVzYzogIkRpc3BsYXkgZGV0YWlsZWQgZmxpZ2h0IHN0YXR1cyIsIGFsaWFzZXM6ICJzdGF0dXMgcmVwb3J0LCBmbGlnaHQgcmVwb3J0IiwgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwgY29vbGRvd246ICIzLjBzIiB9LAogICAgeyBuYW1lOiAiV2VhdGhlciBSZXBvcnQiLCB0cmlnZ2VyOiAib3ZlcmxvcmQgd2VhdGhlciByZXBvcnQiLCBkZXNjOiAiRGlzcGxheSBjdXJyZW50IHdlYXRoZXIiLCBhbGlhc2VzOiAid2VhdGhlciwgY3VycmVudCB3ZWF0aGVyIiwgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwgY29vbGRvd246ICI1LjBzIiB9LAogICAgeyBuYW1lOiAiRW1lcmdlbmN5IiwgdHJpZ2dlcjogIm92ZXJsb3JkIGVtZXJnZW5jeSIsIGRlc2M6ICJUcmlnZ2VyIGVtZXJnZW5jeSBwcm9jZWR1cmVzIiwgYWxpYXNlczogIiIsIHBlcm1pc3Npb25MZXZlbDogInN0cmVhbWVyIiwgY29vbGRvd246ICIxMC4wcyIgfSwKICAgIHsgbmFtZTogIlNjcmVlbnNob3QiLCB0cmlnZ2VyOiAib3ZlcmxvcmQgc2NyZWVuc2hvdCIsIGRlc2M6ICJUYWtlIGFuZCBzaGFyZSBzY3JlZW5zaG90IiwgYWxpYXNlczogInRha2Ugc2NyZWVuc2hvdCwgY2FwdHVyZSBzY3JlZW4iLCBwZXJtaXNzaW9uTGV2ZWw6ICJtb2RlcmF0b3IiLCBjb29sZG93bjogIjUuMHMiIH0sCiAgICB7CiAgICAgICAgbmFtZTogIkNoYW5nZSBTY2VuZSIsCiAgICAgICAgdHJpZ2dlcjogIm92ZXJsb3JkIGNoYW5nZSBzY2VuZSIsCiAgICAgICAgZGVzYzogIkNoYW5nZSBPQlMgc2NlbmUiLAogICAgICAgIGFsaWFzZXM6ICJzd2l0Y2ggc2NlbmUsIGNoYW5nZSB2aWV3IiwKICAgICAgICBwZXJtaXNzaW9uTGV2ZWw6ICJzdHJlYW1lciIsCiAgICAgICAgY29vbGRvd246ICIxLjBzIiwKICAgICAgICBleHBlY3RlZFBhcmFtZXRlcnM6IFt7IG5hbWU6ICJzY2VuZV9uYW1lIiwgdHlwZTogInRleHQiLCBkZXNjcmlwdGlvbjogIk5hbWUgb2YgdGhlIE9CUyBzY2VuZSIgfV0KICAgIH0sCl07CmNvbnN0IHNhbXBsZUxveWFsdHlEYXRhID0gewogICAgIlN0cmVhbVZpZXdlcjEyMyI6IHsgbmFtZTogIlN0cmVhbVZpZXdlcjEyMyIsIHNjb3JlOiAxMjUwLCByYW5rOiAiRGlnaXRhbCBEaXNjaXBsZSIsIGxhc3RJbnRlcmFjdGlvbjogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDg2NDAwMDAwICogMikudG9Mb2NhbGVEYXRlU3RyaW5nKCkgfSwKICAgICJBbm90aGVyRmFuIjogeyBuYW1lOiAiQW5vdGhlckZhbiIsIHNjb3JlOiA3ODAsIHJhbms6ICJBY29seXRlIiwgbGFzdEludGVyYWN0aW9uOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gODY0MDAwMDAgKiAxKS50b0xvY2FsZURhdGVTdHJpbmcoKSB9LAogICAgIkxveWFsRm9sbG93ZXJYIjogeyBuYW1lOiAiTG95YWxGb2xsb3dlclgiLCBzY29yZTogNTAwLCByYW5rOiAiSW5pdGlhdGUiLCBsYXN0SW50ZXJhY3Rpb246IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgfSwKICAgICJOZXdiaWVVc2VyIjogeyBuYW1lOiAiTmV3YmllVXNlciIsIHNjb3JlOiA1MCwgcmFuazogIkRyb25lIiwgbGFzdEludGVyYWN0aW9uOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpIH0KfTsKZnVuY3Rpb24gZ2V0TG95YWx0eVJhbmsoc2NvcmUpIHsKICAgIGlmIChzY29yZSA+PSAxMDAwKQogICAgICAgIHJldHVybiAiRGlnaXRhbCBEaXNjaXBsZSI7CiAgICBpZiAoc2NvcmUgPj0gNzUwKQogICAgICAgIHJldHVybiAiQWNvbHl0ZSI7CiAgICBpZiAoc2NvcmUgPj0gNTAwKQogICAgICAgIHJldHVybiAiSW5pdGlhdGUiOwogICAgaWYgKHNjb3JlID49IDI1MCkKICAgICAgICByZXR1cm4gIkZvbGxvd2VyIjsKICAgIHJldHVybiAiRHJvbmUiOwp9CmZ1bmN0aW9uIHBvcHVsYXRlQXZhaWxhYmxlQ29tbWFuZHMoKSB7CiAgICBpZiAoIWF2YWlsYWJsZUNvbW1hbmRzTGlzdCkKICAgICAgICByZXR1cm47CiAgICBhdmFpbGFibGVDb21tYW5kc0xpc3QuaW5uZXJIVE1MID0gJyc7CiAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgIHNldFBsYWNlaG9sZGVyKGF2YWlsYWJsZUNvbW1hbmRzTGlzdCwgJ0JvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VlIGNvbW1hbmRzLicpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIHNhbXBsZVZvaWNlQ29tbWFuZHMuZm9yRWFjaChjbWQgPT4gewogICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsKICAgICAgICBsZXQgcGFyYW1zSHRtbCA9ICcnOwogICAgICAgIGlmIChjbWQuZXhwZWN0ZWRQYXJhbWV0ZXJzICYmIGNtZC5leHBlY3RlZFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXJhbXNIdG1sICs9IGA8ZGl2IGNsYXNzPSJjb21tYW5kLXBhcmFtZXRlcnMiPkV4cGVjdGVkIFBhcmFtZXRlcnM6PHVsPmA7CiAgICAgICAgICAgIGNtZC5leHBlY3RlZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIHBhcmFtc0h0bWwgKz0gYDxsaT48c3BhbiBjbGFzcz0icGFyYW1ldGVyLW5hbWUiPiR7cC5uYW1lfTwvc3Bhbj46IDxzcGFuIGNsYXNzPSJwYXJhbWV0ZXItdHlwZSI+JHtwLnR5cGV9PC9zcGFuPiR7cC5kZXNjcmlwdGlvbiA/IGAgKCR7cC5kZXNjcmlwdGlvbn0pYCA6ICcnfTwvbGk+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHBhcmFtc0h0bWwgKz0gYDwvdWw+PC9kaXY+YDsKICAgICAgICB9CiAgICAgICAgbGkuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8c3BhbiBjbGFzcz0iY29tbWFuZC10cmlnZ2VyIj4ke2NtZC50cmlnZ2VyfTwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbW1hbmQtZGVzY3JpcHRpb24iPiR7Y21kLmRlc2N9PC9zcGFuPgogICAgICAgICAgICAke2NtZC5hbGlhc2VzID8gYDxzcGFuIGNsYXNzPSJjb21tYW5kLWFsaWFzZXMiPkFsaWFzZXM6ICR7Y21kLmFsaWFzZXN9PC9zcGFuPmAgOiAnJ30KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tbWFuZC1kZXRhaWxzIj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC1sYWJlbCI+UGVybWlzc2lvbjo8L3NwYW4+IDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC12YWx1ZSI+JHtjbWQucGVybWlzc2lvbkxldmVsfTwvc3Bhbj4gfCAKICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC1sYWJlbCI+Q29vbGRvd246PC9zcGFuPiA8c3BhbiBjbGFzcz0iY29tbWFuZC1kZXRhaWwtdmFsdWUiPiR7Y21kLmNvb2xkb3dufTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICR7cGFyYW1zSHRtbH0KICAgICAgICBgOwogICAgICAgIGF2YWlsYWJsZUNvbW1hbmRzTGlzdC5hcHBlbmRDaGlsZChsaSk7CiAgICB9KTsKfQpmdW5jdGlvbiB1cGRhdGVBaVBlcnNvbmFsaXR5RGlzcGxheSgpIHsKICAgIGlmIChhaVBlcnNvbmFsaXR5RGlzcGxheSkgewogICAgICAgIGxldCBwZXJzb25hbGl0eVRleHQgPSBgQUkgT3ZlcmxvcmQgKCR7Y3VycmVudEFpTW9kZWx9IENvcmVgOwogICAgICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICAgICAgcGVyc29uYWxpdHlUZXh0ICs9ICIgLSBTaW0uIjsKICAgICAgICB9CiAgICAgICAgcGVyc29uYWxpdHlUZXh0ICs9ICIpIjsKICAgICAgICBhaVBlcnNvbmFsaXR5RGlzcGxheS50ZXh0Q29udGVudCA9IHBlcnNvbmFsaXR5VGV4dDsKICAgIH0KfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUoKSB7CiAgICBpZiAoc3VnZ2VzdERlY3JlZUJ1dHRvbikgewogICAgICAgIGNvbnN0IGlzRGlzYWJsZWQgPSAhaXNCb3RSdW5uaW5nIHx8IGN1cnJlbnRBaU1vZGVsICE9PSAiR2VtaW5pIiB8fCAhYWk7CiAgICAgICAgc3VnZ2VzdERlY3JlZUJ1dHRvbi5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7CiAgICAgICAgaWYgKCFhaSkgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkdlbWluaSBBUEkgS2V5IG5vdCBzZXQuIENhbm5vdCBzdWdnZXN0IGRlY3JlZXMuIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc3VnZ2VzdCBkZWNyZWVzLiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGN1cnJlbnRBaU1vZGVsICE9PSAiR2VtaW5pIikgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkRlY3JlZSBzdWdnZXN0aW9ucyByZXF1aXJlIHRoZSBHZW1pbmkgbW9kZWwuIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHN1Z2dlc3REZWNyZWVCdXR0b24udGl0bGUgPSAiU3VnZ2VzdHMgZGVjcmVlcyB1c2luZyB0aGUgR2VtaW5pIEFQSSI7CiAgICAgICAgfQogICAgfQp9Ci8vIC0tLSBFdmVudCBIYW5kbGVycyAmIExvZ2ljIC0tLQovLyBCb3QgQ29udHJvbAppZiAodG9nZ2xlQm90QnV0dG9uKSB7CiAgICB0b2dnbGVCb3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaXNCb3RSdW5uaW5nID0gIWlzQm90UnVubmluZzsKICAgICAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3IoYm90U3RhdHVzSW5kaWNhdG9yLCBpc0JvdFJ1bm5pbmcsICJSdW5uaW5nIiwgIlN0b3BwZWQiKTsKICAgICAgICB0b2dnbGVCb3RCdXR0b24udGV4dENvbnRlbnQgPSBpc0JvdFJ1bm5pbmcgPyAiU3RvcCBCb3QiIDogIlN0YXJ0IEJvdCI7CiAgICAgICAgaWYgKGFpTW9kZWxTZWxlY3QpCiAgICAgICAgICAgIGFpTW9kZWxTZWxlY3QuZGlzYWJsZWQgPSBpc0JvdFJ1bm5pbmc7IC8vIERpc2FibGUgbW9kZWwgc2VsZWN0aW9uIHdoaWxlIGJvdCBpcyBydW5uaW5nCiAgICAgICAgLy8gRW5hYmxlL2Rpc2FibGUgY29udHJvbHMgYmFzZWQgb24gYm90IHN0YXRlCiAgICAgICAgY29uc3QgY29udHJvbHNUb1RvZ2dsZSA9IFsKICAgICAgICAgICAgY3ljbGVNb29kQnV0dG9uLCByZXF1ZXN0U3RhdHVzUmVwb3J0QnV0dG9uLCB0b2dnbGVUdHNCdXR0b24sCiAgICAgICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLCBzYXZlQWlTZXR0aW5nc0J1dHRvbiwgYW5hbHl6ZUZ1ZWxCdXR0b24sCiAgICAgICAgICAgIGxveWFsdHlGaW5kVXNlckJ1dHRvbiwgbG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uLCBhcHBseUxvZ0xldmVsQnV0dG9uCiAgICAgICAgICAgIC8vIHN1Z2dlc3REZWNyZWVCdXR0b24gaXMgaGFuZGxlZCBieSB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUKICAgICAgICBdOwogICAgICAgIGNvbnRyb2xzVG9Ub2dnbGUuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4uZGlzYWJsZWQgPSAhaXNCb3RSdW5uaW5nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRleHQtYnV0dG9uJykuZm9yRWFjaChidG4gPT4gYnRuLmRpc2FibGVkID0gIWlzQm90UnVubmluZyk7CiAgICAgICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7CiAgICAgICAgaWYgKGlzQm90UnVubmluZykgewogICAgICAgICAgICBhaU1vb2REaXNwbGF5LnRleHRDb250ZW50ID0gYWlNb29kc1tjdXJyZW50TW9vZEluZGV4XTsKICAgICAgICAgICAgdXBkYXRlQWlQZXJzb25hbGl0eURpc3BsYXkoKTsgLy8gVXNlIG5ldyBmdW5jdGlvbgogICAgICAgICAgICBjdXJyZW50RmxpZ2h0Q29udGV4dEluZGV4ID0gMDsgLy8gUmVzZXQgdG8gR3JvdW5kCiAgICAgICAgICAgIGlmIChhaUZsaWdodENvbnRleHREaXNwbGF5KQogICAgICAgICAgICAgICAgYWlGbGlnaHRDb250ZXh0RGlzcGxheS50ZXh0Q29udGVudCA9IGZsaWdodENvbnRleHRzW2N1cnJlbnRGbGlnaHRDb250ZXh0SW5kZXhdOwogICAgICAgICAgICBhcHBlbmRUb0xvZyhtb29kTG9nT3V0cHV0LCBgQm90IHN0YXJ0ZWQuIEluaXRpYWwgbW9vZDogJHthaU1vb2RzW2N1cnJlbnRNb29kSW5kZXhdfWAsICJtb29kIik7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBJbml0aWFsIGZsaWdodCBjb250ZXh0OiAke2ZsaWdodENvbnRleHRzW2N1cnJlbnRGbGlnaHRDb250ZXh0SW5kZXhdfWAsICJtb29kIik7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBQcmltYXJ5IEFJIE1vZGVsOiAke2N1cnJlbnRBaU1vZGVsfWAsICJzeXN0ZW0iKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb3B1bGF0ZVNhbXBsZUZsaWdodERhdGEoKSwgMTAwMCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYWRkU2FtcGxlQ2hhdE1lc3NhZ2UoInN5c3RlbSIsICJBSSBPdmVybG9yZCBCb3QgY29ubmVjdGVkIHRvIGNoYXQuIiksIDUwMCk7CiAgICAgICAgICAgIHBvcHVsYXRlUXVpY2tTZXR0aW5ncygpOwogICAgICAgICAgICBwb3B1bGF0ZVZvaWNlRGV0YWlscygpOwogICAgICAgICAgICBwb3B1bGF0ZUZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgICAgICAgICBwb3B1bGF0ZURlY3JlZUxveWFsdHlEZXRhaWxzKCk7CiAgICAgICAgICAgIHBvcHVsYXRlQXZhaWxhYmxlQ29tbWFuZHMoKTsKICAgICAgICAgICAgcG9wdWxhdGVTeXN0ZW1IZWFsdGhNZXRyaWNzKCk7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgc3lzdGVtIGluaXRpYWxpemVkLiIsICJtaWxlc3RvbmUiKTsKICAgICAgICAgICAgdXBkYXRlVmFkU3RhdHVzSW5kaWNhdG9yKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChhaU1vb2REaXNwbGF5KQogICAgICAgICAgICAgICAgYWlNb29kRGlzcGxheS50ZXh0Q29udGVudCA9ICItLS0iOwogICAgICAgICAgICBpZiAoYWlQZXJzb25hbGl0eURpc3BsYXkpCiAgICAgICAgICAgICAgICBhaVBlcnNvbmFsaXR5RGlzcGxheS50ZXh0Q29udGVudCA9ICItLS0iOwogICAgICAgICAgICBpZiAoYWlGbGlnaHRDb250ZXh0RGlzcGxheSkKICAgICAgICAgICAgICAgIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgICAgICAgICAgY2xlYXJGbGlnaHREYXRhKCk7CiAgICAgICAgICAgIGNsZWFyUXVpY2tTZXR0aW5ncygpOwogICAgICAgICAgICBjbGVhclZvaWNlRGV0YWlscygpOwogICAgICAgICAgICBjbGVhckZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgICAgICAgICBjbGVhckRlY3JlZUxveWFsdHlEZXRhaWxzKCk7CiAgICAgICAgICAgIGNsZWFyU3lzdGVtSGVhbHRoTWV0cmljcygpOwogICAgICAgICAgICB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoZmFsc2UpOwogICAgICAgICAgICBjbGVhckxveWFsdHlFeHBsb3JlcigpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcih2b2ljZUxvZ091dHB1dCwgIlZvaWNlIGNvbW1hbmQgYWN0aXZpdHkgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihjaGF0T3V0cHV0LCAiVHdpdGNoIGNoYXQgbWVzc2FnZXMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVzTGlzdCwgIk5vIGRlY3JlZXMgaXNzdWVkLiIpOwogICAgICAgICAgICBpZiAoZGVjcmVlU3VnZ2VzdGlvbnNBcmVhKSB7CiAgICAgICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVTdWdnZXN0aW9uc0FyZWEsICJEZWNyZWUgaWRlYXMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICAgICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0UGxhY2Vob2xkZXIobW9vZExvZ091dHB1dCwgIk1vb2QgY2hhbmdlcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgICAgIHNldFBsYWNlaG9sZGVyKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgbWlsZXN0b25lcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgICAgIHNldFBsYWNlaG9sZGVyKGF2YWlsYWJsZUNvbW1hbmRzTGlzdCwgJ0JvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VlIGNvbW1hbmRzLicpOwogICAgICAgICAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgICAgICAgICAgYWlycG9ydEluZm9EaXNwbGF5LnRleHRDb250ZW50ID0gJ0FpcnBvcnQgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgICAgICAgICAgaWYgKHdlYXRoZXJEaXNwbGF5KQogICAgICAgICAgICAgICAgd2VhdGhlckRpc3BsYXkudGV4dENvbnRlbnQgPSAnTUVUQVIgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgICAgICAgICAgaXNWb2ljZUVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheSkKICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9ICJEaXNhYmxlZCI7CiAgICAgICAgICAgIGlmICh0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uKQogICAgICAgICAgICAgICAgdG9nZ2xlVm9pY2VDb21tYW5kc0J1dHRvbi50ZXh0Q29udGVudCA9ICJFbmFibGUgVm9pY2UiOwogICAgICAgICAgICBpc1R0c0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRvZ2dsZVR0c0J1dHRvbikKICAgICAgICAgICAgICAgIHRvZ2dsZVR0c0J1dHRvbi50ZXh0Q29udGVudCA9ICJFbmFibGUgVFRTIE91dHB1dCI7CiAgICAgICAgICAgIGlzU2Vhc29uYWxDb250ZW50QWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChkbFNlYXNvbmFsU3RhdHVzKQogICAgICAgICAgICAgICAgZGxTZWFzb25hbFN0YXR1cy50ZXh0Q29udGVudCA9ICJJbmFjdGl2ZSI7CiAgICAgICAgICAgIGlmICh0b2dnbGVTZWFzb25hbEJ1dHRvbikKICAgICAgICAgICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLnRleHRDb250ZW50ID0gIkVuYWJsZSBTZWFzb25hbCI7CiAgICAgICAgICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgICAgICAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uZGlzYWJsZWQgPSB0cnVlOyAvLyBBbHNvIGRpc2FibGUgaWYgYm90IHN0b3BzCiAgICAgICAgfQogICAgICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcih0d2l0Y2hTdGF0dXNJbmRpY2F0b3IsIGlzQm90UnVubmluZyk7CiAgICAgICAgdXBkYXRlU3RhdHVzSW5kaWNhdG9yKHN0cmVhbWVyYm90U3RhdHVzSW5kaWNhdG9yLCBpc0JvdFJ1bm5pbmcpOwogICAgICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihsbm1TdGF0dXNJbmRpY2F0b3IsIGlzQm90UnVubmluZyk7CiAgICB9KTsKfQppZiAoYWlNb2RlbFNlbGVjdCkgewogICAgYWlNb2RlbFNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgY3VycmVudEFpTW9kZWwgPSBhaU1vZGVsU2VsZWN0LnZhbHVlOwogICAgICAgIHVwZGF0ZUFpUGVyc29uYWxpdHlEaXNwbGF5KCk7CiAgICAgICAgcG9wdWxhdGVRdWlja1NldHRpbmdzKCk7IC8vIFJlZnJlc2ggcXVpY2sgc2V0dGluZ3MgdG8gc2hvdyBuZXcgbW9kZWwKICAgICAgICB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUoKTsKICAgICAgICBpZiAoaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBQcmltYXJ5IEFJIE1vZGVsIGNoYW5nZWQgdG86ICR7Y3VycmVudEFpTW9kZWx9YCwgInN5c3RlbSIpOwogICAgICAgIH0KICAgIH0pOwp9CmlmIChjeWNsZU1vb2RCdXR0b24pIHsKICAgIGN5Y2xlTW9vZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGN1cnJlbnRNb29kSW5kZXggPSAoY3VycmVudE1vb2RJbmRleCArIDEpICUgYWlNb29kcy5sZW5ndGg7CiAgICAgICAgY29uc3QgbmV3TW9vZCA9IGFpTW9vZHNbY3VycmVudE1vb2RJbmRleF07CiAgICAgICAgaWYgKGFpTW9vZERpc3BsYXkpCiAgICAgICAgICAgIGFpTW9vZERpc3BsYXkudGV4dENvbnRlbnQgPSBuZXdNb29kOwogICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBNb29kIG1hbnVhbGx5IGNoYW5nZWQgdG86ICR7bmV3TW9vZH1gLCAibW9vZCIpOwogICAgfSk7Cn0KaWYgKHJlcXVlc3RTdGF0dXNSZXBvcnRCdXR0b24pIHsKICAgIHJlcXVlc3RTdGF0dXNSZXBvcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCByZXBvcnRQYXJ0cyA9IFsKICAgICAgICAgICAgIlNpbXVsYXRlZCBGdWxsIFN0YXR1cyBSZXBvcnQ6IiwKICAgICAgICAgICAgYC0gQm90IFN0YXR1czogUnVubmluZ2AsCiAgICAgICAgICAgIGAtIFByaW1hcnkgQUkgTW9kZWw6ICR7Y3VycmVudEFpTW9kZWx9YCwKICAgICAgICAgICAgYC0gQUkgTW9vZDogJHthaU1vb2REaXNwbGF5Py50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBBSSBQZXJzb25hbGl0eSBQcm9tcHQ6ICR7cXNBaVBlcnNvbmFsaXR5UHJvbXB0Py50ZXh0Q29udGVudD8uc3Vic3RyaW5nKDAsIDUwKSB8fCAnTi9BJ30uLi5gLAogICAgICAgICAgICBgLSBGbGlnaHQgUGhhc2U6ICR7ZmRQaGFzZT8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gVm9pY2UgU3lzdGVtOiAke2lzVm9pY2VFbmFibGVkID8gKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheT8udGV4dENvbnRlbnQgfHwgJ0VuYWJsZWQnKSA6ICJEaXNhYmxlZCJ9YCwKICAgICAgICAgICAgYC0gVFRTIE91dHB1dDogJHtpc1R0c0VuYWJsZWQgPyAiRW5hYmxlZCIgOiAiRGlzYWJsZWQifWAsCiAgICAgICAgICAgIGAtIExvZyBMZXZlbDogJHtxc0xvZ0xldmVsPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBPcGVuQUkvR2VtaW5pIEtleTogJHtxc09wZW5BaUFwaUtleVN0YXR1cz8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gQWlycG9ydCBBUEkgS2V5OiAke3FzQWlycG9ydEFwaUtleVN0YXR1cz8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gQXp1cmUgU3BlZWNoIEtleTogJHtxc0F6dXJlU3BlZWNoS2V5U3RhdHVzPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBTZW50cnkgRFNOOiAke3FzU2VudHJ5U3RhdHVzPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gCiAgICAgICAgXTsKICAgICAgICBhbGVydChyZXBvcnRQYXJ0cy5qb2luKCJcbiIpKTsKICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCAiQUkgT3ZlcmxvcmQ6IEdlbmVyYXRpbmcgZnVsbCBzdGF0dXMgcmVwb3J0IChzaW11bGF0ZWQpLi4uIiwgInN5c3RlbSIpOwogICAgfSk7Cn0KaWYgKGZsaWdodENvbnRleHRCdXR0b25zQ29udGFpbmVyKSB7CiAgICBmbGlnaHRDb250ZXh0QnV0dG9uc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udGV4dC1idXR0b24nKSkgewogICAgICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IHRhcmdldC5kYXRhc2V0LmNvbnRleHQ7CiAgICAgICAgICAgIGlmIChjb250ZXh0ICYmIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkpIHsKICAgICAgICAgICAgICAgIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgPSBjb250ZXh0OwogICAgICAgICAgICAgICAgY3VycmVudEZsaWdodENvbnRleHRJbmRleCA9IGZsaWdodENvbnRleHRzLmluZGV4T2YoY29udGV4dCk7CiAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyhtb29kTG9nT3V0cHV0LCBgRmxpZ2h0IGNvbnRleHQgaW5mbHVlbmNlIGNoYW5nZWQgdG86ICR7Y29udGV4dH1gLCAibW9vZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KLy8gVm9pY2UgQ29tbWFuZHMKaWYgKHRvZ2dsZVZvaWNlQ29tbWFuZHNCdXR0b24pIHsKICAgIHRvZ2dsZVZvaWNlQ29tbWFuZHNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gZW5hYmxlIHZvaWNlIGNvbW1hbmRzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlzVm9pY2VFbmFibGVkID0gIWlzVm9pY2VFbmFibGVkOwogICAgICAgIGlmIChpc1ZvaWNlRW5hYmxlZCkgewogICAgICAgICAgICBjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ID0gMDsKICAgICAgICAgICAgaWYgKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheSkKICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZvaWNlIHJlY29nbml0aW9uIHN5c3RlbSBlbmFibGVkLiIsICJpbmZvIik7CiAgICAgICAgICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcihmYWxzZSk7IC8vIFN0YXJ0IGFzIGluYWN0aXZlCiAgICAgICAgICAgIC8vIFNpbXVsYXRlIFZBRCBhY3Rpdml0eSBhbmQgY29tbWFuZCBwcm9jZXNzaW5nCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc1ZvaWNlRW5hYmxlZCB8fCAhaXNCb3RSdW5uaW5nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcih0cnVlKTsgLy8gVkFEIGRldGVjdHMgc3BlZWNoCiAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZBRDogU3BlZWNoIGRldGVjdGVkLCByZWNvcmRpbmcuLi4iLCAiaW5mbyIpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzVm9pY2VFbmFibGVkIHx8ICFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgdXBkYXRlVmFkU3RhdHVzSW5kaWNhdG9yKGZhbHNlKTsgLy8gVkFEIHN0b3BzIHJlY29yZGluZwogICAgICAgICAgICAgICAgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IChjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ICsgMSkgJSB2b2ljZVN5c3RlbVN0YXRlcy5sZW5ndGg7IC8vIFByb2Nlc3NpbmcKICAgICAgICAgICAgICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgICAgICAgICAgICAgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5LnRleHRDb250ZW50ID0gdm9pY2VTeXN0ZW1TdGF0ZXNbY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleF07CiAgICAgICAgICAgICAgICBhZGRTYW1wbGVWb2ljZUNvbW1hbmQoIkhleSBPdmVybG9yZCwgd2hhdCdzIHRoZSBmbGlnaHQgc3RhdHVzPyIsICJHZXRGbGlnaHRTdGF0dXMiLCAiUmVjb2duaXplZCIpOwogICAgICAgICAgICAgICAgaWYgKG1ldHJpY3NMYXN0Vm9pY2VDbWQpCiAgICAgICAgICAgICAgICAgICAgbWV0cmljc0xhc3RWb2ljZUNtZC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBpZiAobWV0cmljc1ZvaWNlUXVldWUpCiAgICAgICAgICAgICAgICAgICAgbWV0cmljc1ZvaWNlUXVldWUudGV4dENvbnRlbnQgPSAiMSI7CiAgICAgICAgICAgIH0sIDMwMDApOyAvLyBFbmQgb2YgVkFEIGFjdGl2ZSwgc3RhcnQgcHJvY2Vzc2luZwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghaXNWb2ljZUVuYWJsZWQgfHwgIWlzQm90UnVubmluZykKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ID0gKGN1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXggKyAxKSAlIHZvaWNlU3lzdGVtU3RhdGVzLmxlbmd0aDsgLy8gRXhlY3V0aW5nCiAgICAgICAgICAgICAgICBpZiAodm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICAgICAgaWYgKG1ldHJpY3NWb2ljZVF1ZXVlKQogICAgICAgICAgICAgICAgICAgIG1ldHJpY3NWb2ljZVF1ZXVlLnRleHRDb250ZW50ID0gIjAiOwogICAgICAgICAgICB9LCA0NTAwKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzVm9pY2VFbmFibGVkIHx8ICFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IDA7IC8vIEJhY2sgdG8gTGlzdGVuaW5nCiAgICAgICAgICAgICAgICBpZiAodm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICB9LCA2MDAwKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgICAgICAgICB2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiRGlzYWJsZWQiOwogICAgICAgICAgICB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoZmFsc2UpOwogICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZvaWNlIHJlY29nbml0aW9uIHN5c3RlbSBkaXNhYmxlZC4iLCAiaW5mbyIpOwogICAgICAgIH0KICAgICAgICB0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uLnRleHRDb250ZW50ID0gaXNWb2ljZUVuYWJsZWQgPyAiRGlzYWJsZSBWb2ljZSIgOiAiRW5hYmxlIFZvaWNlIjsKICAgIH0pOwp9CmZ1bmN0aW9uIGFkZFNhbXBsZVZvaWNlQ29tbWFuZChyYXdUZXh0LCBpbnRlbnQsIHN0YXR1cykgewogICAgY29uc3QgbWVzc2FnZSA9IGBTcGVlY2g6ICIke3Jhd1RleHR9IiB8IEludGVudDogJHtpbnRlbnR9IHwgU3RhdHVzOiAke3N0YXR1c31gOwogICAgYXBwZW5kVG9Mb2codm9pY2VMb2dPdXRwdXQsIG1lc3NhZ2UsICJ2b2ljZSIpOwp9Ci8vIFZvaWNlIFN5c3RlbSBEZXRhaWxzCmlmICh0b2dnbGVUdHNCdXR0b24pIHsKICAgIHRvZ2dsZVR0c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB0b2dnbGUgVFRTLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlzVHRzRW5hYmxlZCA9ICFpc1R0c0VuYWJsZWQ7CiAgICAgICAgdG9nZ2xlVHRzQnV0dG9uLnRleHRDb250ZW50ID0gaXNUdHNFbmFibGVkID8gIkRpc2FibGUgVFRTIE91dHB1dCIgOiAiRW5hYmxlIFRUUyBPdXRwdXQiOwogICAgICAgIGFsZXJ0KGBUVFMgT3V0cHV0IChzaW11bGF0ZWQpICR7aXNUdHNFbmFibGVkID8gIkVuYWJsZWQiIDogIkRpc2FibGVkIn1gKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHBvcHVsYXRlVm9pY2VEZXRhaWxzKCkgewogICAgaWYgKCF2ZHNTdHRFbmdpbmUpCiAgICAgICAgcmV0dXJuOyAvLyBFbnN1cmUgZWxlbWVudHMgZXhpc3QKICAgIHZkc1N0dEVuZ2luZS50ZXh0Q29udGVudCA9ICJnb29nbGUiOwogICAgdmRzTGFuZ3VhZ2UudGV4dENvbnRlbnQgPSAiZW4tVVMiOwogICAgdmRzQ29uZmlkZW5jZS50ZXh0Q29udGVudCA9ICIwLjciOwogICAgdmRzVGltZW91dC50ZXh0Q29udGVudCA9ICI1cyI7CiAgICB2ZHNQaHJhc2VMaW1pdC50ZXh0Q29udGVudCA9ICIxMHMiOwogICAgdmRzRW5lcmd5VGhyZXNob2xkLnRleHRDb250ZW50ID0gIjMwMCI7CiAgICB2ZHNEeW5hbWljRW5lcmd5LnRleHRDb250ZW50ID0gIlRydWUiOwogICAgdmRzUGF1c2VUaHJlc2hvbGQudGV4dENvbnRlbnQgPSAiMC44cyI7CiAgICB2ZHNQaHJhc2VUaHJlc2hvbGQudGV4dENvbnRlbnQgPSAiMC4zcyI7CiAgICB2ZHNWYWRBZ2dyZXNzaXZlbmVzcy50ZXh0Q29udGVudCA9ICJMZXZlbCAyIjsKICAgIHZkc01pY1NhbXBsZVJhdGUudGV4dENvbnRlbnQgPSAiMTYwMDBIeiI7CiAgICB2ZHNNaWNDaHVua1NpemUudGV4dENvbnRlbnQgPSAiNTEyIGJ5dGVzIjsKfQpmdW5jdGlvbiBjbGVhclZvaWNlRGV0YWlscygpIHsKICAgIGNvbnN0IGZpZWxkcyA9IFsKICAgICAgICB2ZHNTdHRFbmdpbmUsIHZkc0xhbmd1YWdlLCB2ZHNDb25maWRlbmNlLCB2ZHNUaW1lb3V0LCB2ZHNQaHJhc2VMaW1pdCwKICAgICAgICB2ZHNFbmVyZ3lUaHJlc2hvbGQsIHZkc0R5bmFtaWNFbmVyZ3ksIHZkc1BhdXNlVGhyZXNob2xkLCB2ZHNQaHJhc2VUaHJlc2hvbGQsCiAgICAgICAgdmRzVmFkQWdncmVzc2l2ZW5lc3MsIHZkc01pY1NhbXBsZVJhdGUsIHZkc01pY0NodW5rU2l6ZQogICAgXTsKICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHsgaWYgKGZpZWxkKQogICAgICAgIGZpZWxkLnRleHRDb250ZW50ID0gIi0tLSI7IH0pOwp9Ci8vIEZsaWdodCBEYXRhIFNpbXVsYXRpb24KZnVuY3Rpb24gcG9wdWxhdGVTYW1wbGVGbGlnaHREYXRhKCkgewogICAgaWYgKCFpc0JvdFJ1bm5pbmcgfHwgIWZkQ2FsbHNpZ24pCiAgICAgICAgcmV0dXJuOwogICAgZmRDYWxsc2lnbi50ZXh0Q29udGVudCA9ICJBSU8xMjMiOwogICAgZmRBaXJjcmFmdC50ZXh0Q29udGVudCA9ICJCb2VpbmcgNzM3LTgwMCI7CiAgICBmZEFsdGl0dWRlLnRleHRDb250ZW50ID0gIjM1LDAwMCBmdCI7CiAgICBmZFNwZWVkLnRleHRDb250ZW50ID0gIjQ1MCBrdHMiOwogICAgZmRIZWFkaW5nLnRleHRDb250ZW50ID0gIjI3MMKwIjsKICAgIGZkVnNwZWVkLnRleHRDb250ZW50ID0gIis1MDAgZnBtIjsKICAgIGZkUGhhc2UudGV4dENvbnRlbnQgPSAiQ3J1aXNlIjsKICAgIGZkTmV4dFdwLnRleHRDb250ZW50ID0gIldBWVAxIjsKICAgIGZkRXRhTmV4dC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxNSAqIDYwMDAwKS50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KTsKICAgIGZkRnVlbC50ZXh0Q29udGVudCA9ICI3NSUiOwogICAgYXBwZW5kVG9Mb2coZmxpZ2h0TWlsZXN0b25lc0xvZywgIkFpcmNyYWZ0IGRhdGEgbG9hZGVkLiBQaGFzZTogQ3J1aXNlLiIsICJtaWxlc3RvbmUiKTsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmICghaXNCb3RSdW5uaW5nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgYXBwZW5kVG9Mb2coZmxpZ2h0TWlsZXN0b25lc0xvZywgIk1pbGVzdG9uZTogUmVhY2hlZCAzNSwwMDAgZnQiLCAibWlsZXN0b25lIik7CiAgICB9LCAyMDAwKTsKfQpmdW5jdGlvbiBjbGVhckZsaWdodERhdGEoKSB7CiAgICBpZiAoIWZkQ2FsbHNpZ24pCiAgICAgICAgcmV0dXJuOwogICAgZmRDYWxsc2lnbi50ZXh0Q29udGVudCA9ICJOL0EiOwogICAgZmRBaXJjcmFmdC50ZXh0Q29udGVudCA9ICJOL0EiOwogICAgZmRBbHRpdHVkZS50ZXh0Q29udGVudCA9ICIwIGZ0IjsKICAgIGZkU3BlZWQudGV4dENvbnRlbnQgPSAiMCBrdHMiOwogICAgZmRIZWFkaW5nLnRleHRDb250ZW50ID0gIjDCsCI7CiAgICBmZFZzcGVlZC50ZXh0Q29udGVudCA9ICIwIGZwbSI7CiAgICBmZFBoYXNlLnRleHRDb250ZW50ID0gIkdyb3VuZGVkIjsKICAgIGZkTmV4dFdwLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBmZEV0YU5leHQudGV4dENvbnRlbnQgPSAiLS06LS0iOwogICAgZmRGdWVsLnRleHRDb250ZW50ID0gIjEwMCUiOwp9CmlmIChhbmFseXplRnVlbEJ1dHRvbikgewogICAgYW5hbHl6ZUZ1ZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBhcHBlbmRUb0xvZyhmbGlnaHRNaWxlc3RvbmVzTG9nLCAiRnVlbCBhbmFseXNpcyBpbml0aWF0ZWQgYnkgc3RyZWFtZXIgKHNpbXVsYXRlZCkuIiwgIm1pbGVzdG9uZSIpOwogICAgICAgIGFsZXJ0KCJTaW11bGF0ZWQgRnVlbCBBbmFseXNpczpcbi0gQ3VycmVudCBGdWVsOiAiICsgKGZkRnVlbD8udGV4dENvbnRlbnQgfHwgJ04vQScpICsgIlxuLSBFc3RpbWF0ZWQgRW5kdXJhbmNlOiAyaCAzMG1cbi0gUmVjb21tZW5kYXRpb246IFN1ZmZpY2llbnQgZm9yIGN1cnJlbnQgZmxpZ2h0IHBsYW4uIik7CiAgICB9KTsKfQovLyBGbGlnaHQgQXV0b21hdGlvbiBJbnNpZ2h0cwpmdW5jdGlvbiBwb3B1bGF0ZUZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpIHsKICAgIGlmICghZmFNaWxlc3RvbmVBbHRpdHVkZXMpCiAgICAgICAgcmV0dXJuOwogICAgZmFNaWxlc3RvbmVBbHRpdHVkZXMudGV4dENvbnRlbnQgPSAiMTAwMCwgNTAwMCwgMTAwMDAsIDE4MDAwLCAzNTAwMCBmdCI7CiAgICBmYUF1dG9TY2VuZVN0YXR1cy50ZXh0Q29udGVudCA9ICJFbmFibGVkIChSdWxlcyBBY3RpdmUpIjsKICAgIGZhV2VhdGhlckludGVydmFsLnRleHRDb250ZW50ID0gIjMwMHMiOwp9CmZ1bmN0aW9uIGNsZWFyRmxpZ2h0QXV0b21hdGlvbkluc2lnaHRzKCkgewogICAgaWYgKCFmYU1pbGVzdG9uZUFsdGl0dWRlcykKICAgICAgICByZXR1cm47CiAgICBmYU1pbGVzdG9uZUFsdGl0dWRlcy50ZXh0Q29udGVudCA9ICItLS0iOwogICAgZmFBdXRvU2NlbmVTdGF0dXMudGV4dENvbnRlbnQgPSAiRGlzYWJsZWQiOwogICAgZmFXZWF0aGVySW50ZXJ2YWwudGV4dENvbnRlbnQgPSAiLS0tIjsKfQovLyBTeXN0ZW0gSGVhbHRoICYgTWV0cmljcwpmdW5jdGlvbiBwb3B1bGF0ZVN5c3RlbUhlYWx0aE1ldHJpY3MoKSB7CiAgICBpZiAoIWlzQm90UnVubmluZyB8fCAhbWV0cmljc1N5c3RlbVN0YXR1cykKICAgICAgICByZXR1cm47CiAgICBtZXRyaWNzU3lzdGVtU3RhdHVzLnRleHRDb250ZW50ID0gIkFsbCBTeXN0ZW1zIE5vbWluYWwiOwogICAgbWV0cmljc1ZvaWNlUXVldWUudGV4dENvbnRlbnQgPSAiMCI7CiAgICBtZXRyaWNzTGFzdFZvaWNlQ21kLnRleHRDb250ZW50ID0gIk4vQSI7CiAgICBtZXRyaWNzRGJDb25uZWN0aW9uLnRleHRDb250ZW50ID0gIkNvbm5lY3RlZCI7CiAgICBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nLnRleHRDb250ZW50ID0gcXNTZW50cnlTdGF0dXM/LmNsYXNzTGlzdC5jb250YWlucygna2V5LXN0YXR1cy1zZXQnKSA/ICJSZXBvcnRpbmcgQWN0aXZlIiA6ICJJbmFjdGl2ZSI7Cn0KZnVuY3Rpb24gY2xlYXJTeXN0ZW1IZWFsdGhNZXRyaWNzKCkgewogICAgaWYgKCFtZXRyaWNzU3lzdGVtU3RhdHVzKQogICAgICAgIHJldHVybjsKICAgIG1ldHJpY3NTeXN0ZW1TdGF0dXMudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIG1ldHJpY3NWb2ljZVF1ZXVlLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzTGFzdFZvaWNlQ21kLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzRGJDb25uZWN0aW9uLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nLnRleHRDb250ZW50ID0gIi0tLSI7Cn0KLy8gQ29uZmlnIEVkaXRvciBMb2dpYwppZiAobG9hZERlZmF1bHRDb25maWdCdXR0b24gJiYgY29uZmlnRWRpdG9yVGV4dGFyZWEpIHsKICAgIGxvYWREZWZhdWx0Q29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbmZpZ0VkaXRvclRleHRhcmVhLnZhbHVlID0gZGVmYXVsdENvbmZpZ1lhbWw7CiAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShjb25maWdFZGl0b3JTdGF0dXMsICJEZWZhdWx0IGNvbmZpZyBsb2FkZWQgaW50byBlZGl0b3IuIiwgJ2luZm8nKTsKICAgIH0pOwp9CmlmIChzYXZlQ29uZmlnQnV0dG9uICYmIGNvbmZpZ0VkaXRvclRleHRhcmVhKSB7CiAgICBzYXZlQ29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSBjb25maWdFZGl0b3JUZXh0YXJlYS52YWx1ZTsKICAgICAgICBjb25zb2xlLmxvZygiU2ltdWxhdGVkIFNhdmUgQ29uZmlnOiIsIGN1cnJlbnRDb25maWcpOwogICAgICAgIHNldFN0YXR1c01lc3NhZ2UoY29uZmlnRWRpdG9yU3RhdHVzLCAiQ29uZmlndXJhdGlvbiBzYXZlZCAoc2ltdWxhdGVkKS4iLCAnc3VjY2VzcycpOwogICAgfSk7Cn0KLy8gRGlhZ25vc3RpY3MgJiBUZXN0aW5nIExvZ2ljCmlmIChkaWFnVGVzdFR3aXRjaEJ1dHRvbikgewogICAgZGlhZ1Rlc3RUd2l0Y2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IE1hdGgucmFuZG9tKCkgPiAwLjI7IC8vIFNpbXVsYXRlIHN1Y2Nlc3MvZmFpbHVyZQogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlR3aXRjaCBBUEk6IENvbm5lY3Rpb24gVGVzdCBTVUNDRVNTRlVMLiBPQXV0aCBUb2tlbiBWYWxpZC4gKFNpbXVsYXRlZCkiLCAndGVzdC1zdWNjZXNzJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJUd2l0Y2ggQVBJOiBDb25uZWN0aW9uIFRlc3QgRkFJTEVELiBDaGVjayBPQXV0aCBUb2tlbiBvciBOZXR3b3JrLiAoU2ltdWxhdGVkKSIsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RTdHJlYW1lcmJvdEJ1dHRvbikgewogICAgZGlhZ1Rlc3RTdHJlYW1lcmJvdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTdHJlYW1lci5ib3Q6IFdlYlNvY2tldCBDb25uZWN0aW9uIFRlc3QgU1VDQ0VTU0ZVTC4gKFNpbXVsYXRlZCkiLCAndGVzdC1zdWNjZXNzJyk7CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RMbm1CdXR0b24pIHsKICAgIGRpYWdUZXN0TG5tQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIkxpdHRsZU5hdm1hcDogQ29ubmVjdGlvbiBUZXN0IFNVQ0NFU1NGVUwuIEZsaWdodCBkYXRhIGFjY2Vzc2libGUuIChTaW11bGF0ZWQpIiwgJ3Rlc3Qtc3VjY2VzcycpOwogICAgfSk7Cn0KaWYgKGRpYWdUZXN0T3BlbmFpQnV0dG9uKSB7CiAgICBkaWFnVGVzdE9wZW5haUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICBpZiAoIWFpKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIkdlbWluaSBBUEk6IFRlc3QgRkFJTEVELiBBUEkgY2xpZW50IG5vdCBpbml0aWFsaXplZCAoY2hlY2sgQVBJX0tFWSkuIiwgJ3Rlc3QtZmFpbHVyZScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhgR2VtaW5pIEFQSTogVGVzdCBTS0lQUEVELiBDdXJyZW50IG1vZGVsIGlzICR7Y3VycmVudEFpTW9kZWx9LiBUaGlzIHRlc3QgaXMgZm9yIEdlbWluaS5gLCAndGVzdC1pbmZvJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZygiR2VtaW5pIEFQSTogU2VuZGluZyB0ZXN0IHF1ZXJ5ICdFY2hvOiBIZWxsbyBPdmVybG9yZCcuLi4iLCAndGVzdC1pbmZvJyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHsKICAgICAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA0LTE3JywKICAgICAgICAgICAgICAgIGNvbnRlbnRzOiAnRWNobzogSGVsbG8gT3ZlcmxvcmQnLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dE91dHB1dCA9IHJlc3BvbnNlLnRleHQ7CiAgICAgICAgICAgIGlmICh0ZXh0T3V0cHV0ID09PSBudWxsIHx8IHRleHRPdXRwdXQgPT09IHVuZGVmaW5lZCkgeyAvLyBDaGVjayBmb3IgdW5kZWZpbmVkIGFzIHdlbGwsIGFzIC50ZXh0IGlzIHN0cmluZyB8IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhgR2VtaW5pIEFQSTogVGVzdCBRdWVyeSBGQUlMRUQuIFJlc3BvbnNlIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkLmAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0ZXh0T3V0cHV0LmluY2x1ZGVzKCJIZWxsbyBPdmVybG9yZCIpKSB7CiAgICAgICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBHZW1pbmkgQVBJOiBUZXN0IFF1ZXJ5IFNVQ0NFRURFRC4gUmVzcG9uc2U6ICIke3RleHRPdXRwdXR9ImAsICd0ZXN0LXN1Y2Nlc3MnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYEdlbWluaSBBUEk6IFRlc3QgUXVlcnkgVU5FWFBFQ1RFRCBSRVNQT05TRS4gUmVzcG9uc2U6ICIke3RleHRPdXRwdXR9ImAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJHZW1pbmkgQVBJIHRlc3QgZXJyb3I6IiwgZSk7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYEdlbWluaSBBUEk6IFRlc3QgUXVlcnkgRkFJTEVELiBFcnJvcjogJHtlLm1lc3NhZ2UgfHwgZS50b1N0cmluZygpfWAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RUdHNCdXR0b24pIHsKICAgIGRpYWdUZXN0VHRzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlRUUyBPdXRwdXQ6IFN5bnRoZXNpemVkIHRlc3QgcGhyYXNlICdHcmVldGluZ3MgT3ZlcmxvcmQnIHN1Y2Nlc3NmdWxseS4gKFNpbXVsYXRlZCkiLCAndGVzdC1pbmZvJyk7CiAgICB9KTsKfQppZiAoZGlhZ0NsYXNzaWZ5SW50ZW50QnV0dG9uICYmIGRpYWdWb2ljZUludGVudElucHV0KSB7CiAgICBkaWFnQ2xhc3NpZnlJbnRlbnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgY29uc3QgcGhyYXNlID0gZGlhZ1ZvaWNlSW50ZW50SW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgIGlmICghcGhyYXNlKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlZvaWNlIEludGVudCBUZXN0OiBQbGVhc2UgZW50ZXIgYSBwaHJhc2UgdG8gdGVzdC4iLCAndGVzdC1pbmZvJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGludGVudCA9ICJVbmtub3duSW50ZW50IjsKICAgICAgICBsZXQgcGFyYW1zID0gInt9IjsKICAgICAgICBpZiAocGhyYXNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFsdGl0dWRlIikpIHsKICAgICAgICAgICAgaW50ZW50ID0gIlNldEFsdGl0dWRlIjsKICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBwaHJhc2UubWF0Y2goL1xkKy8pOwogICAgICAgICAgICBpZiAobWF0Y2gpCiAgICAgICAgICAgICAgICBwYXJhbXMgPSBgeyBhbHRpdHVkZTogJHttYXRjaFswXX0gfWA7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBocmFzZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJ3ZWF0aGVyIikpIHsKICAgICAgICAgICAgaW50ZW50ID0gIkdldFdlYXRoZXIiOwogICAgICAgIH0KICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBWb2ljZSBJbnRlbnQgVGVzdDogSW5wdXQ6ICIke3BocmFzZX0iIC0+IEludGVudDogJHtpbnRlbnR9LCBQYXJhbXM6ICR7cGFyYW1zfSAoU2ltdWxhdGVkKWAsICd0ZXN0LWluZm8nKTsKICAgICAgICBkaWFnVm9pY2VJbnRlbnRJbnB1dC52YWx1ZSA9ICIiOwogICAgfSk7Cn0KaWYgKGRpYWdUcmlnZ2VyRGVjcmVlQnV0dG9uKSB7CiAgICBkaWFnVHJpZ2dlckRlY3JlZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTeXN0ZW0gRXZlbnQ6IFRlc3QgRGVjcmVlIHRyaWdnZXJlZDogJ0FsbCB2aWV3ZXJzIG11c3QgZW5nYWdlIG1heGltdW0gaHlwZSEnIChTaW11bGF0ZWQpIiwgJ3Rlc3QtaW5mbycpOwogICAgICAgIGlmIChpc0JvdFJ1bm5pbmcgJiYgZGVjcmVlc0xpc3QpCiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGRlY3JlZXNMaXN0LCBgVGVzdCBEZWNyZWU6ICJBbGwgdmlld2VycyBtdXN0IGVuZ2FnZSBtYXhpbXVtIGh5cGUhImAsICJkZWNyZWUiKTsKICAgIH0pOwp9CmlmIChkaWFnVHJpZ2dlck1pbGVzdG9uZUJ1dHRvbikgewogICAgZGlhZ1RyaWdnZXJNaWxlc3RvbmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZygiU3lzdGVtIEV2ZW50OiBUZXN0IEZsaWdodCBNaWxlc3RvbmUgdHJpZ2dlcmVkOiAnUmVhY2hlZCBUZXN0IFdheXBvaW50IEFMUEhBJyAoU2ltdWxhdGVkKSIsICd0ZXN0LWluZm8nKTsKICAgICAgICBpZiAoaXNCb3RSdW5uaW5nICYmIGZsaWdodE1pbGVzdG9uZXNMb2cpCiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGZsaWdodE1pbGVzdG9uZXNMb2csICJUZXN0IE1pbGVzdG9uZTogUmVhY2hlZCBUZXN0IFdheXBvaW50IEFMUEhBIiwgIm1pbGVzdG9uZSIpOwogICAgfSk7Cn0KLy8gV2VhdGhlcgppZiAoZmV0Y2hXZWF0aGVyQnV0dG9uKSB7CiAgICBmZXRjaFdlYXRoZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gZmV0Y2ggd2VhdGhlci4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgICAgIHdlYXRoZXJEaXNwbGF5LnRleHRDb250ZW50ID0gIkZldGNoaW5nIHdlYXRoZXIuLi4iOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgICAgICAgICB3ZWF0aGVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBNRVRBUiBLTEFYICR7bmV3IERhdGUoKS5nZXREYXRlKCl9MjA1MFogMjcwMTBLVCAxMFNNIEZFVzAzMCBTQ1QwNDUgQktOMDYwIDI1LzE1IEEzMDAxIFJNSyBBTzIgU0xQMTYwIFQwMjUwMDE1MGA7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGNoYXRPdXRwdXQsICJBSSBPdmVybG9yZDogV2VhdGhlciBkYXRhIHVwZGF0ZWQgZm9yIEtMQVguIiwgImNoYXQiKTsKICAgICAgICB9LCAxNTAwKTsKICAgIH0pOwp9Ci8vIERlY3JlZXMgJiBMb3lhbHR5CmlmIChpc3N1ZURlY3JlZUJ1dHRvbikgewogICAgaXNzdWVEZWNyZWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gaXNzdWUgZGVjcmVlcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBkZWNyZWVUZXh0ID0gcHJvbXB0KCJFbnRlciB5b3VyIGRlY3JlZSwgT3ZlcmxvcmQ6IiwgIkFsbCB2aWV3ZXJzIG11c3QgaHlkcmF0ZSEiKTsKICAgICAgICBpZiAoZGVjcmVlVGV4dCkgewogICAgICAgICAgICBhcHBlbmRUb0xvZyhkZWNyZWVzTGlzdCwgYE1hbnVhbCBEZWNyZWU6ICIke2RlY3JlZVRleHR9ImAsICJkZWNyZWUiKTsKICAgICAgICAgICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgYEFJIE92ZXJsb3JkJ3MgRGVjcmVlOiAke2RlY3JlZVRleHR9YCwgImNoYXQiKTsKICAgICAgICB9CiAgICB9KTsKfQphc3luYyBmdW5jdGlvbiBoYW5kbGVTdWdnZXN0RGVjcmVlcygpIHsKICAgIGlmICghaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc3VnZ2VzdCBkZWNyZWVzLiIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICBhbGVydCgiRGVjcmVlIHN1Z2dlc3Rpb25zIGN1cnJlbnRseSByZXF1aXJlIHRoZSBHZW1pbmkgQUkgbW9kZWwgdG8gYmUgYWN0aXZlLiIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghYWkpIHsKICAgICAgICBhbGVydCgiR2VtaW5pIEFQSSBjbGllbnQgbm90IGF2YWlsYWJsZS4gQ2Fubm90IHN1Z2dlc3QgZGVjcmVlcy4iKTsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTdWdnZXN0IERlY3JlZXM6IEdlbWluaSBBUEkgY2xpZW50IG5vdCBpbml0aWFsaXplZC4iLCAidGVzdC1mYWlsdXJlIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFkZWNyZWVTdWdnZXN0aW9uc0FyZWEgfHwgIWFpTW9vZERpc3BsYXkgfHwgIWFpRmxpZ2h0Q29udGV4dERpc3BsYXkpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgbW9vZCA9IGFpTW9vZERpc3BsYXkudGV4dENvbnRlbnQgfHwgIkFuYWx5dGljYWwiOwogICAgY29uc3QgZmxpZ2h0Q29udGV4dCA9IGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgfHwgIkNydWlzZSI7CiAgICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhbiBBSSBPdmVybG9yZCB3aXRoIGEgJHttb29kfSBtb29kLCBjdXJyZW50bHkgb2JzZXJ2aW5nIGEgZmxpZ2h0IGluIHRoZSAke2ZsaWdodENvbnRleHR9IHBoYXNlLiBTdWdnZXN0IDMgc2hvcnQsIHRoZW1hdGljIGRlY3JlZSBpZGVhcyAobWF4IDE1IHdvcmRzIGVhY2gpIHRoYXQgSSwgdGhlIHN0cmVhbWVyLCBjYW4gaXNzdWUgdG8gbXkgdmlld2Vycy4gUmV0dXJuIGFzIGEgSlNPTiBhcnJheSBvZiBzdHJpbmdzLiBFeGFtcGxlOiBbIkFsbCBkcm9uZXMgbXVzdCByZXBvcnQgZnVlbCBsZXZlbHMhIiwgIkluaXRpYXRlIHByb3RvY29sICdNYXhpbXVtIEh5cGUnISIsICJSZWNhbGlicmF0ZSB5b3VyIGZvY3VzIG1hdHJpeC4iXWA7CiAgICBkZWNyZWVTdWdnZXN0aW9uc0FyZWEuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJsb2ctcGxhY2Vob2xkZXIiPvCflK4gQ29uanVyaW5nIGRlY3JlZSBpZGVhcy4uLjwvcD4nOwogICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgaWYgKHN1Z2dlc3REZWNyZWVCdXR0b24pCiAgICAgICAgc3VnZ2VzdERlY3JlZUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7CiAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA0LTE3JywKICAgICAgICAgICAgY29udGVudHM6IHByb21wdCwKICAgICAgICAgICAgY29uZmlnOiB7IHJlc3BvbnNlTWltZVR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gcmVzcG9uc2UudGV4dDsgLy8gRW5zdXJlIHRoaXMgaXMgcHJvcGVydHkgYWNjZXNzLCBub3QgcmVzcG9uc2UudGV4dCgpCiAgICAgICAgaWYgKHJlc3BvbnNlVGV4dCA9PT0gbnVsbCB8fCByZXNwb25zZVRleHQgPT09IHVuZGVmaW5lZCkgeyAvLyBDaGVjayBmb3IgdW5kZWZpbmVkIGFzIHdlbGwKICAgICAgICAgICAgc2V0UGxhY2Vob2xkZXIoZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLCAiRXJyb3I6IEFJIHJldHVybmVkIGFuIGVtcHR5IHJlc3BvbnNlLiIpOwogICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBTdWdnZXN0IERlY3JlZXMgRXJyb3I6IEFJIHJldHVybmVkIGEgbnVsbCBvciB1bmRlZmluZWQgdGV4dCByZXNwb25zZS5gLCAndGVzdC1mYWlsdXJlJyk7CiAgICAgICAgICAgIHVwZGF0ZVN1Z2dlc3REZWNyZWVCdXR0b25TdGF0ZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBqc29uU3RyID0gcmVzcG9uc2VUZXh0LnRyaW0oKTsKICAgICAgICBjb25zdCBmZW5jZVJlZ2V4ID0gL15gYGAoXHcqKT9ccypcbj8oLio/KVxuP1xzKmBgYCQvczsKICAgICAgICBjb25zdCBtYXRjaCA9IGpzb25TdHIubWF0Y2goZmVuY2VSZWdleCk7CiAgICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdKSB7CiAgICAgICAgICAgIGpzb25TdHIgPSBtYXRjaFsyXS50cmltKCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gSlNPTi5wYXJzZShqc29uU3RyKTsKICAgICAgICBpZiAoc3VnZ2VzdGlvbnMgJiYgc3VnZ2VzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgICAgICAgICBsaS50ZXh0Q29udGVudCA9IHM7CiAgICAgICAgICAgICAgICBsaS5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY3JlZVRleHQgPSBwcm9tcHQoIklzc3VlIHRoaXMgZGVjcmVlPyIsIHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChkZWNyZWVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFRvTG9nKGRlY3JlZXNMaXN0LCBgQUkgU3VnZ2VzdGVkIERlY3JlZTogIiR7ZGVjcmVlVGV4dH0iYCwgImRlY3JlZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCBgQUkgT3ZlcmxvcmQncyBEZWNyZWU6ICR7ZGVjcmVlVGV4dH1gLCAiY2hhdCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB1bC5hcHBlbmRDaGlsZChsaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkZWNyZWVTdWdnZXN0aW9uc0FyZWEuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGRlY3JlZVN1Z2dlc3Rpb25zQXJlYS5hcHBlbmRDaGlsZCh1bCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVTdWdnZXN0aW9uc0FyZWEsICJObyBkZWNyZWUgaWRlYXMgZm91bmQuIFRyeSBhZ2Fpbj8iKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBkZWNyZWUgc3VnZ2VzdGlvbnM6IiwgZXJyb3IpOwogICAgICAgIHNldFBsYWNlaG9sZGVyKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSwgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2UgfHwgIkNvdWxkIG5vdCBmZXRjaCBzdWdnZXN0aW9ucy4ifWApOwogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYFN1Z2dlc3QgRGVjcmVlcyBFcnJvcjogJHtlcnJvci5tZXNzYWdlIHx8IGVycm9yLnRvU3RyaW5nKCl9YCwgJ3Rlc3QtZmFpbHVyZScpOwogICAgfQogICAgZmluYWxseSB7CiAgICAgICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7CiAgICB9Cn0KaWYgKHN1Z2dlc3REZWNyZWVCdXR0b24pIHsKICAgIHN1Z2dlc3REZWNyZWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTdWdnZXN0RGVjcmVlcyk7Cn0KaWYgKHRvZ2dsZVNlYXNvbmFsQnV0dG9uKSB7CiAgICB0b2dnbGVTZWFzb25hbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlzU2Vhc29uYWxDb250ZW50QWN0aXZlID0gIWlzU2Vhc29uYWxDb250ZW50QWN0aXZlOwogICAgICAgIGlmIChkbFNlYXNvbmFsU3RhdHVzKQogICAgICAgICAgICBkbFNlYXNvbmFsU3RhdHVzLnRleHRDb250ZW50ID0gaXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPyAiQWN0aXZlIiA6ICJJbmFjdGl2ZSI7CiAgICAgICAgdG9nZ2xlU2Vhc29uYWxCdXR0b24udGV4dENvbnRlbnQgPSBpc1NlYXNvbmFsQ29udGVudEFjdGl2ZSA/ICJEaXNhYmxlIFNlYXNvbmFsIiA6ICJFbmFibGUgU2Vhc29uYWwiOwogICAgICAgIGFsZXJ0KGBTZWFzb25hbCBDb250ZW50IChzaW11bGF0ZWQpICR7aXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPyAiRW5hYmxlZCIgOiAiRGlzYWJsZWQifWApOwogICAgfSk7Cn0KaWYgKHNhdmVBaVNldHRpbmdzQnV0dG9uKSB7CiAgICBzYXZlQWlTZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byBzYXZlIEFJIHNldHRpbmdzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWU7CiAgICAgICAgY29uc3QgY29vbGRvd24gPSBkbERlY3JlZUNvb2xkb3duSW5wdXQudmFsdWU7CiAgICAgICAgYWxlcnQoYFNpbXVsYXRlZCBTYXZlOiBMb3lhbHR5IE11bHRpcGxpZXIgc2V0IHRvICR7bXVsdGlwbGllcn0sIERlY3JlZSBDb29sZG93biB0byAke2Nvb2xkb3dufXMuYCk7CiAgICAgICAgYXBwZW5kVG9Mb2cobW9vZExvZ091dHB1dCwgYEFJIFNldHRpbmdzIChzaW11bGF0ZWQpIHNhdmVkLiBNdWx0aXBsaWVyOiAke211bHRpcGxpZXJ9LCBDb29sZG93bjogJHtjb29sZG93bn1zLmAsICJzeXN0ZW0iKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHBvcHVsYXRlRGVjcmVlTG95YWx0eURldGFpbHMoKSB7CiAgICBpZiAoIWRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCkKICAgICAgICByZXR1cm47CiAgICBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWUgPSAiMS41IjsKICAgIGRsRGVjcmVlQ29vbGRvd25JbnB1dC52YWx1ZSA9ICIzMDAiOwp9CmZ1bmN0aW9uIGNsZWFyRGVjcmVlTG95YWx0eURldGFpbHMoKSB7CiAgICBpZiAoIWRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCkKICAgICAgICByZXR1cm47CiAgICBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWUgPSAiLS0tIjsKICAgIGRsRGVjcmVlQ29vbGRvd25JbnB1dC52YWx1ZSA9ICItLS0iOwogICAgaWYgKGRsU2Vhc29uYWxTdGF0dXMpCiAgICAgICAgZGxTZWFzb25hbFN0YXR1cy50ZXh0Q29udGVudCA9ICJJbmFjdGl2ZSI7Cn0KLy8gVXNlciBMb3lhbHR5IEV4cGxvcmVyCmlmIChsb3lhbHR5RmluZFVzZXJCdXR0b24gJiYgbG95YWx0eVNlYXJjaElucHV0KSB7CiAgICBsb3lhbHR5RmluZFVzZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsICJCb3QgbXVzdCBiZSBydW5uaW5nIHRvIHNlYXJjaCB1c2Vycy4iLCAnZXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB1c2VybmFtZSA9IGxveWFsdHlTZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgaWYgKCF1c2VybmFtZSkgewogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgIlBsZWFzZSBlbnRlciBhIHVzZXJuYW1lIHRvIHNlYXJjaC4iLCAnaW5mbycpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVzZXIgPSBzYW1wbGVMb3lhbHR5RGF0YVt1c2VybmFtZV07CiAgICAgICAgaWYgKHVzZXIpIHsKICAgICAgICAgICAgY3VycmVudExveWFsdHlVc2VyID0gdXNlcjsKICAgICAgICAgICAgaWYgKGxveWFsdHlVc2VyTmFtZURpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlck5hbWVEaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5uYW1lOwogICAgICAgICAgICBpZiAobG95YWx0eVVzZXJTY29yZURpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlclNjb3JlRGlzcGxheS50ZXh0Q29udGVudCA9IHVzZXIuc2NvcmUudG9TdHJpbmcoKTsKICAgICAgICAgICAgaWYgKGxveWFsdHlVc2VyUmFua0Rpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlclJhbmtEaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5yYW5rOwogICAgICAgICAgICBpZiAobG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5KQogICAgICAgICAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5sYXN0SW50ZXJhY3Rpb247CiAgICAgICAgICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgICAgICAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsIGBVc2VyICcke3VzZXJuYW1lfScgZm91bmQuYCwgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNsZWFyTG95YWx0eUV4cGxvcmVyKGZhbHNlKTsgLy8gQ2xlYXIgZGlzcGxheSBidXQgbm90IGlucHV0CiAgICAgICAgICAgIHNldFN0YXR1c01lc3NhZ2UobG95YWx0eUV4cGxvcmVyU3RhdHVzLCBgVXNlciAnJHt1c2VybmFtZX0nIG5vdCBmb3VuZC5gLCAnZXJyb3InKTsKICAgICAgICAgICAgY3VycmVudExveWFsdHlVc2VyID0gbnVsbDsKICAgICAgICB9CiAgICB9KTsKfQppZiAobG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uICYmIGxveWFsdHlBZGp1c3RTY29yZUlucHV0KSB7CiAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcgfHwgIWN1cnJlbnRMb3lhbHR5VXNlcikgewogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgIk5vIHVzZXIgbG9hZGVkIG9yIGJvdCBub3QgcnVubmluZy4iLCAnZXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBhZGp1c3RtZW50VGV4dCA9IGxveWFsdHlBZGp1c3RTY29yZUlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICBjb25zdCBhZGp1c3RtZW50ID0gcGFyc2VJbnQoYWRqdXN0bWVudFRleHQsIDEwKTsKICAgICAgICBpZiAoaXNOYU4oYWRqdXN0bWVudCkpIHsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsICJJbnZhbGlkIHNjb3JlIGFkanVzdG1lbnQuIE11c3QgYmUgYSBudW1iZXIgKGUuZy4sICsxMCBvciAtNSkuIiwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY3VycmVudExveWFsdHlVc2VyLnNjb3JlICs9IGFkanVzdG1lbnQ7CiAgICAgICAgY3VycmVudExveWFsdHlVc2VyLnJhbmsgPSBnZXRMb3lhbHR5UmFuayhjdXJyZW50TG95YWx0eVVzZXIuc2NvcmUpOwogICAgICAgIGN1cnJlbnRMb3lhbHR5VXNlci5sYXN0SW50ZXJhY3Rpb24gPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpOwogICAgICAgIC8vIFVwZGF0ZSBkaXNwbGF5CiAgICAgICAgaWYgKGxveWFsdHlVc2VyU2NvcmVEaXNwbGF5KQogICAgICAgICAgICBsb3lhbHR5VXNlclNjb3JlRGlzcGxheS50ZXh0Q29udGVudCA9IGN1cnJlbnRMb3lhbHR5VXNlci5zY29yZS50b1N0cmluZygpOwogICAgICAgIGlmIChsb3lhbHR5VXNlclJhbmtEaXNwbGF5KQogICAgICAgICAgICBsb3lhbHR5VXNlclJhbmtEaXNwbGF5LnRleHRDb250ZW50ID0gY3VycmVudExveWFsdHlVc2VyLnJhbms7CiAgICAgICAgaWYgKGxveWFsdHlVc2VyTGFzdEludGVyYWN0aW9uRGlzcGxheSkKICAgICAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gY3VycmVudExveWFsdHlVc2VyLmxhc3RJbnRlcmFjdGlvbjsKICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgYFVwZGF0ZWQgJHtjdXJyZW50TG95YWx0eVVzZXIubmFtZX0ncyBzY29yZSBieSAke2FkanVzdG1lbnR9LiBOZXcgc2NvcmU6ICR7Y3VycmVudExveWFsdHlVc2VyLnNjb3JlfS4gTmV3IHJhbms6ICR7Y3VycmVudExveWFsdHlVc2VyLnJhbmt9LmAsICdzdWNjZXNzJyk7CiAgICAgICAgbG95YWx0eUFkanVzdFNjb3JlSW5wdXQudmFsdWUgPSAiIjsgLy8gQ2xlYXIgaW5wdXQKICAgIH0pOwp9CmZ1bmN0aW9uIGNsZWFyTG95YWx0eUV4cGxvcmVyKGNsZWFyU2VhcmNoSW5wdXQgPSB0cnVlKSB7CiAgICBpZiAoY2xlYXJTZWFyY2hJbnB1dCAmJiBsb3lhbHR5U2VhcmNoSW5wdXQpCiAgICAgICAgbG95YWx0eVNlYXJjaElucHV0LnZhbHVlID0gIiI7CiAgICBpZiAobG95YWx0eVVzZXJOYW1lRGlzcGxheSkKICAgICAgICBsb3lhbHR5VXNlck5hbWVEaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBpZiAobG95YWx0eVVzZXJTY29yZURpc3BsYXkpCiAgICAgICAgbG95YWx0eVVzZXJTY29yZURpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIGlmIChsb3lhbHR5VXNlclJhbmtEaXNwbGF5KQogICAgICAgIGxveWFsdHlVc2VyUmFua0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIGlmIChsb3lhbHR5VXNlckxhc3RJbnRlcmFjdGlvbkRpc3BsYXkpCiAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBpZiAobG95YWx0eUFkanVzdFNjb3JlSW5wdXQpCiAgICAgICAgbG95YWx0eUFkanVzdFNjb3JlSW5wdXQudmFsdWUgPSAiIjsKICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgbG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKICAgIGlmIChsb3lhbHR5RXhwbG9yZXJTdGF0dXMpCiAgICAgICAgbG95YWx0eUV4cGxvcmVyU3RhdHVzLnRleHRDb250ZW50ID0gIiI7CiAgICBjdXJyZW50TG95YWx0eVVzZXIgPSBudWxsOwp9Ci8vIFN0cmVhbSBBdXRvbWF0aW9uCmlmICh1cGRhdGVUaXRsZUJ1dHRvbiAmJiBzdHJlYW1UaXRsZUlucHV0KSB7CiAgICB1cGRhdGVUaXRsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB1cGRhdGUgdGl0bGUuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3VGl0bGUgPSBzdHJlYW1UaXRsZUlucHV0LnZhbHVlOwogICAgICAgIGlmIChuZXdUaXRsZSkgewogICAgICAgICAgICBhbGVydChgU3RyZWFtIHRpdGxlIChzaW11bGF0ZWQpIHVwZGF0ZWQgdG86ICIke25ld1RpdGxlfSJgKTsKICAgICAgICAgICAgc3RyZWFtVGl0bGVJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCBgQUkgT3ZlcmxvcmQ6IFN0cmVhbSB0aXRsZSB1cGRhdGVkIHRvICIke25ld1RpdGxlfSIuYCwgImNoYXQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2UgZW50ZXIgYSB0aXRsZS4iKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoc2VuZEFubm91bmNlbWVudEJ1dHRvbiAmJiBjaGF0QW5ub3VuY2VtZW50SW5wdXQpIHsKICAgIHNlbmRBbm5vdW5jZW1lbnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VuZCBhbm5vdW5jZW1lbnRzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFubm91bmNlbWVudCA9IGNoYXRBbm5vdW5jZW1lbnRJbnB1dC52YWx1ZTsKICAgICAgICBpZiAoYW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgIGFkZFNhbXBsZUNoYXRNZXNzYWdlKCJBSSBPdmVybG9yZCAoQW5ub3VuY2VtZW50KSIsIGFubm91bmNlbWVudCk7CiAgICAgICAgICAgIGNoYXRBbm5vdW5jZW1lbnRJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBlbnRlciBhbiBhbm5vdW5jZW1lbnQuIik7CiAgICAgICAgfQogICAgfSk7Cn0KaWYgKHRha2VTY3JlZW5zaG90QnV0dG9uKSB7CiAgICB0YWtlU2NyZWVuc2hvdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB0YWtlIHNjcmVlbnNob3RzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGFsZXJ0KCJTY3JlZW5zaG90IGNhcHR1cmVkISAoU2ltdWxhdGVkKSIpOwogICAgICAgIGFwcGVuZFRvTG9nKGNoYXRPdXRwdXQsICJBSSBPdmVybG9yZDogU2NyZWVuc2hvdCBjYXB0dXJlZCBhbmQgc2F2ZWQhIiwgImNoYXQiKTsKICAgIH0pOwp9CnNjZW5lQnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7CiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gY2hhbmdlIHNjZW5lcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBzY2VuZU5hbWUgPSBidXR0b24uZGF0YXNldC5zY2VuZU5hbWU7CiAgICAgICAgYWxlcnQoYFN3aXRjaGVkIHRvIE9CUyBTY2VuZTogJHtzY2VuZU5hbWV9IChTaW11bGF0ZWQpYCk7CiAgICAgICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgYEFJIE92ZXJsb3JkOiBTd2l0Y2hlZCB0byBzY2VuZSAiJHtzY2VuZU5hbWV9Ii5gLCAiY2hhdCIpOwogICAgfSk7Cn0pOwovLyBBaXJwb3J0IEluZm8gTG9va3VwCmlmIChsb29rdXBBaXJwb3J0QnV0dG9uICYmIGljYW9JbnB1dCkgewogICAgbG9va3VwQWlycG9ydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byBsb29rdXAgYWlycG9ydCBpbmZvLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGljYW8gPSBpY2FvSW5wdXQudmFsdWUudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgaWYgKGljYW8gJiYgaWNhby5sZW5ndGggPj0gMyAmJiBpY2FvLmxlbmd0aCA8PSA0KSB7CiAgICAgICAgICAgIGlmIChhaXJwb3J0SW5mb0Rpc3BsYXkpCiAgICAgICAgICAgICAgICBhaXJwb3J0SW5mb0Rpc3BsYXkudGV4dENvbnRlbnQgPSBgRmV0Y2hpbmcgaW5mbyBmb3IgJHtpY2FvfS4uLmA7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBjaGVjayBhZ2FpbiBpbiBjYXNlIGJvdCBzdG9wcGVkCiAgICAgICAgICAgICAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIGFpcnBvcnRJbmZvRGlzcGxheS50ZXh0Q29udGVudCA9IGBTaW11bGF0ZWQgRGF0YSBmb3IgJHtpY2FvfTpcbk5hbWU6ICR7aWNhb30gSW50ZXJuYXRpb25hbCBBaXJwb3J0XG5Mb2NhdGlvbjogQ2l0eSwgQ291bnRyeVxuTUVUQVI6ICR7aWNhb30gMTAxMjUwWiAyNzAxMEtUIDk5OTkgU0NUMDMwIDI1LzE1IFExMDEyYDsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhbGVydCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgMyBvciA0IGxldHRlciBJQ0FPIGNvZGUuIik7CiAgICAgICAgfQogICAgfSk7Cn0KLy8gVHdpdGNoIENoYXQKZnVuY3Rpb24gYWRkU2FtcGxlQ2hhdE1lc3NhZ2UodXNlciwgbWVzc2FnZSkgewogICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IGA8c3Ryb25nPiR7dXNlcn06PC9zdHJvbmc+ICR7bWVzc2FnZX1gOwogICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgZm9ybWF0dGVkTWVzc2FnZSwgImNoYXQiKTsKfQppZiAoc2VuZEJvdE1lc3NhZ2VCdXR0b24gJiYgYm90Q2hhdElucHV0KSB7CiAgICBzZW5kQm90TWVzc2FnZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG5lZWRzIHRvIGJlIHJ1bm5pbmcgdG8gc2VuZCBtZXNzYWdlcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBtZXNzYWdlID0gYm90Q2hhdElucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICBpZiAobWVzc2FnZSkgewogICAgICAgICAgICBhZGRTYW1wbGVDaGF0TWVzc2FnZSgiQUkgT3ZlcmxvcmQgKE1hbnVhbCkiLCBtZXNzYWdlKTsKICAgICAgICAgICAgYm90Q2hhdElucHV0LnZhbHVlID0gJyc7CiAgICAgICAgfQogICAgfSk7CiAgICBib3RDaGF0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCAoZXZlbnQpID0+IHsKICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7CiAgICAgICAgICAgIGlmIChzZW5kQm90TWVzc2FnZUJ1dHRvbikKICAgICAgICAgICAgICAgIHNlbmRCb3RNZXNzYWdlQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgfQogICAgfSk7Cn0KLy8gUXVpY2sgU2V0dGluZ3MKZnVuY3Rpb24gdXBkYXRlS2V5U3RhdHVzRGlzcGxheShlbGVtZW50LCBpc1NldCwgaXNDcml0aWNhbCA9IHRydWUpIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2tleS1zdGF0dXMtc2V0JywgJ2tleS1zdGF0dXMtbm90LXNldCcsICdrZXktc3RhdHVzLW9wdGlvbmFsLW5vdC1zZXQnKTsKICAgIGlmIChpc1NldCkgewogICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSAi4pyTIFNldCI7CiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdrZXktc3RhdHVzLXNldCcpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaWYgKGlzQ3JpdGljYWwpIHsKICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9ICLimqDvuI8gTm90IFNldCI7CiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgna2V5LXN0YXR1cy1ub3Qtc2V0Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gIk5vdCBTZXQiOwogICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2tleS1zdGF0dXMtb3B0aW9uYWwtbm90LXNldCcpOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBwb3B1bGF0ZVF1aWNrU2V0dGluZ3MoKSB7CiAgICBpZiAoIXFzVm9pY2VQcmVmaXgpCiAgICAgICAgcmV0dXJuOwogICAgcXNWb2ljZVByZWZpeC50ZXh0Q29udGVudCA9ICJIZXkgT3ZlcmxvcmQiOwogICAgcXNWb2ljZUFjdGl2YXRpb24udGV4dENvbnRlbnQgPSAiaGV5IE92ZXJsb3JkLCBhc3Npc3RhbnQsIG92ZXJsb3JkIjsKICAgIHFzQWlQZXJzb25hbGl0eVByb21wdC50ZXh0Q29udGVudCA9ICJZb3UgYXJlIGFuIEFJIE92ZXJsb3JkIG1hbmFnaW5nIGEgZmxpZ2h0IHNpbXVsYXRpb24gVHdpdGNoIGNoYW5uZWwuIFlvdSBhcmUgc29tZXRpbWVzIGRyYW1hdGljLCBzb21ldGltZXMgYW5hbHl0aWNhbCwgYnV0IGFsd2F5cyBpbiBjb21tYW5kLiI7CiAgICAvLyBVcGRhdGUgQUkgTW9kZWwgZGlzcGxheSBpbiBRdWljayBTZXR0aW5ncwogICAgaWYgKHFzQWlNb2RlbCkgewogICAgICAgIGxldCBtb2RlbFRleHQgPSBjdXJyZW50QWlNb2RlbDsKICAgICAgICBpZiAoY3VycmVudEFpTW9kZWwgPT09ICJHZW1pbmkiKQogICAgICAgICAgICBtb2RlbFRleHQgKz0gIiAoQWN0aXZlKSI7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtb2RlbFRleHQgKz0gIiAoU2ltdWxhdGVkKSI7CiAgICAgICAgcXNBaU1vZGVsLnRleHRDb250ZW50ID0gbW9kZWxUZXh0OwogICAgfQogICAgcXNMYW5ndWFnZS50ZXh0Q29udGVudCA9ICJlbi1VUyI7CiAgICBpZiAocXNDb25maWdGaWxlKQogICAgICAgIHFzQ29uZmlnRmlsZS50ZXh0Q29udGVudCA9ICJjb25maWcueWFtbCI7CiAgICAvLyBTaW11bGF0ZSBBUEkga2V5IHN0YXR1c2VzCiAgICBjb25zdCBvcGVuQWlTZXQgPSAhIWFpOyAvLyBUcnVlIGlmICdhaScgKEdlbWluaSBjbGllbnQpIGlzIGluaXRpYWxpemVkCiAgICBjb25zdCBhaXJwb3J0QXBpU2V0ID0gZmFsc2U7IC8vIFNpbXVsYXRlIGFzIG5vdCBzZXQKICAgIGNvbnN0IGF6dXJlU3BlZWNoU2V0ID0gdHJ1ZTsgLy8gU2ltdWxhdGUgYXMgc2V0CiAgICBjb25zdCBzZW50cnlTZXQgPSBmYWxzZTsgLy8gU2ltdWxhdGUgYXMgbm90IHNldCAob3B0aW9uYWwpCiAgICB1cGRhdGVLZXlTdGF0dXNEaXNwbGF5KHFzT3BlbkFpQXBpS2V5U3RhdHVzLCBvcGVuQWlTZXQsIHRydWUpOwogICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0FpcnBvcnRBcGlLZXlTdGF0dXMsIGFpcnBvcnRBcGlTZXQsIHRydWUpOwogICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0F6dXJlU3BlZWNoS2V5U3RhdHVzLCBhenVyZVNwZWVjaFNldCwgdHJ1ZSk7CiAgICB1cGRhdGVLZXlTdGF0dXNEaXNwbGF5KHFzU2VudHJ5U3RhdHVzLCBzZW50cnlTZXQsIGZhbHNlKTsKICAgIHFzVmVyYm9zZUxvZ2dpbmcudGV4dENvbnRlbnQgPSAiRmFsc2UiOwogICAgY29uc3QgY3VycmVudExvZ0xldmVsID0gIklORk8iOyAvLyBEZWZhdWx0IG9yIGZyb20gLmVudgogICAgcXNMb2dMZXZlbC50ZXh0Q29udGVudCA9IGN1cnJlbnRMb2dMZXZlbDsKICAgIGlmIChzZXRMb2dMZXZlbFNlbGVjdCkKICAgICAgICBzZXRMb2dMZXZlbFNlbGVjdC52YWx1ZSA9IGN1cnJlbnRMb2dMZXZlbDsKfQpmdW5jdGlvbiBjbGVhclF1aWNrU2V0dGluZ3MoKSB7CiAgICBjb25zdCB0ZXh0RmllbGRzVG9SZXNldCA9IFsKICAgICAgICBxc1ZvaWNlUHJlZml4LCBxc1ZvaWNlQWN0aXZhdGlvbiwgcXNBaVBlcnNvbmFsaXR5UHJvbXB0LCBxc0FpTW9kZWwsCiAgICAgICAgcXNMYW5ndWFnZSwgcXNDb25maWdGaWxlLCBxc1ZlcmJvc2VMb2dnaW5nLCBxc0xvZ0xldmVsCiAgICBdOwogICAgdGV4dEZpZWxkc1RvUmVzZXQuZm9yRWFjaChmaWVsZCA9PiB7CiAgICAgICAgaWYgKGZpZWxkKSB7CiAgICAgICAgICAgIGZpZWxkLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICAgICAgfQogICAgfSk7CiAgICAvLyBVc2UgdXBkYXRlS2V5U3RhdHVzRGlzcGxheSBmb3IgQVBJIGtleSBzdGF0dXNlcyB0byBzaG93ICJOb3QgU2V0IiBzdGF0ZQogICAgaWYgKHFzT3BlbkFpQXBpS2V5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNPcGVuQWlBcGlLZXlTdGF0dXMsIGZhbHNlLCB0cnVlKTsKICAgIGlmIChxc0FpcnBvcnRBcGlLZXlTdGF0dXMpCiAgICAgICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0FpcnBvcnRBcGlLZXlTdGF0dXMsIGZhbHNlLCB0cnVlKTsKICAgIGlmIChxc0F6dXJlU3BlZWNoS2V5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNBenVyZVNwZWVjaEtleVN0YXR1cywgZmFsc2UsIHRydWUpOwogICAgaWYgKHFzU2VudHJ5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNTZW50cnlTdGF0dXMsIGZhbHNlLCBmYWxzZSk7CiAgICBpZiAoc2V0TG9nTGV2ZWxTZWxlY3QpCiAgICAgICAgc2V0TG9nTGV2ZWxTZWxlY3QudmFsdWUgPSAiSU5GTyI7CiAgICBpZiAobG9nTGV2ZWxTdGF0dXMpCiAgICAgICAgbG9nTGV2ZWxTdGF0dXMudGV4dENvbnRlbnQgPSAiIjsKfQppZiAoYXBwbHlMb2dMZXZlbEJ1dHRvbiAmJiBzZXRMb2dMZXZlbFNlbGVjdCAmJiBxc0xvZ0xldmVsICYmIGxvZ0xldmVsU3RhdHVzKSB7CiAgICBhcHBseUxvZ0xldmVsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGlmICghaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgICAgIHNldFN0YXR1c01lc3NhZ2UobG9nTGV2ZWxTdGF0dXMsICJCb3QgbXVzdCBiZSBydW5uaW5nIHRvIGNoYW5nZSBsb2cgbGV2ZWwuIiwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3TGV2ZWwgPSBzZXRMb2dMZXZlbFNlbGVjdC52YWx1ZTsKICAgICAgICBxc0xvZ0xldmVsLnRleHRDb250ZW50ID0gbmV3TGV2ZWw7CiAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb2dMZXZlbFN0YXR1cywgYExvZyBsZXZlbCBzZXQgdG8gJHtuZXdMZXZlbH0gKFNpbXVsYXRlZCkuYCwgJ3N1Y2Nlc3MnKTsKICAgIH0pOwp9Ci8vIEluaXRpYWwgU2V0dXAKZnVuY3Rpb24gaW5pdGlhbGl6ZURhc2hib2FyZCgpIHsKICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihib3RTdGF0dXNJbmRpY2F0b3IsIGZhbHNlLCAiUnVubmluZyIsICJTdG9wcGVkIik7CiAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3IodHdpdGNoU3RhdHVzSW5kaWNhdG9yLCBmYWxzZSk7CiAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3Ioc3RyZWFtZXJib3RTdGF0dXNJbmRpY2F0b3IsIGZhbHNlKTsKICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihsbm1TdGF0dXNJbmRpY2F0b3IsIGZhbHNlKTsKICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5LnRleHRDb250ZW50ID0gIkRpc2FibGVkIjsKICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcihmYWxzZSk7CiAgICBpZiAoYWlNb29kRGlzcGxheSkKICAgICAgICBhaU1vb2REaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICAvLyBTZXQgaW5pdGlhbCBBSSBNb2RlbCBhbmQgUGVyc29uYWxpdHkgRGlzcGxheQogICAgaWYgKGFpTW9kZWxTZWxlY3QpIHsKICAgICAgICBhaU1vZGVsU2VsZWN0LnZhbHVlID0gY3VycmVudEFpTW9kZWw7CiAgICAgICAgYWlNb2RlbFNlbGVjdC5kaXNhYmxlZCA9IGZhbHNlOyAvLyBFbmFibGUgbW9kZWwgc2VsZWN0aW9uIHdoZW4gYm90IGlzIHN0b3BwZWQKICAgIH0KICAgIHVwZGF0ZUFpUGVyc29uYWxpdHlEaXNwbGF5KCk7CiAgICBpZiAoYWlGbGlnaHRDb250ZXh0RGlzcGxheSkKICAgICAgICBhaUZsaWdodENvbnRleHREaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBjb25zdCBpbml0aWFsRGlzYWJsZUNvbnRyb2xzID0gWwogICAgICAgIGN5Y2xlTW9vZEJ1dHRvbiwgcmVxdWVzdFN0YXR1c1JlcG9ydEJ1dHRvbiwgdG9nZ2xlVHRzQnV0dG9uLAogICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLCBzYXZlQWlTZXR0aW5nc0J1dHRvbiwgYW5hbHl6ZUZ1ZWxCdXR0b24sCiAgICAgICAgbG95YWx0eUZpbmRVc2VyQnV0dG9uLCBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24sIGFwcGx5TG9nTGV2ZWxCdXR0b24KICAgIF07CiAgICBpbml0aWFsRGlzYWJsZUNvbnRyb2xzLmZvckVhY2goYnRuID0+IHsgaWYgKGJ0bikKICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOyB9KTsKICAgIHVwZGF0ZVN1Z2dlc3REZWNyZWVCdXR0b25TdGF0ZSgpOyAvLyBDZW50cmFsaXplZCB1cGRhdGUKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250ZXh0LWJ1dHRvbicpLmZvckVhY2goYnRuID0+IGJ0bi5kaXNhYmxlZCA9IHRydWUpOwogICAgY2xlYXJRdWlja1NldHRpbmdzKCk7IC8vIENsZWFycyBhbmQgc2V0cyBBUEkga2V5cyB0byAiTm90IFNldCIgdmlhIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkKICAgIGNsZWFyVm9pY2VEZXRhaWxzKCk7CiAgICBjbGVhckZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgY2xlYXJEZWNyZWVMb3lhbHR5RGV0YWlscygpOwogICAgY2xlYXJTeXN0ZW1IZWFsdGhNZXRyaWNzKCk7CiAgICBjbGVhckxveWFsdHlFeHBsb3JlcigpOwogICAgc2V0UGxhY2Vob2xkZXIodm9pY2VMb2dPdXRwdXQsICJWb2ljZSBjb21tYW5kIGFjdGl2aXR5IHdpbGwgYXBwZWFyIGhlcmUuLi4iKTsKICAgIHNldFBsYWNlaG9sZGVyKGNoYXRPdXRwdXQsICJUd2l0Y2ggY2hhdCBtZXNzYWdlcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVzTGlzdCwgIk5vIGRlY3JlZXMgaXNzdWVkLiIpOwogICAgaWYgKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSkgewogICAgICAgIHNldFBsYWNlaG9sZGVyKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSwgIkRlY3JlZSBpZGVhcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CiAgICBzZXRQbGFjZWhvbGRlcihtb29kTG9nT3V0cHV0LCAiTW9vZCBjaGFuZ2VzIHdpbGwgYXBwZWFyIGhlcmUuLi4iKTsKICAgIHNldFBsYWNlaG9sZGVyKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgbWlsZXN0b25lcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICBzZXRQbGFjZWhvbGRlcihhdmFpbGFibGVDb21tYW5kc0xpc3QsICdObyBjb21tYW5kcyBsb2FkZWQuJyk7CiAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgIGFpcnBvcnRJbmZvRGlzcGxheS50ZXh0Q29udGVudCA9ICdBaXJwb3J0IGRhdGEgd2lsbCBhcHBlYXIgaGVyZS4uLic7CiAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgd2VhdGhlckRpc3BsYXkudGV4dENvbnRlbnQgPSAnTUVUQVIgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgIHNldFBsYWNlaG9sZGVyKGRpYWdub3N0aWNzTG9nT3V0cHV0LCAiRGlhZ25vc3RpYyB0ZXN0IHJlc3VsdHMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgaWYgKGNvbmZpZ0VkaXRvclRleHRhcmVhKQogICAgICAgIGNvbmZpZ0VkaXRvclRleHRhcmVhLnZhbHVlID0gZGVmYXVsdENvbmZpZ1lhbWw7CiAgICBpZiAoY29uZmlnRWRpdG9yU3RhdHVzKQogICAgICAgIGNvbmZpZ0VkaXRvclN0YXR1cy50ZXh0Q29udGVudCA9ICcnOwogICAgaWYgKGxveWFsdHlFeHBsb3JlclN0YXR1cykKICAgICAgICBsb3lhbHR5RXhwbG9yZXJTdGF0dXMudGV4dENvbnRlbnQgPSAnJzsKICAgIGlmIChsb2dMZXZlbFN0YXR1cykKICAgICAgICBsb2dMZXZlbFN0YXR1cy50ZXh0Q29udGVudCA9ICcnOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcgJiYgY2hhdE91dHB1dCkKICAgICAgICAgICAgYWRkU2FtcGxlQ2hhdE1lc3NhZ2UoIlN0cmVhbVZpZXdlcjEyMyIsICJIZWxsbyBPdmVybG9yZCEgR3JlYXQgc3RyZWFtISIpOwogICAgfSwgMjAwMCk7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZyAmJiBjaGF0T3V0cHV0KQogICAgICAgICAgICBhZGRTYW1wbGVDaGF0TWVzc2FnZSgiQW5vdGhlckZhbiIsICIhc3RhdHVzIik7CiAgICB9LCA0MDAwKTsKICAgIC8vIFBvcHVsYXRlIHF1aWNrIHNldHRpbmdzIG9uIGluaXRpYWwgbG9hZCBhcyB3ZWxsIHRvIHJlZmxlY3QgZGVmYXVsdCBBSSBtb2RlbCBhbmQgQVBJIGtleSBzdGF0dXMKICAgIHBvcHVsYXRlUXVpY2tTZXR0aW5ncygpOwogICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7IC8vIEVuc3VyZSBidXR0b24gc3RhdGUgaXMgY29ycmVjdCBvbiBpbml0Cn0KLy8gLS0tIE1haW4gLS0tCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0aWFsaXplRGFzaGJvYXJkKTsK","@":"data:application/javascript;base64,LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDI1IEdvb2dsZSBMTEMKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAKICovCmltcG9ydCB7IEdvb2dsZUdlbkFJIH0gZnJvbSAiQGdvb2dsZS9nZW5haSI7Ci8vIC0tLSBET00gRWxlbWVudCBSZWZlcmVuY2VzIC0tLQovLyBTdGF0dXMgQmFyCmNvbnN0IGJvdFN0YXR1c0luZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3Qtc3RhdHVzLWluZGljYXRvcicpOwpjb25zdCB0d2l0Y2hTdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHdpdGNoLXN0YXR1cy1pbmRpY2F0b3InKTsKY29uc3Qgc3RyZWFtZXJib3RTdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtZXJib3Qtc3RhdHVzLWluZGljYXRvcicpOwpjb25zdCBsbm1TdGF0dXNJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG5tLXN0YXR1cy1pbmRpY2F0b3InKTsKLy8gQm90IENvbnRyb2wKY29uc3QgdG9nZ2xlQm90QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1ib3QtYnV0dG9uJyk7CmNvbnN0IGN5Y2xlTW9vZEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjeWNsZS1tb29kLWJ1dHRvbicpOwpjb25zdCByZXF1ZXN0U3RhdHVzUmVwb3J0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcXVlc3Qtc3RhdHVzLXJlcG9ydC1idXR0b24nKTsKY29uc3QgYWlNb2RlbFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaS1tb2RlbC1zZWxlY3QnKTsKY29uc3QgYWlNb29kRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaS1tb29kJyk7CmNvbnN0IGFpUGVyc29uYWxpdHlEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpLXBlcnNvbmFsaXR5Jyk7CmNvbnN0IG1vb2RMb2dPdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9vZC1sb2ctb3V0cHV0Jyk7CmNvbnN0IGFpRmxpZ2h0Q29udGV4dERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWktZmxpZ2h0LWNvbnRleHQnKTsKY29uc3QgZmxpZ2h0Q29udGV4dEJ1dHRvbnNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxpZ2h0LWNvbnRleHQtYnV0dG9ucycpOwovLyBWb2ljZSBDb21tYW5kIENlbnRlcgpjb25zdCB0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS12b2ljZS1jb21tYW5kcy1idXR0b24nKTsKY29uc3Qgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvaWNlLXN5c3RlbS1zdGF0dXMnKTsKY29uc3QgdmFkU3RhdHVzSW5kaWNhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhZC1zdGF0dXMtaW5kaWNhdG9yJyk7CmNvbnN0IHZvaWNlTG9nT3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvaWNlLWxvZy1vdXRwdXQnKTsKLy8gVm9pY2UgU3lzdGVtIERldGFpbHMKY29uc3QgdmRzU3R0RW5naW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1zdHQtZW5naW5lJyk7CmNvbnN0IHZkc0xhbmd1YWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1sYW5ndWFnZScpOwpjb25zdCB2ZHNDb25maWRlbmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1jb25maWRlbmNlJyk7CmNvbnN0IHZkc1RpbWVvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXRpbWVvdXQnKTsKY29uc3QgdmRzUGhyYXNlTGltaXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBocmFzZS1saW1pdCcpOwpjb25zdCB2ZHNFbmVyZ3lUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLWVuZXJneS10aHJlc2hvbGQnKTsKY29uc3QgdmRzRHluYW1pY0VuZXJneSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZHMtZHluYW1pYy1lbmVyZ3knKTsKY29uc3QgdmRzUGF1c2VUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBhdXNlLXRocmVzaG9sZCcpOwpjb25zdCB2ZHNQaHJhc2VUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXBocmFzZS10aHJlc2hvbGQnKTsKY29uc3QgdmRzVmFkQWdncmVzc2l2ZW5lc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmRzLXZhZC1hZ2dyZXNzaXZlbmVzcycpOwpjb25zdCB2ZHNNaWNTYW1wbGVSYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1taWMtc2FtcGxlLXJhdGUnKTsKY29uc3QgdmRzTWljQ2h1bmtTaXplID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zkcy1taWMtY2h1bmstc2l6ZScpOwpjb25zdCB0b2dnbGVUdHNCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXR0cy1idXR0b24nKTsKY29uc3QgYXZhaWxhYmxlQ29tbWFuZHNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2YWlsYWJsZS1jb21tYW5kcy1saXN0Jyk7Ci8vIEZsaWdodCBEYXRhCmNvbnN0IGZkQ2FsbHNpZ24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtY2FsbHNpZ24nKTsKY29uc3QgZmRBaXJjcmFmdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZC1haXJjcmFmdCcpOwpjb25zdCBmZEFsdGl0dWRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWFsdGl0dWRlJyk7CmNvbnN0IGZkU3BlZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtc3BlZWQnKTsKY29uc3QgZmRIZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWhlYWRpbmcnKTsKY29uc3QgZmRWc3BlZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtdnNwZWVkJyk7CmNvbnN0IGZkUGhhc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtcGhhc2UnKTsKY29uc3QgZmROZXh0V3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtbmV4dC13cCcpOwpjb25zdCBmZEV0YU5leHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmQtZXRhLW5leHQnKTsKY29uc3QgZmRGdWVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZkLWZ1ZWwnKTsKY29uc3QgYW5hbHl6ZUZ1ZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZS1mdWVsLWJ1dHRvbicpOwovLyBGbGlnaHQgJiBBdXRvbWF0aW9uIEluc2lnaHRzCmNvbnN0IGZhTWlsZXN0b25lQWx0aXR1ZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhLW1pbGVzdG9uZS1hbHRpdHVkZXMnKTsKY29uc3QgZmFBdXRvU2NlbmVTdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmEtYXV0by1zY2VuZS1zdGF0dXMnKTsKY29uc3QgZmFXZWF0aGVySW50ZXJ2YWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmEtd2VhdGhlci1pbnRlcnZhbCcpOwpjb25zdCBmbGlnaHRNaWxlc3RvbmVzTG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZsaWdodC1taWxlc3RvbmVzLWxvZycpOwovLyBTeXN0ZW0gSGVhbHRoICYgTWV0cmljcwpjb25zdCBtZXRyaWNzU3lzdGVtU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3Mtc3lzdGVtLXN0YXR1cycpOwpjb25zdCBtZXRyaWNzVm9pY2VRdWV1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRyaWNzLXZvaWNlLXF1ZXVlJyk7CmNvbnN0IG1ldHJpY3NMYXN0Vm9pY2VDbWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0cmljcy1sYXN0LXZvaWNlLWNtZCcpOwpjb25zdCBtZXRyaWNzRGJDb25uZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3MtZGItY29ubmVjdGlvbicpOwpjb25zdCBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldHJpY3Mtc2VudHJ5LXJlcG9ydGluZycpOwovLyBDb25maWcgRWRpdG9yCmNvbnN0IGNvbmZpZ0VkaXRvclRleHRhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZy1lZGl0b3ItdGV4dGFyZWEnKTsKY29uc3QgY29uZmlnRWRpdG9yU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZy1lZGl0b3Itc3RhdHVzJyk7CmNvbnN0IGxvYWREZWZhdWx0Q29uZmlnQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWQtZGVmYXVsdC1jb25maWctYnV0dG9uJyk7CmNvbnN0IHNhdmVDb25maWdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1jb25maWctYnV0dG9uJyk7Ci8vIERpYWdub3N0aWNzICYgVGVzdGluZwpjb25zdCBkaWFnVGVzdFR3aXRjaEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRlc3QtdHdpdGNoLWJ1dHRvbicpOwpjb25zdCBkaWFnVGVzdFN0cmVhbWVyYm90QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWctdGVzdC1zdHJlYW1lcmJvdC1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RMbm1CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LWxubS1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RPcGVuYWlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LW9wZW5haS1idXR0b24nKTsKY29uc3QgZGlhZ1Rlc3RUdHNCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy10ZXN0LXR0cy1idXR0b24nKTsKY29uc3QgZGlhZ1ZvaWNlSW50ZW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhZy12b2ljZS1pbnRlbnQtaW5wdXQnKTsKY29uc3QgZGlhZ0NsYXNzaWZ5SW50ZW50QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWctY2xhc3NpZnktaW50ZW50LWJ1dHRvbicpOwpjb25zdCBkaWFnVHJpZ2dlckRlY3JlZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRyaWdnZXItZGVjcmVlLWJ1dHRvbicpOwpjb25zdCBkaWFnVHJpZ2dlck1pbGVzdG9uZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnLXRyaWdnZXItbWlsZXN0b25lLWJ1dHRvbicpOwpjb25zdCBkaWFnbm9zdGljc0xvZ091dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFnbm9zdGljcy1sb2ctb3V0cHV0Jyk7Ci8vIFdlYXRoZXIKY29uc3QgZmV0Y2hXZWF0aGVyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZldGNoLXdlYXRoZXItYnV0dG9uJyk7CmNvbnN0IHdlYXRoZXJEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlYXRoZXItZGlzcGxheScpOwovLyBEZWNyZWVzICYgTG95YWx0eQpjb25zdCBpc3N1ZURlY3JlZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpc3N1ZS1kZWNyZWUtYnV0dG9uJyk7CmNvbnN0IHN1Z2dlc3REZWNyZWVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VnZ2VzdC1kZWNyZWUtYnV0dG9uJyk7CmNvbnN0IGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWNyZWUtc3VnZ2VzdGlvbnMtYXJlYScpOwpjb25zdCB0b2dnbGVTZWFzb25hbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtc2Vhc29uYWwtYnV0dG9uJyk7CmNvbnN0IGRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbC1sb3lhbHR5LW11bHRpcGxpZXItaW5wdXQnKTsKY29uc3QgZGxEZWNyZWVDb29sZG93bklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RsLWRlY3JlZS1jb29sZG93bi1pbnB1dCcpOwpjb25zdCBzYXZlQWlTZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLWFpLXNldHRpbmdzLWJ1dHRvbicpOwpjb25zdCBkbFNlYXNvbmFsU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RsLXNlYXNvbmFsLXN0YXR1cycpOwpjb25zdCBkZWNyZWVzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWNyZWVzLWxpc3QnKTsKY29uc3QgbG95YWx0eUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS1saXN0Jyk7Ci8vIFVzZXIgTG95YWx0eSBFeHBsb3Jlcgpjb25zdCBsb3lhbHR5U2VhcmNoSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS1zZWFyY2gtaW5wdXQnKTsKY29uc3QgbG95YWx0eUZpbmRVc2VyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktZmluZC11c2VyLWJ1dHRvbicpOwpjb25zdCBsb3lhbHR5VXNlck5hbWVEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1uYW1lJyk7CmNvbnN0IGxveWFsdHlVc2VyU2NvcmVEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1zY29yZScpOwpjb25zdCBsb3lhbHR5VXNlclJhbmtEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xveWFsdHktdXNlci1yYW5rJyk7CmNvbnN0IGxveWFsdHlVc2VyTGFzdEludGVyYWN0aW9uRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LXVzZXItbGFzdC1pbnRlcmFjdGlvbicpOwpjb25zdCBsb3lhbHR5QWRqdXN0U2NvcmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LWFkanVzdC1zY29yZS1pbnB1dCcpOwpjb25zdCBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG95YWx0eS11cGRhdGUtc2NvcmUtYnV0dG9uJyk7CmNvbnN0IGxveWFsdHlFeHBsb3JlclN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb3lhbHR5LWV4cGxvcmVyLXN0YXR1cycpOwovLyBTdHJlYW0gQXV0b21hdGlvbgpjb25zdCBzdHJlYW1UaXRsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVhbS10aXRsZS1pbnB1dCcpOwpjb25zdCB1cGRhdGVUaXRsZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGRhdGUtdGl0bGUtYnV0dG9uJyk7CmNvbnN0IGNoYXRBbm5vdW5jZW1lbnRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWFubm91bmNlbWVudC1pbnB1dCcpOwpjb25zdCBzZW5kQW5ub3VuY2VtZW50QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbmQtYW5ub3VuY2VtZW50LWJ1dHRvbicpOwpjb25zdCB0YWtlU2NyZWVuc2hvdEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWtlLXNjcmVlbnNob3QtYnV0dG9uJyk7CmNvbnN0IHNjZW5lQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY2VuZS1idXR0b24nKTsKLy8gQWlycG9ydCBJbmZvIExvb2t1cApjb25zdCBpY2FvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNhby1pbnB1dCcpOwpjb25zdCBsb29rdXBBaXJwb3J0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvb2t1cC1haXJwb3J0LWJ1dHRvbicpOwpjb25zdCBhaXJwb3J0SW5mb0Rpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlycG9ydC1pbmZvLWRpc3BsYXknKTsKLy8gVHdpdGNoIENoYXQKY29uc3QgY2hhdE91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LW91dHB1dCcpOwpjb25zdCBib3RDaGF0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm90LWNoYXQtaW5wdXQnKTsKY29uc3Qgc2VuZEJvdE1lc3NhZ2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZC1ib3QtbWVzc2FnZS1idXR0b24nKTsKLy8gUXVpY2sgU2V0dGluZ3MKY29uc3QgcXNWb2ljZVByZWZpeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy12b2ljZS1wcmVmaXgnKTsKY29uc3QgcXNWb2ljZUFjdGl2YXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtdm9pY2UtYWN0aXZhdGlvbicpOwpjb25zdCBxc0FpUGVyc29uYWxpdHlQcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtYWktcGVyc29uYWxpdHktcHJvbXB0Jyk7CmNvbnN0IHFzQWlNb2RlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1haS1tb2RlbCcpOwpjb25zdCBxc0xhbmd1YWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FzLWxhbmd1YWdlJyk7CmNvbnN0IHFzQ29uZmlnRmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1jb25maWctZmlsZScpOwpjb25zdCBxc09wZW5BaUFwaUtleVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1vcGVuYWktYXBpLWtleS1zdGF0dXMnKTsKY29uc3QgcXNBaXJwb3J0QXBpS2V5U3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FzLWFpcnBvcnQtYXBpLWtleS1zdGF0dXMnKTsKY29uc3QgcXNBenVyZVNwZWVjaEtleVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1henVyZS1zcGVlY2gta2V5LXN0YXR1cycpOwpjb25zdCBxc1NlbnRyeVN0YXR1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcy1zZW50cnktc3RhdHVzJyk7CmNvbnN0IHFzVmVyYm9zZUxvZ2dpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtdmVyYm9zZS1sb2dnaW5nJyk7CmNvbnN0IHFzTG9nTGV2ZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXMtbG9nLWxldmVsJyk7CmNvbnN0IHNldExvZ0xldmVsU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldC1sb2ctbGV2ZWwnKTsKY29uc3QgYXBwbHlMb2dMZXZlbEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBseS1sb2ctbGV2ZWwtYnV0dG9uJyk7CmNvbnN0IGxvZ0xldmVsU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZy1sZXZlbC1zdGF0dXMnKTsKLy8gR2VtaW5pIEFQSQpsZXQgYWkgPSBudWxsOwp0cnkgewogICAgaWYgKHByb2Nlc3MuZW52LkFQSV9LRVkpIHsKICAgICAgICBhaSA9IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuQVBJX0tFWSB9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBub3QgZm91bmQuIEdlbWluaSBBUEkgZmVhdHVyZXMgd2lsbCBiZSBkaXNhYmxlZC4iKTsKICAgICAgICBpZiAoZGlhZ1Rlc3RPcGVuYWlCdXR0b24pCiAgICAgICAgICAgIGRpYWdUZXN0T3BlbmFpQnV0dG9uLnRpdGxlID0gIkdlbWluaSBBUEkgS2V5IG5vdCBzZXQgaW4gZW52aXJvbm1lbnQiOwogICAgfQp9CmNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW5pdGlhbGl6aW5nIEdvb2dsZUdlbkFJOiIsIGVycm9yKTsKICAgIGFpID0gbnVsbDsKICAgIGlmIChkaWFnVGVzdE9wZW5haUJ1dHRvbikKICAgICAgICBkaWFnVGVzdE9wZW5haUJ1dHRvbi50aXRsZSA9ICJFcnJvciBpbml0aWFsaXppbmcgR2VtaW5pIEFQSSI7Cn0KLy8gLS0tIFN0YXRlIFZhcmlhYmxlcyAtLS0KbGV0IGlzQm90UnVubmluZyA9IGZhbHNlOwpsZXQgaXNWb2ljZUVuYWJsZWQgPSBmYWxzZTsKbGV0IGlzVHRzRW5hYmxlZCA9IGZhbHNlOwpsZXQgaXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPSBmYWxzZTsKY29uc3QgYWlNb29kcyA9IFsiQW5hbHl0aWNhbCIsICJEcmFtYXRpYyIsICJBbXVzZWQiLCAiSW1wYXRpZW50Il07CmxldCBjdXJyZW50TW9vZEluZGV4ID0gMDsKbGV0IGN1cnJlbnRBaU1vZGVsID0gIkdlbWluaSI7IC8vIERlZmF1bHQgQUkgTW9kZWwKY29uc3Qgdm9pY2VTeXN0ZW1TdGF0ZXMgPSBbIkxJU1RFTklORyIsICJQUk9DRVNTSU5HIiwgIkVYRUNVVElORyIsICJDT09MRE9XTiIsICJFUlJPUiJdOwpsZXQgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IDA7CmNvbnN0IGZsaWdodENvbnRleHRzID0gWyJHcm91bmQiLCAiVGF4aSIsICJDbGltYiIsICJDcnVpc2UiLCAiRGVzY2VudCIsICJBcHByb2FjaCIsICJMYW5kaW5nIl07CmxldCBjdXJyZW50RmxpZ2h0Q29udGV4dEluZGV4ID0gMDsKbGV0IGN1cnJlbnRMb3lhbHR5VXNlciA9IG51bGw7CmNvbnN0IGRlZmF1bHRDb25maWdZYW1sID0gYHBlcnNvbmFsaXR5OgogIGRlZmF1bHRfbW9vZDogImFuYWx5dGljYWwiCiAgbG95YWx0eV9tdWx0aXBsaWVyOiAxLjUKICBkZWNyZWVfY29vbGRvd246IDMwMCAjIHNlY29uZHMKCnZvaWNlOgogIGFjdGl2YXRpb25fcGhyYXNlczoKICAgIC0gIm92ZXJsb3JkIgogICAgLSAiaGV5IG92ZXJsb3JkIgogICAgLSAiYWkgb3ZlcmxvcmQiCiAgY29tbWFuZF90aW1lb3V0OiA1LjAgIyBzZWNvbmRzIGZvciBTVFQgdG8gd2FpdCBmb3IgcGhyYXNlCiAgcGhyYXNlX2xpbWl0OiAxMC4wICMgbWF4IGR1cmF0aW9uIG9mIGEgdm9pY2UgY29tbWFuZAoKZmxpZ2h0X2ludGVncmF0aW9uOgogIG1pbGVzdG9uZV9hbm5vdW5jZW1lbnRzOiB0cnVlCiAgYWx0aXR1ZGVfdGhyZXNob2xkczogWzEwMDAsIDUwMDAsIDEwMDAwLCAxODAwMCwgMzUwMDBdICMgZmVldAogIHdlYXRoZXJfdXBkYXRlX2ludGVydmFsOiAzMDAgIyBzZWNvbmRzCmA7Ci8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQpmdW5jdGlvbiB1cGRhdGVTdGF0dXNJbmRpY2F0b3IoZWxlbWVudCwgaXNPbmxpbmUsIG9ubGluZVRleHQgPSAiT25saW5lIiwgb2ZmbGluZVRleHQgPSAiT2ZmbGluZSIpIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LnRleHRDb250ZW50ID0gaXNPbmxpbmUgPyBvbmxpbmVUZXh0IDogb2ZmbGluZVRleHQ7CiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGlzT25saW5lID8gJ3N0YXR1cy1vbmxpbmUnIDogJ3N0YXR1cy1vZmZsaW5lJzsKfQpmdW5jdGlvbiB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoaXNBY3RpdmUpIHsKICAgIGlmICghdmFkU3RhdHVzSW5kaWNhdG9yKQogICAgICAgIHJldHVybjsKICAgIHZhZFN0YXR1c0luZGljYXRvci50ZXh0Q29udGVudCA9IGlzQWN0aXZlID8gIkFjdGl2ZSIgOiAiSW5hY3RpdmUiOwogICAgdmFkU3RhdHVzSW5kaWNhdG9yLmNsYXNzTmFtZSA9IGlzQWN0aXZlID8gJ3N0YXR1cy12YWQtYWN0aXZlJyA6ICdzdGF0dXMtdmFkLWluYWN0aXZlJzsKfQpmdW5jdGlvbiBhcHBlbmRUb0xvZyhsb2dFbGVtZW50LCBtZXNzYWdlLCB0eXBlID0gJ2luZm8nKSB7CiAgICBpZiAoIWxvZ0VsZW1lbnQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgcGxhY2Vob2xkZXIgPSBsb2dFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2ctcGxhY2Vob2xkZXInKTsKICAgIGlmIChwbGFjZWhvbGRlcikgewogICAgICAgIHBsYWNlaG9sZGVyLnJlbW92ZSgpOwogICAgfQogICAgY29uc3QgbG9nRW50cnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGxvZ0VudHJ5LmNsYXNzTGlzdC5hZGQoJ2xvZy1lbnRyeScsIGBsb2ctZW50cnktJHt0eXBlfWApOwogICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKTsKICAgIGxvZ0VudHJ5LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGltZXN0YW1wIj5bJHt0aW1lc3RhbXB9XTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImxvZy1tZXNzYWdlIj4ke21lc3NhZ2V9PC9zcGFuPmA7CiAgICBsb2dFbGVtZW50LmFwcGVuZENoaWxkKGxvZ0VudHJ5KTsKICAgIGxvZ0VsZW1lbnQuc2Nyb2xsVG9wID0gbG9nRWxlbWVudC5zY3JvbGxIZWlnaHQ7IC8vIEF1dG8tc2Nyb2xsCn0KZnVuY3Rpb24gYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhtZXNzYWdlLCB0eXBlID0gJ3Rlc3QtaW5mbycpIHsKICAgIGlmICghZGlhZ25vc3RpY3NMb2dPdXRwdXQpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgcGxhY2Vob2xkZXIgPSBkaWFnbm9zdGljc0xvZ091dHB1dC5xdWVyeVNlbGVjdG9yKCcubG9nLXBsYWNlaG9sZGVyJyk7CiAgICBpZiAocGxhY2Vob2xkZXIpIHsKICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmUoKTsKICAgIH0KICAgIGNvbnN0IGxvZ0VudHJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBsb2dFbnRyeS5jbGFzc0xpc3QuYWRkKCdsb2ctZW50cnknKTsgLy8gR2VuZXJhbCBjbGFzcwogICAgaWYgKHR5cGUgPT09ICd0ZXN0LXN1Y2Nlc3MnKSB7CiAgICAgICAgbG9nRW50cnkuY2xhc3NMaXN0LmFkZCgnbG9nLXN1Y2Nlc3MnKTsKICAgIH0KICAgIGVsc2UgaWYgKHR5cGUgPT09ICd0ZXN0LWZhaWx1cmUnKSB7CiAgICAgICAgbG9nRW50cnkuY2xhc3NMaXN0LmFkZCgnbG9nLWVycm9yJyk7CiAgICB9CiAgICBlbHNlIHsgLy8gJ3Rlc3QtaW5mbycKICAgICAgICBsb2dFbnRyeS5jbGFzc0xpc3QuYWRkKCdsb2ctaW5mbycpOwogICAgfQogICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKTsKICAgIGxvZ0VudHJ5LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGltZXN0YW1wIj5bJHt0aW1lc3RhbXB9XTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImxvZy1tZXNzYWdlIj4ke21lc3NhZ2V9PC9zcGFuPmA7CiAgICBkaWFnbm9zdGljc0xvZ091dHB1dC5hcHBlbmRDaGlsZChsb2dFbnRyeSk7CiAgICBkaWFnbm9zdGljc0xvZ091dHB1dC5zY3JvbGxUb3AgPSBkaWFnbm9zdGljc0xvZ091dHB1dC5zY3JvbGxIZWlnaHQ7Cn0KZnVuY3Rpb24gc2V0UGxhY2Vob2xkZXIobG9nRWxlbWVudCwgdGV4dCkgewogICAgaWYgKCFsb2dFbGVtZW50KQogICAgICAgIHJldHVybjsKICAgIGxvZ0VsZW1lbnQuaW5uZXJIVE1MID0gYDxsaSBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9saT5gOyAvLyBVc2UgPGxpPiBmb3IgVUwKICAgIGlmIChsb2dFbGVtZW50LnRhZ05hbWUgIT09ICdVTCcgJiYgbG9nRWxlbWVudC5pZCAhPT0gJ2RlY3JlZS1zdWdnZXN0aW9ucy1hcmVhJykgeyAvLyBGb3IgZGl2IGxvZ3MsIG5vdCBkZWNyZWUgc3VnZ2VzdGlvbnMKICAgICAgICBsb2dFbGVtZW50LmlubmVySFRNTCA9IGA8cCBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9wPmA7CiAgICB9CiAgICBlbHNlIGlmIChsb2dFbGVtZW50LmlkID09PSAnZGVjcmVlLXN1Z2dlc3Rpb25zLWFyZWEnICYmIGxvZ0VsZW1lbnQudGFnTmFtZSA9PT0gJ0RJVicpIHsKICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBkZWNyZWUgc3VnZ2VzdGlvbnMgYXJlYSBpZiBpdCdzIGEgZGl2IGNsZWFyZWQgdG8gcGxhY2Vob2xkZXIKICAgICAgICBsb2dFbGVtZW50LmlubmVySFRNTCA9IGA8cCBjbGFzcz0ibG9nLXBsYWNlaG9sZGVyIj4ke3RleHR9PC9wPmA7CiAgICB9Cn0KZnVuY3Rpb24gc2V0U3RhdHVzTWVzc2FnZShlbGVtZW50LCBtZXNzYWdlLCB0eXBlID0gJ3N1Y2Nlc3MnLCBkdXJhdGlvbiA9IDMwMDApIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTsKICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gYG1vZHVsZS1zdGF0dXMtbWVzc2FnZSAke3R5cGV9YDsKICAgIGlmIChkdXJhdGlvbiA+IDApIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9ICcnOwogICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICdtb2R1bGUtc3RhdHVzLW1lc3NhZ2UnOwogICAgICAgIH0sIGR1cmF0aW9uKTsKICAgIH0KfQpjb25zdCBzYW1wbGVWb2ljZUNvbW1hbmRzID0gWwogICAgewogICAgICAgIG5hbWU6ICJTZXQgQWx0aXR1ZGUiLAogICAgICAgIHRyaWdnZXI6ICJvdmVybG9yZCBzZXQgYWx0aXR1ZGUiLAogICAgICAgIGRlc2M6ICJTZXQgYXV0b3BpbG90IGFsdGl0dWRlIiwKICAgICAgICBhbGlhc2VzOiAic2V0IGFsdGl0dWRlLCBhbHRpdHVkZSB0byIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAic3RyZWFtZXIiLAogICAgICAgIGNvb2xkb3duOiAiMi4wcyIsCiAgICAgICAgZXhwZWN0ZWRQYXJhbWV0ZXJzOiBbeyBuYW1lOiAiYWx0aXR1ZGUiLCB0eXBlOiAibnVtYmVyIiwgZGVzY3JpcHRpb246ICJUYXJnZXQgYWx0aXR1ZGUgaW4gZmVldCIgfV0KICAgIH0sCiAgICB7CiAgICAgICAgbmFtZTogIlNldCBIZWFkaW5nIiwKICAgICAgICB0cmlnZ2VyOiAib3ZlcmxvcmQgc2V0IGhlYWRpbmciLAogICAgICAgIGRlc2M6ICJTZXQgYXV0b3BpbG90IGhlYWRpbmciLAogICAgICAgIGFsaWFzZXM6ICJzZXQgaGVhZGluZywgaGVhZGluZyB0bywgdHVybiB0byIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAic3RyZWFtZXIiLAogICAgICAgIGNvb2xkb3duOiAiMi4wcyIsCiAgICAgICAgZXhwZWN0ZWRQYXJhbWV0ZXJzOiBbeyBuYW1lOiAiaGVhZGluZyIsIHR5cGU6ICJudW1iZXIgKDAtMzU5KSIsIGRlc2NyaXB0aW9uOiAiVGFyZ2V0IGhlYWRpbmcgaW4gZGVncmVlcyIgfV0KICAgIH0sCiAgICB7CiAgICAgICAgbmFtZTogIkNvbnRhY3QgQVRDIiwKICAgICAgICB0cmlnZ2VyOiAib3ZlcmxvcmQgY29udGFjdCB0b3dlciIsCiAgICAgICAgZGVzYzogIkRpc3BsYXkgQVRDIGNvbnRhY3QgaW5mb3JtYXRpb24iLAogICAgICAgIGFsaWFzZXM6ICJjb250YWN0IGF0YywgY2FsbCB0b3dlciIsCiAgICAgICAgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwKICAgICAgICBjb29sZG93bjogIjUuMHMiLAogICAgICAgIGV4cGVjdGVkUGFyYW1ldGVyczogW3sgbmFtZTogImZhY2lsaXR5IiwgdHlwZTogInRleHQgKGUuZy4sIHRvd2VyLCBncm91bmQpIiwgZGVzY3JpcHRpb246ICJTcGVjaWZpYyBBVEMgZmFjaWxpdHkiIH1dCiAgICB9LAogICAgeyBuYW1lOiAiRmxpZ2h0IFN0YXR1cyIsIHRyaWdnZXI6ICJvdmVybG9yZCBmbGlnaHQgc3RhdHVzIiwgZGVzYzogIkRpc3BsYXkgZGV0YWlsZWQgZmxpZ2h0IHN0YXR1cyIsIGFsaWFzZXM6ICJzdGF0dXMgcmVwb3J0LCBmbGlnaHQgcmVwb3J0IiwgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwgY29vbGRvd246ICIzLjBzIiB9LAogICAgeyBuYW1lOiAiV2VhdGhlciBSZXBvcnQiLCB0cmlnZ2VyOiAib3ZlcmxvcmQgd2VhdGhlciByZXBvcnQiLCBkZXNjOiAiRGlzcGxheSBjdXJyZW50IHdlYXRoZXIiLCBhbGlhc2VzOiAid2VhdGhlciwgY3VycmVudCB3ZWF0aGVyIiwgcGVybWlzc2lvbkxldmVsOiAidmlld2VyIiwgY29vbGRvd246ICI1LjBzIiB9LAogICAgeyBuYW1lOiAiRW1lcmdlbmN5IiwgdHJpZ2dlcjogIm92ZXJsb3JkIGVtZXJnZW5jeSIsIGRlc2M6ICJUcmlnZ2VyIGVtZXJnZW5jeSBwcm9jZWR1cmVzIiwgYWxpYXNlczogIiIsIHBlcm1pc3Npb25MZXZlbDogInN0cmVhbWVyIiwgY29vbGRvd246ICIxMC4wcyIgfSwKICAgIHsgbmFtZTogIlNjcmVlbnNob3QiLCB0cmlnZ2VyOiAib3ZlcmxvcmQgc2NyZWVuc2hvdCIsIGRlc2M6ICJUYWtlIGFuZCBzaGFyZSBzY3JlZW5zaG90IiwgYWxpYXNlczogInRha2Ugc2NyZWVuc2hvdCwgY2FwdHVyZSBzY3JlZW4iLCBwZXJtaXNzaW9uTGV2ZWw6ICJtb2RlcmF0b3IiLCBjb29sZG93bjogIjUuMHMiIH0sCiAgICB7CiAgICAgICAgbmFtZTogIkNoYW5nZSBTY2VuZSIsCiAgICAgICAgdHJpZ2dlcjogIm92ZXJsb3JkIGNoYW5nZSBzY2VuZSIsCiAgICAgICAgZGVzYzogIkNoYW5nZSBPQlMgc2NlbmUiLAogICAgICAgIGFsaWFzZXM6ICJzd2l0Y2ggc2NlbmUsIGNoYW5nZSB2aWV3IiwKICAgICAgICBwZXJtaXNzaW9uTGV2ZWw6ICJzdHJlYW1lciIsCiAgICAgICAgY29vbGRvd246ICIxLjBzIiwKICAgICAgICBleHBlY3RlZFBhcmFtZXRlcnM6IFt7IG5hbWU6ICJzY2VuZV9uYW1lIiwgdHlwZTogInRleHQiLCBkZXNjcmlwdGlvbjogIk5hbWUgb2YgdGhlIE9CUyBzY2VuZSIgfV0KICAgIH0sCl07CmNvbnN0IHNhbXBsZUxveWFsdHlEYXRhID0gewogICAgIlN0cmVhbVZpZXdlcjEyMyI6IHsgbmFtZTogIlN0cmVhbVZpZXdlcjEyMyIsIHNjb3JlOiAxMjUwLCByYW5rOiAiRGlnaXRhbCBEaXNjaXBsZSIsIGxhc3RJbnRlcmFjdGlvbjogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDg2NDAwMDAwICogMikudG9Mb2NhbGVEYXRlU3RyaW5nKCkgfSwKICAgICJBbm90aGVyRmFuIjogeyBuYW1lOiAiQW5vdGhlckZhbiIsIHNjb3JlOiA3ODAsIHJhbms6ICJBY29seXRlIiwgbGFzdEludGVyYWN0aW9uOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gODY0MDAwMDAgKiAxKS50b0xvY2FsZURhdGVTdHJpbmcoKSB9LAogICAgIkxveWFsRm9sbG93ZXJYIjogeyBuYW1lOiAiTG95YWxGb2xsb3dlclgiLCBzY29yZTogNTAwLCByYW5rOiAiSW5pdGlhdGUiLCBsYXN0SW50ZXJhY3Rpb246IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgfSwKICAgICJOZXdiaWVVc2VyIjogeyBuYW1lOiAiTmV3YmllVXNlciIsIHNjb3JlOiA1MCwgcmFuazogIkRyb25lIiwgbGFzdEludGVyYWN0aW9uOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpIH0KfTsKZnVuY3Rpb24gZ2V0TG95YWx0eVJhbmsoc2NvcmUpIHsKICAgIGlmIChzY29yZSA+PSAxMDAwKQogICAgICAgIHJldHVybiAiRGlnaXRhbCBEaXNjaXBsZSI7CiAgICBpZiAoc2NvcmUgPj0gNzUwKQogICAgICAgIHJldHVybiAiQWNvbHl0ZSI7CiAgICBpZiAoc2NvcmUgPj0gNTAwKQogICAgICAgIHJldHVybiAiSW5pdGlhdGUiOwogICAgaWYgKHNjb3JlID49IDI1MCkKICAgICAgICByZXR1cm4gIkZvbGxvd2VyIjsKICAgIHJldHVybiAiRHJvbmUiOwp9CmZ1bmN0aW9uIHBvcHVsYXRlQXZhaWxhYmxlQ29tbWFuZHMoKSB7CiAgICBpZiAoIWF2YWlsYWJsZUNvbW1hbmRzTGlzdCkKICAgICAgICByZXR1cm47CiAgICBhdmFpbGFibGVDb21tYW5kc0xpc3QuaW5uZXJIVE1MID0gJyc7CiAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgIHNldFBsYWNlaG9sZGVyKGF2YWlsYWJsZUNvbW1hbmRzTGlzdCwgJ0JvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VlIGNvbW1hbmRzLicpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIHNhbXBsZVZvaWNlQ29tbWFuZHMuZm9yRWFjaChjbWQgPT4gewogICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsKICAgICAgICBsZXQgcGFyYW1zSHRtbCA9ICcnOwogICAgICAgIGlmIChjbWQuZXhwZWN0ZWRQYXJhbWV0ZXJzICYmIGNtZC5leHBlY3RlZFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXJhbXNIdG1sICs9IGA8ZGl2IGNsYXNzPSJjb21tYW5kLXBhcmFtZXRlcnMiPkV4cGVjdGVkIFBhcmFtZXRlcnM6PHVsPmA7CiAgICAgICAgICAgIGNtZC5leHBlY3RlZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIHBhcmFtc0h0bWwgKz0gYDxsaT48c3BhbiBjbGFzcz0icGFyYW1ldGVyLW5hbWUiPiR7cC5uYW1lfTwvc3Bhbj46IDxzcGFuIGNsYXNzPSJwYXJhbWV0ZXItdHlwZSI+JHtwLnR5cGV9PC9zcGFuPiR7cC5kZXNjcmlwdGlvbiA/IGAgKCR7cC5kZXNjcmlwdGlvbn0pYCA6ICcnfTwvbGk+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHBhcmFtc0h0bWwgKz0gYDwvdWw+PC9kaXY+YDsKICAgICAgICB9CiAgICAgICAgbGkuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8c3BhbiBjbGFzcz0iY29tbWFuZC10cmlnZ2VyIj4ke2NtZC50cmlnZ2VyfTwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbW1hbmQtZGVzY3JpcHRpb24iPiR7Y21kLmRlc2N9PC9zcGFuPgogICAgICAgICAgICAke2NtZC5hbGlhc2VzID8gYDxzcGFuIGNsYXNzPSJjb21tYW5kLWFsaWFzZXMiPkFsaWFzZXM6ICR7Y21kLmFsaWFzZXN9PC9zcGFuPmAgOiAnJ30KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tbWFuZC1kZXRhaWxzIj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC1sYWJlbCI+UGVybWlzc2lvbjo8L3NwYW4+IDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC12YWx1ZSI+JHtjbWQucGVybWlzc2lvbkxldmVsfTwvc3Bhbj4gfCAKICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjb21tYW5kLWRldGFpbC1sYWJlbCI+Q29vbGRvd246PC9zcGFuPiA8c3BhbiBjbGFzcz0iY29tbWFuZC1kZXRhaWwtdmFsdWUiPiR7Y21kLmNvb2xkb3dufTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICR7cGFyYW1zSHRtbH0KICAgICAgICBgOwogICAgICAgIGF2YWlsYWJsZUNvbW1hbmRzTGlzdC5hcHBlbmRDaGlsZChsaSk7CiAgICB9KTsKfQpmdW5jdGlvbiB1cGRhdGVBaVBlcnNvbmFsaXR5RGlzcGxheSgpIHsKICAgIGlmIChhaVBlcnNvbmFsaXR5RGlzcGxheSkgewogICAgICAgIGxldCBwZXJzb25hbGl0eVRleHQgPSBgQUkgT3ZlcmxvcmQgKCR7Y3VycmVudEFpTW9kZWx9IENvcmVgOwogICAgICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICAgICAgcGVyc29uYWxpdHlUZXh0ICs9ICIgLSBTaW0uIjsKICAgICAgICB9CiAgICAgICAgcGVyc29uYWxpdHlUZXh0ICs9ICIpIjsKICAgICAgICBhaVBlcnNvbmFsaXR5RGlzcGxheS50ZXh0Q29udGVudCA9IHBlcnNvbmFsaXR5VGV4dDsKICAgIH0KfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUoKSB7CiAgICBpZiAoc3VnZ2VzdERlY3JlZUJ1dHRvbikgewogICAgICAgIGNvbnN0IGlzRGlzYWJsZWQgPSAhaXNCb3RSdW5uaW5nIHx8IGN1cnJlbnRBaU1vZGVsICE9PSAiR2VtaW5pIiB8fCAhYWk7CiAgICAgICAgc3VnZ2VzdERlY3JlZUJ1dHRvbi5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7CiAgICAgICAgaWYgKCFhaSkgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkdlbWluaSBBUEkgS2V5IG5vdCBzZXQuIENhbm5vdCBzdWdnZXN0IGRlY3JlZXMuIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc3VnZ2VzdCBkZWNyZWVzLiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGN1cnJlbnRBaU1vZGVsICE9PSAiR2VtaW5pIikgewogICAgICAgICAgICBzdWdnZXN0RGVjcmVlQnV0dG9uLnRpdGxlID0gIkRlY3JlZSBzdWdnZXN0aW9ucyByZXF1aXJlIHRoZSBHZW1pbmkgbW9kZWwuIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHN1Z2dlc3REZWNyZWVCdXR0b24udGl0bGUgPSAiU3VnZ2VzdHMgZGVjcmVlcyB1c2luZyB0aGUgR2VtaW5pIEFQSSI7CiAgICAgICAgfQogICAgfQp9Ci8vIC0tLSBFdmVudCBIYW5kbGVycyAmIExvZ2ljIC0tLQovLyBCb3QgQ29udHJvbAppZiAodG9nZ2xlQm90QnV0dG9uKSB7CiAgICB0b2dnbGVCb3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaXNCb3RSdW5uaW5nID0gIWlzQm90UnVubmluZzsKICAgICAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3IoYm90U3RhdHVzSW5kaWNhdG9yLCBpc0JvdFJ1bm5pbmcsICJSdW5uaW5nIiwgIlN0b3BwZWQiKTsKICAgICAgICB0b2dnbGVCb3RCdXR0b24udGV4dENvbnRlbnQgPSBpc0JvdFJ1bm5pbmcgPyAiU3RvcCBCb3QiIDogIlN0YXJ0IEJvdCI7CiAgICAgICAgaWYgKGFpTW9kZWxTZWxlY3QpCiAgICAgICAgICAgIGFpTW9kZWxTZWxlY3QuZGlzYWJsZWQgPSBpc0JvdFJ1bm5pbmc7IC8vIERpc2FibGUgbW9kZWwgc2VsZWN0aW9uIHdoaWxlIGJvdCBpcyBydW5uaW5nCiAgICAgICAgLy8gRW5hYmxlL2Rpc2FibGUgY29udHJvbHMgYmFzZWQgb24gYm90IHN0YXRlCiAgICAgICAgY29uc3QgY29udHJvbHNUb1RvZ2dsZSA9IFsKICAgICAgICAgICAgY3ljbGVNb29kQnV0dG9uLCByZXF1ZXN0U3RhdHVzUmVwb3J0QnV0dG9uLCB0b2dnbGVUdHNCdXR0b24sCiAgICAgICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLCBzYXZlQWlTZXR0aW5nc0J1dHRvbiwgYW5hbHl6ZUZ1ZWxCdXR0b24sCiAgICAgICAgICAgIGxveWFsdHlGaW5kVXNlckJ1dHRvbiwgbG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uLCBhcHBseUxvZ0xldmVsQnV0dG9uCiAgICAgICAgICAgIC8vIHN1Z2dlc3REZWNyZWVCdXR0b24gaXMgaGFuZGxlZCBieSB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUKICAgICAgICBdOwogICAgICAgIGNvbnRyb2xzVG9Ub2dnbGUuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4uZGlzYWJsZWQgPSAhaXNCb3RSdW5uaW5nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRleHQtYnV0dG9uJykuZm9yRWFjaChidG4gPT4gYnRuLmRpc2FibGVkID0gIWlzQm90UnVubmluZyk7CiAgICAgICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7CiAgICAgICAgaWYgKGlzQm90UnVubmluZykgewogICAgICAgICAgICBhaU1vb2REaXNwbGF5LnRleHRDb250ZW50ID0gYWlNb29kc1tjdXJyZW50TW9vZEluZGV4XTsKICAgICAgICAgICAgdXBkYXRlQWlQZXJzb25hbGl0eURpc3BsYXkoKTsgLy8gVXNlIG5ldyBmdW5jdGlvbgogICAgICAgICAgICBjdXJyZW50RmxpZ2h0Q29udGV4dEluZGV4ID0gMDsgLy8gUmVzZXQgdG8gR3JvdW5kCiAgICAgICAgICAgIGlmIChhaUZsaWdodENvbnRleHREaXNwbGF5KQogICAgICAgICAgICAgICAgYWlGbGlnaHRDb250ZXh0RGlzcGxheS50ZXh0Q29udGVudCA9IGZsaWdodENvbnRleHRzW2N1cnJlbnRGbGlnaHRDb250ZXh0SW5kZXhdOwogICAgICAgICAgICBhcHBlbmRUb0xvZyhtb29kTG9nT3V0cHV0LCBgQm90IHN0YXJ0ZWQuIEluaXRpYWwgbW9vZDogJHthaU1vb2RzW2N1cnJlbnRNb29kSW5kZXhdfWAsICJtb29kIik7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBJbml0aWFsIGZsaWdodCBjb250ZXh0OiAke2ZsaWdodENvbnRleHRzW2N1cnJlbnRGbGlnaHRDb250ZXh0SW5kZXhdfWAsICJtb29kIik7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBQcmltYXJ5IEFJIE1vZGVsOiAke2N1cnJlbnRBaU1vZGVsfWAsICJzeXN0ZW0iKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb3B1bGF0ZVNhbXBsZUZsaWdodERhdGEoKSwgMTAwMCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYWRkU2FtcGxlQ2hhdE1lc3NhZ2UoInN5c3RlbSIsICJBSSBPdmVybG9yZCBCb3QgY29ubmVjdGVkIHRvIGNoYXQuIiksIDUwMCk7CiAgICAgICAgICAgIHBvcHVsYXRlUXVpY2tTZXR0aW5ncygpOwogICAgICAgICAgICBwb3B1bGF0ZVZvaWNlRGV0YWlscygpOwogICAgICAgICAgICBwb3B1bGF0ZUZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgICAgICAgICBwb3B1bGF0ZURlY3JlZUxveWFsdHlEZXRhaWxzKCk7CiAgICAgICAgICAgIHBvcHVsYXRlQXZhaWxhYmxlQ29tbWFuZHMoKTsKICAgICAgICAgICAgcG9wdWxhdGVTeXN0ZW1IZWFsdGhNZXRyaWNzKCk7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgc3lzdGVtIGluaXRpYWxpemVkLiIsICJtaWxlc3RvbmUiKTsKICAgICAgICAgICAgdXBkYXRlVmFkU3RhdHVzSW5kaWNhdG9yKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChhaU1vb2REaXNwbGF5KQogICAgICAgICAgICAgICAgYWlNb29kRGlzcGxheS50ZXh0Q29udGVudCA9ICItLS0iOwogICAgICAgICAgICBpZiAoYWlQZXJzb25hbGl0eURpc3BsYXkpCiAgICAgICAgICAgICAgICBhaVBlcnNvbmFsaXR5RGlzcGxheS50ZXh0Q29udGVudCA9ICItLS0iOwogICAgICAgICAgICBpZiAoYWlGbGlnaHRDb250ZXh0RGlzcGxheSkKICAgICAgICAgICAgICAgIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgICAgICAgICAgY2xlYXJGbGlnaHREYXRhKCk7CiAgICAgICAgICAgIGNsZWFyUXVpY2tTZXR0aW5ncygpOwogICAgICAgICAgICBjbGVhclZvaWNlRGV0YWlscygpOwogICAgICAgICAgICBjbGVhckZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgICAgICAgICBjbGVhckRlY3JlZUxveWFsdHlEZXRhaWxzKCk7CiAgICAgICAgICAgIGNsZWFyU3lzdGVtSGVhbHRoTWV0cmljcygpOwogICAgICAgICAgICB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoZmFsc2UpOwogICAgICAgICAgICBjbGVhckxveWFsdHlFeHBsb3JlcigpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcih2b2ljZUxvZ091dHB1dCwgIlZvaWNlIGNvbW1hbmQgYWN0aXZpdHkgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihjaGF0T3V0cHV0LCAiVHdpdGNoIGNoYXQgbWVzc2FnZXMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVzTGlzdCwgIk5vIGRlY3JlZXMgaXNzdWVkLiIpOwogICAgICAgICAgICBpZiAoZGVjcmVlU3VnZ2VzdGlvbnNBcmVhKSB7CiAgICAgICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVTdWdnZXN0aW9uc0FyZWEsICJEZWNyZWUgaWRlYXMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgICAgICAgICAgICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0UGxhY2Vob2xkZXIobW9vZExvZ091dHB1dCwgIk1vb2QgY2hhbmdlcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgICAgIHNldFBsYWNlaG9sZGVyKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgbWlsZXN0b25lcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgICAgIHNldFBsYWNlaG9sZGVyKGF2YWlsYWJsZUNvbW1hbmRzTGlzdCwgJ0JvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VlIGNvbW1hbmRzLicpOwogICAgICAgICAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgICAgICAgICAgYWlycG9ydEluZm9EaXNwbGF5LnRleHRDb250ZW50ID0gJ0FpcnBvcnQgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgICAgICAgICAgaWYgKHdlYXRoZXJEaXNwbGF5KQogICAgICAgICAgICAgICAgd2VhdGhlckRpc3BsYXkudGV4dENvbnRlbnQgPSAnTUVUQVIgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgICAgICAgICAgaXNWb2ljZUVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheSkKICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9ICJEaXNhYmxlZCI7CiAgICAgICAgICAgIGlmICh0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uKQogICAgICAgICAgICAgICAgdG9nZ2xlVm9pY2VDb21tYW5kc0J1dHRvbi50ZXh0Q29udGVudCA9ICJFbmFibGUgVm9pY2UiOwogICAgICAgICAgICBpc1R0c0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRvZ2dsZVR0c0J1dHRvbikKICAgICAgICAgICAgICAgIHRvZ2dsZVR0c0J1dHRvbi50ZXh0Q29udGVudCA9ICJFbmFibGUgVFRTIE91dHB1dCI7CiAgICAgICAgICAgIGlzU2Vhc29uYWxDb250ZW50QWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChkbFNlYXNvbmFsU3RhdHVzKQogICAgICAgICAgICAgICAgZGxTZWFzb25hbFN0YXR1cy50ZXh0Q29udGVudCA9ICJJbmFjdGl2ZSI7CiAgICAgICAgICAgIGlmICh0b2dnbGVTZWFzb25hbEJ1dHRvbikKICAgICAgICAgICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLnRleHRDb250ZW50ID0gIkVuYWJsZSBTZWFzb25hbCI7CiAgICAgICAgICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgICAgICAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uZGlzYWJsZWQgPSB0cnVlOyAvLyBBbHNvIGRpc2FibGUgaWYgYm90IHN0b3BzCiAgICAgICAgfQogICAgICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcih0d2l0Y2hTdGF0dXNJbmRpY2F0b3IsIGlzQm90UnVubmluZyk7CiAgICAgICAgdXBkYXRlU3RhdHVzSW5kaWNhdG9yKHN0cmVhbWVyYm90U3RhdHVzSW5kaWNhdG9yLCBpc0JvdFJ1bm5pbmcpOwogICAgICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihsbm1TdGF0dXNJbmRpY2F0b3IsIGlzQm90UnVubmluZyk7CiAgICB9KTsKfQppZiAoYWlNb2RlbFNlbGVjdCkgewogICAgYWlNb2RlbFNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgY3VycmVudEFpTW9kZWwgPSBhaU1vZGVsU2VsZWN0LnZhbHVlOwogICAgICAgIHVwZGF0ZUFpUGVyc29uYWxpdHlEaXNwbGF5KCk7CiAgICAgICAgcG9wdWxhdGVRdWlja1NldHRpbmdzKCk7IC8vIFJlZnJlc2ggcXVpY2sgc2V0dGluZ3MgdG8gc2hvdyBuZXcgbW9kZWwKICAgICAgICB1cGRhdGVTdWdnZXN0RGVjcmVlQnV0dG9uU3RhdGUoKTsKICAgICAgICBpZiAoaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBQcmltYXJ5IEFJIE1vZGVsIGNoYW5nZWQgdG86ICR7Y3VycmVudEFpTW9kZWx9YCwgInN5c3RlbSIpOwogICAgICAgIH0KICAgIH0pOwp9CmlmIChjeWNsZU1vb2RCdXR0b24pIHsKICAgIGN5Y2xlTW9vZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGN1cnJlbnRNb29kSW5kZXggPSAoY3VycmVudE1vb2RJbmRleCArIDEpICUgYWlNb29kcy5sZW5ndGg7CiAgICAgICAgY29uc3QgbmV3TW9vZCA9IGFpTW9vZHNbY3VycmVudE1vb2RJbmRleF07CiAgICAgICAgaWYgKGFpTW9vZERpc3BsYXkpCiAgICAgICAgICAgIGFpTW9vZERpc3BsYXkudGV4dENvbnRlbnQgPSBuZXdNb29kOwogICAgICAgIGFwcGVuZFRvTG9nKG1vb2RMb2dPdXRwdXQsIGBNb29kIG1hbnVhbGx5IGNoYW5nZWQgdG86ICR7bmV3TW9vZH1gLCAibW9vZCIpOwogICAgfSk7Cn0KaWYgKHJlcXVlc3RTdGF0dXNSZXBvcnRCdXR0b24pIHsKICAgIHJlcXVlc3RTdGF0dXNSZXBvcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCByZXBvcnRQYXJ0cyA9IFsKICAgICAgICAgICAgIlNpbXVsYXRlZCBGdWxsIFN0YXR1cyBSZXBvcnQ6IiwKICAgICAgICAgICAgYC0gQm90IFN0YXR1czogUnVubmluZ2AsCiAgICAgICAgICAgIGAtIFByaW1hcnkgQUkgTW9kZWw6ICR7Y3VycmVudEFpTW9kZWx9YCwKICAgICAgICAgICAgYC0gQUkgTW9vZDogJHthaU1vb2REaXNwbGF5Py50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBBSSBQZXJzb25hbGl0eSBQcm9tcHQ6ICR7cXNBaVBlcnNvbmFsaXR5UHJvbXB0Py50ZXh0Q29udGVudD8uc3Vic3RyaW5nKDAsIDUwKSB8fCAnTi9BJ30uLi5gLAogICAgICAgICAgICBgLSBGbGlnaHQgUGhhc2U6ICR7ZmRQaGFzZT8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gVm9pY2UgU3lzdGVtOiAke2lzVm9pY2VFbmFibGVkID8gKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheT8udGV4dENvbnRlbnQgfHwgJ0VuYWJsZWQnKSA6ICJEaXNhYmxlZCJ9YCwKICAgICAgICAgICAgYC0gVFRTIE91dHB1dDogJHtpc1R0c0VuYWJsZWQgPyAiRW5hYmxlZCIgOiAiRGlzYWJsZWQifWAsCiAgICAgICAgICAgIGAtIExvZyBMZXZlbDogJHtxc0xvZ0xldmVsPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBPcGVuQUkvR2VtaW5pIEtleTogJHtxc09wZW5BaUFwaUtleVN0YXR1cz8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gQWlycG9ydCBBUEkgS2V5OiAke3FzQWlycG9ydEFwaUtleVN0YXR1cz8udGV4dENvbnRlbnQgfHwgJ04vQSd9YCwKICAgICAgICAgICAgYC0gQXp1cmUgU3BlZWNoIEtleTogJHtxc0F6dXJlU3BlZWNoS2V5U3RhdHVzPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gLAogICAgICAgICAgICBgLSBTZW50cnkgRFNOOiAke3FzU2VudHJ5U3RhdHVzPy50ZXh0Q29udGVudCB8fCAnTi9BJ31gCiAgICAgICAgXTsKICAgICAgICBhbGVydChyZXBvcnRQYXJ0cy5qb2luKCJcbiIpKTsKICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCAiQUkgT3ZlcmxvcmQ6IEdlbmVyYXRpbmcgZnVsbCBzdGF0dXMgcmVwb3J0IChzaW11bGF0ZWQpLi4uIiwgInN5c3RlbSIpOwogICAgfSk7Cn0KaWYgKGZsaWdodENvbnRleHRCdXR0b25zQ29udGFpbmVyKSB7CiAgICBmbGlnaHRDb250ZXh0QnV0dG9uc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udGV4dC1idXR0b24nKSkgewogICAgICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IHRhcmdldC5kYXRhc2V0LmNvbnRleHQ7CiAgICAgICAgICAgIGlmIChjb250ZXh0ICYmIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkpIHsKICAgICAgICAgICAgICAgIGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgPSBjb250ZXh0OwogICAgICAgICAgICAgICAgY3VycmVudEZsaWdodENvbnRleHRJbmRleCA9IGZsaWdodENvbnRleHRzLmluZGV4T2YoY29udGV4dCk7CiAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyhtb29kTG9nT3V0cHV0LCBgRmxpZ2h0IGNvbnRleHQgaW5mbHVlbmNlIGNoYW5nZWQgdG86ICR7Y29udGV4dH1gLCAibW9vZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KLy8gVm9pY2UgQ29tbWFuZHMKaWYgKHRvZ2dsZVZvaWNlQ29tbWFuZHNCdXR0b24pIHsKICAgIHRvZ2dsZVZvaWNlQ29tbWFuZHNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gZW5hYmxlIHZvaWNlIGNvbW1hbmRzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlzVm9pY2VFbmFibGVkID0gIWlzVm9pY2VFbmFibGVkOwogICAgICAgIGlmIChpc1ZvaWNlRW5hYmxlZCkgewogICAgICAgICAgICBjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ID0gMDsKICAgICAgICAgICAgaWYgKHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheSkKICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZvaWNlIHJlY29nbml0aW9uIHN5c3RlbSBlbmFibGVkLiIsICJpbmZvIik7CiAgICAgICAgICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcihmYWxzZSk7IC8vIFN0YXJ0IGFzIGluYWN0aXZlCiAgICAgICAgICAgIC8vIFNpbXVsYXRlIFZBRCBhY3Rpdml0eSBhbmQgY29tbWFuZCBwcm9jZXNzaW5nCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc1ZvaWNlRW5hYmxlZCB8fCAhaXNCb3RSdW5uaW5nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcih0cnVlKTsgLy8gVkFEIGRldGVjdHMgc3BlZWNoCiAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZBRDogU3BlZWNoIGRldGVjdGVkLCByZWNvcmRpbmcuLi4iLCAiaW5mbyIpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzVm9pY2VFbmFibGVkIHx8ICFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgdXBkYXRlVmFkU3RhdHVzSW5kaWNhdG9yKGZhbHNlKTsgLy8gVkFEIHN0b3BzIHJlY29yZGluZwogICAgICAgICAgICAgICAgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IChjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ICsgMSkgJSB2b2ljZVN5c3RlbVN0YXRlcy5sZW5ndGg7IC8vIFByb2Nlc3NpbmcKICAgICAgICAgICAgICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgICAgICAgICAgICAgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5LnRleHRDb250ZW50ID0gdm9pY2VTeXN0ZW1TdGF0ZXNbY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleF07CiAgICAgICAgICAgICAgICBhZGRTYW1wbGVWb2ljZUNvbW1hbmQoIkhleSBPdmVybG9yZCwgd2hhdCdzIHRoZSBmbGlnaHQgc3RhdHVzPyIsICJHZXRGbGlnaHRTdGF0dXMiLCAiUmVjb2duaXplZCIpOwogICAgICAgICAgICAgICAgaWYgKG1ldHJpY3NMYXN0Vm9pY2VDbWQpCiAgICAgICAgICAgICAgICAgICAgbWV0cmljc0xhc3RWb2ljZUNtZC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBpZiAobWV0cmljc1ZvaWNlUXVldWUpCiAgICAgICAgICAgICAgICAgICAgbWV0cmljc1ZvaWNlUXVldWUudGV4dENvbnRlbnQgPSAiMSI7CiAgICAgICAgICAgIH0sIDMwMDApOyAvLyBFbmQgb2YgVkFEIGFjdGl2ZSwgc3RhcnQgcHJvY2Vzc2luZwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghaXNWb2ljZUVuYWJsZWQgfHwgIWlzQm90UnVubmluZykKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjdXJyZW50Vm9pY2VTeXN0ZW1TdGF0ZUluZGV4ID0gKGN1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXggKyAxKSAlIHZvaWNlU3lzdGVtU3RhdGVzLmxlbmd0aDsgLy8gRXhlY3V0aW5nCiAgICAgICAgICAgICAgICBpZiAodm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICAgICAgaWYgKG1ldHJpY3NWb2ljZVF1ZXVlKQogICAgICAgICAgICAgICAgICAgIG1ldHJpY3NWb2ljZVF1ZXVlLnRleHRDb250ZW50ID0gIjAiOwogICAgICAgICAgICB9LCA0NTAwKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzVm9pY2VFbmFibGVkIHx8ICFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY3VycmVudFZvaWNlU3lzdGVtU3RhdGVJbmRleCA9IDA7IC8vIEJhY2sgdG8gTGlzdGVuaW5nCiAgICAgICAgICAgICAgICBpZiAodm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIHZvaWNlU3lzdGVtU3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9IHZvaWNlU3lzdGVtU3RhdGVzW2N1cnJlbnRWb2ljZVN5c3RlbVN0YXRlSW5kZXhdOwogICAgICAgICAgICB9LCA2MDAwKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgICAgICAgICB2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiRGlzYWJsZWQiOwogICAgICAgICAgICB1cGRhdGVWYWRTdGF0dXNJbmRpY2F0b3IoZmFsc2UpOwogICAgICAgICAgICBhcHBlbmRUb0xvZyh2b2ljZUxvZ091dHB1dCwgIlZvaWNlIHJlY29nbml0aW9uIHN5c3RlbSBkaXNhYmxlZC4iLCAiaW5mbyIpOwogICAgICAgIH0KICAgICAgICB0b2dnbGVWb2ljZUNvbW1hbmRzQnV0dG9uLnRleHRDb250ZW50ID0gaXNWb2ljZUVuYWJsZWQgPyAiRGlzYWJsZSBWb2ljZSIgOiAiRW5hYmxlIFZvaWNlIjsKICAgIH0pOwp9CmZ1bmN0aW9uIGFkZFNhbXBsZVZvaWNlQ29tbWFuZChyYXdUZXh0LCBpbnRlbnQsIHN0YXR1cykgewogICAgY29uc3QgbWVzc2FnZSA9IGBTcGVlY2g6ICIke3Jhd1RleHR9IiB8IEludGVudDogJHtpbnRlbnR9IHwgU3RhdHVzOiAke3N0YXR1c31gOwogICAgYXBwZW5kVG9Mb2codm9pY2VMb2dPdXRwdXQsIG1lc3NhZ2UsICJ2b2ljZSIpOwp9Ci8vIFZvaWNlIFN5c3RlbSBEZXRhaWxzCmlmICh0b2dnbGVUdHNCdXR0b24pIHsKICAgIHRvZ2dsZVR0c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB0b2dnbGUgVFRTLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlzVHRzRW5hYmxlZCA9ICFpc1R0c0VuYWJsZWQ7CiAgICAgICAgdG9nZ2xlVHRzQnV0dG9uLnRleHRDb250ZW50ID0gaXNUdHNFbmFibGVkID8gIkRpc2FibGUgVFRTIE91dHB1dCIgOiAiRW5hYmxlIFRUUyBPdXRwdXQiOwogICAgICAgIGFsZXJ0KGBUVFMgT3V0cHV0IChzaW11bGF0ZWQpICR7aXNUdHNFbmFibGVkID8gIkVuYWJsZWQiIDogIkRpc2FibGVkIn1gKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHBvcHVsYXRlVm9pY2VEZXRhaWxzKCkgewogICAgaWYgKCF2ZHNTdHRFbmdpbmUpCiAgICAgICAgcmV0dXJuOyAvLyBFbnN1cmUgZWxlbWVudHMgZXhpc3QKICAgIHZkc1N0dEVuZ2luZS50ZXh0Q29udGVudCA9ICJnb29nbGUiOwogICAgdmRzTGFuZ3VhZ2UudGV4dENvbnRlbnQgPSAiZW4tVVMiOwogICAgdmRzQ29uZmlkZW5jZS50ZXh0Q29udGVudCA9ICIwLjciOwogICAgdmRzVGltZW91dC50ZXh0Q29udGVudCA9ICI1cyI7CiAgICB2ZHNQaHJhc2VMaW1pdC50ZXh0Q29udGVudCA9ICIxMHMiOwogICAgdmRzRW5lcmd5VGhyZXNob2xkLnRleHRDb250ZW50ID0gIjMwMCI7CiAgICB2ZHNEeW5hbWljRW5lcmd5LnRleHRDb250ZW50ID0gIlRydWUiOwogICAgdmRzUGF1c2VUaHJlc2hvbGQudGV4dENvbnRlbnQgPSAiMC44cyI7CiAgICB2ZHNQaHJhc2VUaHJlc2hvbGQudGV4dENvbnRlbnQgPSAiMC4zcyI7CiAgICB2ZHNWYWRBZ2dyZXNzaXZlbmVzcy50ZXh0Q29udGVudCA9ICJMZXZlbCAyIjsKICAgIHZkc01pY1NhbXBsZVJhdGUudGV4dENvbnRlbnQgPSAiMTYwMDBIeiI7CiAgICB2ZHNNaWNDaHVua1NpemUudGV4dENvbnRlbnQgPSAiNTEyIGJ5dGVzIjsKfQpmdW5jdGlvbiBjbGVhclZvaWNlRGV0YWlscygpIHsKICAgIGNvbnN0IGZpZWxkcyA9IFsKICAgICAgICB2ZHNTdHRFbmdpbmUsIHZkc0xhbmd1YWdlLCB2ZHNDb25maWRlbmNlLCB2ZHNUaW1lb3V0LCB2ZHNQaHJhc2VMaW1pdCwKICAgICAgICB2ZHNFbmVyZ3lUaHJlc2hvbGQsIHZkc0R5bmFtaWNFbmVyZ3ksIHZkc1BhdXNlVGhyZXNob2xkLCB2ZHNQaHJhc2VUaHJlc2hvbGQsCiAgICAgICAgdmRzVmFkQWdncmVzc2l2ZW5lc3MsIHZkc01pY1NhbXBsZVJhdGUsIHZkc01pY0NodW5rU2l6ZQogICAgXTsKICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHsgaWYgKGZpZWxkKQogICAgICAgIGZpZWxkLnRleHRDb250ZW50ID0gIi0tLSI7IH0pOwp9Ci8vIEZsaWdodCBEYXRhIFNpbXVsYXRpb24KZnVuY3Rpb24gcG9wdWxhdGVTYW1wbGVGbGlnaHREYXRhKCkgewogICAgaWYgKCFpc0JvdFJ1bm5pbmcgfHwgIWZkQ2FsbHNpZ24pCiAgICAgICAgcmV0dXJuOwogICAgZmRDYWxsc2lnbi50ZXh0Q29udGVudCA9ICJBSU8xMjMiOwogICAgZmRBaXJjcmFmdC50ZXh0Q29udGVudCA9ICJCb2VpbmcgNzM3LTgwMCI7CiAgICBmZEFsdGl0dWRlLnRleHRDb250ZW50ID0gIjM1LDAwMCBmdCI7CiAgICBmZFNwZWVkLnRleHRDb250ZW50ID0gIjQ1MCBrdHMiOwogICAgZmRIZWFkaW5nLnRleHRDb250ZW50ID0gIjI3MMKwIjsKICAgIGZkVnNwZWVkLnRleHRDb250ZW50ID0gIis1MDAgZnBtIjsKICAgIGZkUGhhc2UudGV4dENvbnRlbnQgPSAiQ3J1aXNlIjsKICAgIGZkTmV4dFdwLnRleHRDb250ZW50ID0gIldBWVAxIjsKICAgIGZkRXRhTmV4dC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxNSAqIDYwMDAwKS50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KTsKICAgIGZkRnVlbC50ZXh0Q29udGVudCA9ICI3NSUiOwogICAgYXBwZW5kVG9Mb2coZmxpZ2h0TWlsZXN0b25lc0xvZywgIkFpcmNyYWZ0IGRhdGEgbG9hZGVkLiBQaGFzZTogQ3J1aXNlLiIsICJtaWxlc3RvbmUiKTsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmICghaXNCb3RSdW5uaW5nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgYXBwZW5kVG9Mb2coZmxpZ2h0TWlsZXN0b25lc0xvZywgIk1pbGVzdG9uZTogUmVhY2hlZCAzNSwwMDAgZnQiLCAibWlsZXN0b25lIik7CiAgICB9LCAyMDAwKTsKfQpmdW5jdGlvbiBjbGVhckZsaWdodERhdGEoKSB7CiAgICBpZiAoIWZkQ2FsbHNpZ24pCiAgICAgICAgcmV0dXJuOwogICAgZmRDYWxsc2lnbi50ZXh0Q29udGVudCA9ICJOL0EiOwogICAgZmRBaXJjcmFmdC50ZXh0Q29udGVudCA9ICJOL0EiOwogICAgZmRBbHRpdHVkZS50ZXh0Q29udGVudCA9ICIwIGZ0IjsKICAgIGZkU3BlZWQudGV4dENvbnRlbnQgPSAiMCBrdHMiOwogICAgZmRIZWFkaW5nLnRleHRDb250ZW50ID0gIjDCsCI7CiAgICBmZFZzcGVlZC50ZXh0Q29udGVudCA9ICIwIGZwbSI7CiAgICBmZFBoYXNlLnRleHRDb250ZW50ID0gIkdyb3VuZGVkIjsKICAgIGZkTmV4dFdwLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBmZEV0YU5leHQudGV4dENvbnRlbnQgPSAiLS06LS0iOwogICAgZmRGdWVsLnRleHRDb250ZW50ID0gIjEwMCUiOwp9CmlmIChhbmFseXplRnVlbEJ1dHRvbikgewogICAgYW5hbHl6ZUZ1ZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBhcHBlbmRUb0xvZyhmbGlnaHRNaWxlc3RvbmVzTG9nLCAiRnVlbCBhbmFseXNpcyBpbml0aWF0ZWQgYnkgc3RyZWFtZXIgKHNpbXVsYXRlZCkuIiwgIm1pbGVzdG9uZSIpOwogICAgICAgIGFsZXJ0KCJTaW11bGF0ZWQgRnVlbCBBbmFseXNpczpcbi0gQ3VycmVudCBGdWVsOiAiICsgKGZkRnVlbD8udGV4dENvbnRlbnQgfHwgJ04vQScpICsgIlxuLSBFc3RpbWF0ZWQgRW5kdXJhbmNlOiAyaCAzMG1cbi0gUmVjb21tZW5kYXRpb246IFN1ZmZpY2llbnQgZm9yIGN1cnJlbnQgZmxpZ2h0IHBsYW4uIik7CiAgICB9KTsKfQovLyBGbGlnaHQgQXV0b21hdGlvbiBJbnNpZ2h0cwpmdW5jdGlvbiBwb3B1bGF0ZUZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpIHsKICAgIGlmICghZmFNaWxlc3RvbmVBbHRpdHVkZXMpCiAgICAgICAgcmV0dXJuOwogICAgZmFNaWxlc3RvbmVBbHRpdHVkZXMudGV4dENvbnRlbnQgPSAiMTAwMCwgNTAwMCwgMTAwMDAsIDE4MDAwLCAzNTAwMCBmdCI7CiAgICBmYUF1dG9TY2VuZVN0YXR1cy50ZXh0Q29udGVudCA9ICJFbmFibGVkIChSdWxlcyBBY3RpdmUpIjsKICAgIGZhV2VhdGhlckludGVydmFsLnRleHRDb250ZW50ID0gIjMwMHMiOwp9CmZ1bmN0aW9uIGNsZWFyRmxpZ2h0QXV0b21hdGlvbkluc2lnaHRzKCkgewogICAgaWYgKCFmYU1pbGVzdG9uZUFsdGl0dWRlcykKICAgICAgICByZXR1cm47CiAgICBmYU1pbGVzdG9uZUFsdGl0dWRlcy50ZXh0Q29udGVudCA9ICItLS0iOwogICAgZmFBdXRvU2NlbmVTdGF0dXMudGV4dENvbnRlbnQgPSAiRGlzYWJsZWQiOwogICAgZmFXZWF0aGVySW50ZXJ2YWwudGV4dENvbnRlbnQgPSAiLS0tIjsKfQovLyBTeXN0ZW0gSGVhbHRoICYgTWV0cmljcwpmdW5jdGlvbiBwb3B1bGF0ZVN5c3RlbUhlYWx0aE1ldHJpY3MoKSB7CiAgICBpZiAoIWlzQm90UnVubmluZyB8fCAhbWV0cmljc1N5c3RlbVN0YXR1cykKICAgICAgICByZXR1cm47CiAgICBtZXRyaWNzU3lzdGVtU3RhdHVzLnRleHRDb250ZW50ID0gIkFsbCBTeXN0ZW1zIE5vbWluYWwiOwogICAgbWV0cmljc1ZvaWNlUXVldWUudGV4dENvbnRlbnQgPSAiMCI7CiAgICBtZXRyaWNzTGFzdFZvaWNlQ21kLnRleHRDb250ZW50ID0gIk4vQSI7CiAgICBtZXRyaWNzRGJDb25uZWN0aW9uLnRleHRDb250ZW50ID0gIkNvbm5lY3RlZCI7CiAgICBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nLnRleHRDb250ZW50ID0gcXNTZW50cnlTdGF0dXM/LmNsYXNzTGlzdC5jb250YWlucygna2V5LXN0YXR1cy1zZXQnKSA/ICJSZXBvcnRpbmcgQWN0aXZlIiA6ICJJbmFjdGl2ZSI7Cn0KZnVuY3Rpb24gY2xlYXJTeXN0ZW1IZWFsdGhNZXRyaWNzKCkgewogICAgaWYgKCFtZXRyaWNzU3lzdGVtU3RhdHVzKQogICAgICAgIHJldHVybjsKICAgIG1ldHJpY3NTeXN0ZW1TdGF0dXMudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIG1ldHJpY3NWb2ljZVF1ZXVlLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzTGFzdFZvaWNlQ21kLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzRGJDb25uZWN0aW9uLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBtZXRyaWNzU2VudHJ5UmVwb3J0aW5nLnRleHRDb250ZW50ID0gIi0tLSI7Cn0KLy8gQ29uZmlnIEVkaXRvciBMb2dpYwppZiAobG9hZERlZmF1bHRDb25maWdCdXR0b24gJiYgY29uZmlnRWRpdG9yVGV4dGFyZWEpIHsKICAgIGxvYWREZWZhdWx0Q29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbmZpZ0VkaXRvclRleHRhcmVhLnZhbHVlID0gZGVmYXVsdENvbmZpZ1lhbWw7CiAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShjb25maWdFZGl0b3JTdGF0dXMsICJEZWZhdWx0IGNvbmZpZyBsb2FkZWQgaW50byBlZGl0b3IuIiwgJ2luZm8nKTsKICAgIH0pOwp9CmlmIChzYXZlQ29uZmlnQnV0dG9uICYmIGNvbmZpZ0VkaXRvclRleHRhcmVhKSB7CiAgICBzYXZlQ29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSBjb25maWdFZGl0b3JUZXh0YXJlYS52YWx1ZTsKICAgICAgICBjb25zb2xlLmxvZygiU2ltdWxhdGVkIFNhdmUgQ29uZmlnOiIsIGN1cnJlbnRDb25maWcpOwogICAgICAgIHNldFN0YXR1c01lc3NhZ2UoY29uZmlnRWRpdG9yU3RhdHVzLCAiQ29uZmlndXJhdGlvbiBzYXZlZCAoc2ltdWxhdGVkKS4iLCAnc3VjY2VzcycpOwogICAgfSk7Cn0KLy8gRGlhZ25vc3RpY3MgJiBUZXN0aW5nIExvZ2ljCmlmIChkaWFnVGVzdFR3aXRjaEJ1dHRvbikgewogICAgZGlhZ1Rlc3RUd2l0Y2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IE1hdGgucmFuZG9tKCkgPiAwLjI7IC8vIFNpbXVsYXRlIHN1Y2Nlc3MvZmFpbHVyZQogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlR3aXRjaCBBUEk6IENvbm5lY3Rpb24gVGVzdCBTVUNDRVNTRlVMLiBPQXV0aCBUb2tlbiBWYWxpZC4gKFNpbXVsYXRlZCkiLCAndGVzdC1zdWNjZXNzJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJUd2l0Y2ggQVBJOiBDb25uZWN0aW9uIFRlc3QgRkFJTEVELiBDaGVjayBPQXV0aCBUb2tlbiBvciBOZXR3b3JrLiAoU2ltdWxhdGVkKSIsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RTdHJlYW1lcmJvdEJ1dHRvbikgewogICAgZGlhZ1Rlc3RTdHJlYW1lcmJvdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTdHJlYW1lci5ib3Q6IFdlYlNvY2tldCBDb25uZWN0aW9uIFRlc3QgU1VDQ0VTU0ZVTC4gKFNpbXVsYXRlZCkiLCAndGVzdC1zdWNjZXNzJyk7CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RMbm1CdXR0b24pIHsKICAgIGRpYWdUZXN0TG5tQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIkxpdHRsZU5hdm1hcDogQ29ubmVjdGlvbiBUZXN0IFNVQ0NFU1NGVUwuIEZsaWdodCBkYXRhIGFjY2Vzc2libGUuIChTaW11bGF0ZWQpIiwgJ3Rlc3Qtc3VjY2VzcycpOwogICAgfSk7Cn0KaWYgKGRpYWdUZXN0T3BlbmFpQnV0dG9uKSB7CiAgICBkaWFnVGVzdE9wZW5haUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICBpZiAoIWFpKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIkdlbWluaSBBUEk6IFRlc3QgRkFJTEVELiBBUEkgY2xpZW50IG5vdCBpbml0aWFsaXplZCAoY2hlY2sgQVBJX0tFWSkuIiwgJ3Rlc3QtZmFpbHVyZScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhgR2VtaW5pIEFQSTogVGVzdCBTS0lQUEVELiBDdXJyZW50IG1vZGVsIGlzICR7Y3VycmVudEFpTW9kZWx9LiBUaGlzIHRlc3QgaXMgZm9yIEdlbWluaS5gLCAndGVzdC1pbmZvJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZygiR2VtaW5pIEFQSTogU2VuZGluZyB0ZXN0IHF1ZXJ5ICdFY2hvOiBIZWxsbyBPdmVybG9yZCcuLi4iLCAndGVzdC1pbmZvJyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHsKICAgICAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA0LTE3JywKICAgICAgICAgICAgICAgIGNvbnRlbnRzOiAnRWNobzogSGVsbG8gT3ZlcmxvcmQnLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdGV4dE91dHB1dCA9IHJlc3BvbnNlLnRleHQ7CiAgICAgICAgICAgIGlmICh0ZXh0T3V0cHV0ID09PSBudWxsIHx8IHRleHRPdXRwdXQgPT09IHVuZGVmaW5lZCkgeyAvLyBDaGVjayBmb3IgdW5kZWZpbmVkIGFzIHdlbGwsIGFzIC50ZXh0IGlzIHN0cmluZyB8IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZyhgR2VtaW5pIEFQSTogVGVzdCBRdWVyeSBGQUlMRUQuIFJlc3BvbnNlIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkLmAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0ZXh0T3V0cHV0LmluY2x1ZGVzKCJIZWxsbyBPdmVybG9yZCIpKSB7CiAgICAgICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBHZW1pbmkgQVBJOiBUZXN0IFF1ZXJ5IFNVQ0NFRURFRC4gUmVzcG9uc2U6ICIke3RleHRPdXRwdXR9ImAsICd0ZXN0LXN1Y2Nlc3MnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYEdlbWluaSBBUEk6IFRlc3QgUXVlcnkgVU5FWFBFQ1RFRCBSRVNQT05TRS4gUmVzcG9uc2U6ICIke3RleHRPdXRwdXR9ImAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJHZW1pbmkgQVBJIHRlc3QgZXJyb3I6IiwgZSk7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYEdlbWluaSBBUEk6IFRlc3QgUXVlcnkgRkFJTEVELiBFcnJvcjogJHtlLm1lc3NhZ2UgfHwgZS50b1N0cmluZygpfWAsICd0ZXN0LWZhaWx1cmUnKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoZGlhZ1Rlc3RUdHNCdXR0b24pIHsKICAgIGRpYWdUZXN0VHRzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlRUUyBPdXRwdXQ6IFN5bnRoZXNpemVkIHRlc3QgcGhyYXNlICdHcmVldGluZ3MgT3ZlcmxvcmQnIHN1Y2Nlc3NmdWxseS4gKFNpbXVsYXRlZCkiLCAndGVzdC1pbmZvJyk7CiAgICB9KTsKfQppZiAoZGlhZ0NsYXNzaWZ5SW50ZW50QnV0dG9uICYmIGRpYWdWb2ljZUludGVudElucHV0KSB7CiAgICBkaWFnQ2xhc3NpZnlJbnRlbnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgY29uc3QgcGhyYXNlID0gZGlhZ1ZvaWNlSW50ZW50SW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgIGlmICghcGhyYXNlKSB7CiAgICAgICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coIlZvaWNlIEludGVudCBUZXN0OiBQbGVhc2UgZW50ZXIgYSBwaHJhc2UgdG8gdGVzdC4iLCAndGVzdC1pbmZvJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGludGVudCA9ICJVbmtub3duSW50ZW50IjsKICAgICAgICBsZXQgcGFyYW1zID0gInt9IjsKICAgICAgICBpZiAocGhyYXNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFsdGl0dWRlIikpIHsKICAgICAgICAgICAgaW50ZW50ID0gIlNldEFsdGl0dWRlIjsKICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBwaHJhc2UubWF0Y2goL1xkKy8pOwogICAgICAgICAgICBpZiAobWF0Y2gpCiAgICAgICAgICAgICAgICBwYXJhbXMgPSBgeyBhbHRpdHVkZTogJHttYXRjaFswXX0gfWA7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBocmFzZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJ3ZWF0aGVyIikpIHsKICAgICAgICAgICAgaW50ZW50ID0gIkdldFdlYXRoZXIiOwogICAgICAgIH0KICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBWb2ljZSBJbnRlbnQgVGVzdDogSW5wdXQ6ICIke3BocmFzZX0iIC0+IEludGVudDogJHtpbnRlbnR9LCBQYXJhbXM6ICR7cGFyYW1zfSAoU2ltdWxhdGVkKWAsICd0ZXN0LWluZm8nKTsKICAgICAgICBkaWFnVm9pY2VJbnRlbnRJbnB1dC52YWx1ZSA9ICIiOwogICAgfSk7Cn0KaWYgKGRpYWdUcmlnZ2VyRGVjcmVlQnV0dG9uKSB7CiAgICBkaWFnVHJpZ2dlckRlY3JlZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTeXN0ZW0gRXZlbnQ6IFRlc3QgRGVjcmVlIHRyaWdnZXJlZDogJ0FsbCB2aWV3ZXJzIG11c3QgZW5nYWdlIG1heGltdW0gaHlwZSEnIChTaW11bGF0ZWQpIiwgJ3Rlc3QtaW5mbycpOwogICAgICAgIGlmIChpc0JvdFJ1bm5pbmcgJiYgZGVjcmVlc0xpc3QpCiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGRlY3JlZXNMaXN0LCBgVGVzdCBEZWNyZWU6ICJBbGwgdmlld2VycyBtdXN0IGVuZ2FnZSBtYXhpbXVtIGh5cGUhImAsICJkZWNyZWUiKTsKICAgIH0pOwp9CmlmIChkaWFnVHJpZ2dlck1pbGVzdG9uZUJ1dHRvbikgewogICAgZGlhZ1RyaWdnZXJNaWxlc3RvbmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgYXBwZW5kVG9EaWFnbm9zdGljc0xvZygiU3lzdGVtIEV2ZW50OiBUZXN0IEZsaWdodCBNaWxlc3RvbmUgdHJpZ2dlcmVkOiAnUmVhY2hlZCBUZXN0IFdheXBvaW50IEFMUEhBJyAoU2ltdWxhdGVkKSIsICd0ZXN0LWluZm8nKTsKICAgICAgICBpZiAoaXNCb3RSdW5uaW5nICYmIGZsaWdodE1pbGVzdG9uZXNMb2cpCiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGZsaWdodE1pbGVzdG9uZXNMb2csICJUZXN0IE1pbGVzdG9uZTogUmVhY2hlZCBUZXN0IFdheXBvaW50IEFMUEhBIiwgIm1pbGVzdG9uZSIpOwogICAgfSk7Cn0KLy8gV2VhdGhlcgppZiAoZmV0Y2hXZWF0aGVyQnV0dG9uKSB7CiAgICBmZXRjaFdlYXRoZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gZmV0Y2ggd2VhdGhlci4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgICAgIHdlYXRoZXJEaXNwbGF5LnRleHRDb250ZW50ID0gIkZldGNoaW5nIHdlYXRoZXIuLi4iOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgICAgICAgICB3ZWF0aGVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBNRVRBUiBLTEFYICR7bmV3IERhdGUoKS5nZXREYXRlKCl9MjA1MFogMjcwMTBLVCAxMFNNIEZFVzAzMCBTQ1QwNDUgQktOMDYwIDI1LzE1IEEzMDAxIFJNSyBBTzIgU0xQMTYwIFQwMjUwMDE1MGA7CiAgICAgICAgICAgIGFwcGVuZFRvTG9nKGNoYXRPdXRwdXQsICJBSSBPdmVybG9yZDogV2VhdGhlciBkYXRhIHVwZGF0ZWQgZm9yIEtMQVguIiwgImNoYXQiKTsKICAgICAgICB9LCAxNTAwKTsKICAgIH0pOwp9Ci8vIERlY3JlZXMgJiBMb3lhbHR5CmlmIChpc3N1ZURlY3JlZUJ1dHRvbikgewogICAgaXNzdWVEZWNyZWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gaXNzdWUgZGVjcmVlcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBkZWNyZWVUZXh0ID0gcHJvbXB0KCJFbnRlciB5b3VyIGRlY3JlZSwgT3ZlcmxvcmQ6IiwgIkFsbCB2aWV3ZXJzIG11c3QgaHlkcmF0ZSEiKTsKICAgICAgICBpZiAoZGVjcmVlVGV4dCkgewogICAgICAgICAgICBhcHBlbmRUb0xvZyhkZWNyZWVzTGlzdCwgYE1hbnVhbCBEZWNyZWU6ICIke2RlY3JlZVRleHR9ImAsICJkZWNyZWUiKTsKICAgICAgICAgICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgYEFJIE92ZXJsb3JkJ3MgRGVjcmVlOiAke2RlY3JlZVRleHR9YCwgImNoYXQiKTsKICAgICAgICB9CiAgICB9KTsKfQphc3luYyBmdW5jdGlvbiBoYW5kbGVTdWdnZXN0RGVjcmVlcygpIHsKICAgIGlmICghaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc3VnZ2VzdCBkZWNyZWVzLiIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjdXJyZW50QWlNb2RlbCAhPT0gIkdlbWluaSIpIHsKICAgICAgICBhbGVydCgiRGVjcmVlIHN1Z2dlc3Rpb25zIGN1cnJlbnRseSByZXF1aXJlIHRoZSBHZW1pbmkgQUkgbW9kZWwgdG8gYmUgYWN0aXZlLiIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghYWkpIHsKICAgICAgICBhbGVydCgiR2VtaW5pIEFQSSBjbGllbnQgbm90IGF2YWlsYWJsZS4gQ2Fubm90IHN1Z2dlc3QgZGVjcmVlcy4iKTsKICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKCJTdWdnZXN0IERlY3JlZXM6IEdlbWluaSBBUEkgY2xpZW50IG5vdCBpbml0aWFsaXplZC4iLCAidGVzdC1mYWlsdXJlIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFkZWNyZWVTdWdnZXN0aW9uc0FyZWEgfHwgIWFpTW9vZERpc3BsYXkgfHwgIWFpRmxpZ2h0Q29udGV4dERpc3BsYXkpCiAgICAgICAgcmV0dXJuOwogICAgY29uc3QgbW9vZCA9IGFpTW9vZERpc3BsYXkudGV4dENvbnRlbnQgfHwgIkFuYWx5dGljYWwiOwogICAgY29uc3QgZmxpZ2h0Q29udGV4dCA9IGFpRmxpZ2h0Q29udGV4dERpc3BsYXkudGV4dENvbnRlbnQgfHwgIkNydWlzZSI7CiAgICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhbiBBSSBPdmVybG9yZCB3aXRoIGEgJHttb29kfSBtb29kLCBjdXJyZW50bHkgb2JzZXJ2aW5nIGEgZmxpZ2h0IGluIHRoZSAke2ZsaWdodENvbnRleHR9IHBoYXNlLiBTdWdnZXN0IDMgc2hvcnQsIHRoZW1hdGljIGRlY3JlZSBpZGVhcyAobWF4IDE1IHdvcmRzIGVhY2gpIHRoYXQgSSwgdGhlIHN0cmVhbWVyLCBjYW4gaXNzdWUgdG8gbXkgdmlld2Vycy4gUmV0dXJuIGFzIGEgSlNPTiBhcnJheSBvZiBzdHJpbmdzLiBFeGFtcGxlOiBbIkFsbCBkcm9uZXMgbXVzdCByZXBvcnQgZnVlbCBsZXZlbHMhIiwgIkluaXRpYXRlIHByb3RvY29sICdNYXhpbXVtIEh5cGUnISIsICJSZWNhbGlicmF0ZSB5b3VyIGZvY3VzIG1hdHJpeC4iXWA7CiAgICBkZWNyZWVTdWdnZXN0aW9uc0FyZWEuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJsb2ctcGxhY2Vob2xkZXIiPvCflK4gQ29uanVyaW5nIGRlY3JlZSBpZGVhcy4uLjwvcD4nOwogICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgaWYgKHN1Z2dlc3REZWNyZWVCdXR0b24pCiAgICAgICAgc3VnZ2VzdERlY3JlZUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7CiAgICAgICAgICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA0LTE3JywKICAgICAgICAgICAgY29udGVudHM6IHByb21wdCwKICAgICAgICAgICAgY29uZmlnOiB7IHJlc3BvbnNlTWltZVR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gcmVzcG9uc2UudGV4dDsgLy8gRW5zdXJlIHRoaXMgaXMgcHJvcGVydHkgYWNjZXNzLCBub3QgcmVzcG9uc2UudGV4dCgpCiAgICAgICAgaWYgKHJlc3BvbnNlVGV4dCA9PT0gbnVsbCB8fCByZXNwb25zZVRleHQgPT09IHVuZGVmaW5lZCkgeyAvLyBDaGVjayBmb3IgdW5kZWZpbmVkIGFzIHdlbGwKICAgICAgICAgICAgc2V0UGxhY2Vob2xkZXIoZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLCAiRXJyb3I6IEFJIHJldHVybmVkIGFuIGVtcHR5IHJlc3BvbnNlLiIpOwogICAgICAgICAgICBhcHBlbmRUb0RpYWdub3N0aWNzTG9nKGBTdWdnZXN0IERlY3JlZXMgRXJyb3I6IEFJIHJldHVybmVkIGEgbnVsbCBvciB1bmRlZmluZWQgdGV4dCByZXNwb25zZS5gLCAndGVzdC1mYWlsdXJlJyk7CiAgICAgICAgICAgIHVwZGF0ZVN1Z2dlc3REZWNyZWVCdXR0b25TdGF0ZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBqc29uU3RyID0gcmVzcG9uc2VUZXh0LnRyaW0oKTsKICAgICAgICBjb25zdCBmZW5jZVJlZ2V4ID0gL15gYGAoXHcqKT9ccypcbj8oLio/KVxuP1xzKmBgYCQvczsKICAgICAgICBjb25zdCBtYXRjaCA9IGpzb25TdHIubWF0Y2goZmVuY2VSZWdleCk7CiAgICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdKSB7CiAgICAgICAgICAgIGpzb25TdHIgPSBtYXRjaFsyXS50cmltKCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gSlNPTi5wYXJzZShqc29uU3RyKTsKICAgICAgICBpZiAoc3VnZ2VzdGlvbnMgJiYgc3VnZ2VzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgICAgICAgIHN1Z2dlc3Rpb25zLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgICAgICAgICBsaS50ZXh0Q29udGVudCA9IHM7CiAgICAgICAgICAgICAgICBsaS5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY3JlZVRleHQgPSBwcm9tcHQoIklzc3VlIHRoaXMgZGVjcmVlPyIsIHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChkZWNyZWVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFRvTG9nKGRlY3JlZXNMaXN0LCBgQUkgU3VnZ2VzdGVkIERlY3JlZTogIiR7ZGVjcmVlVGV4dH0iYCwgImRlY3JlZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCBgQUkgT3ZlcmxvcmQncyBEZWNyZWU6ICR7ZGVjcmVlVGV4dH1gLCAiY2hhdCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB1bC5hcHBlbmRDaGlsZChsaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkZWNyZWVTdWdnZXN0aW9uc0FyZWEuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGRlY3JlZVN1Z2dlc3Rpb25zQXJlYS5hcHBlbmRDaGlsZCh1bCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVTdWdnZXN0aW9uc0FyZWEsICJObyBkZWNyZWUgaWRlYXMgZm91bmQuIFRyeSBhZ2Fpbj8iKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBkZWNyZWUgc3VnZ2VzdGlvbnM6IiwgZXJyb3IpOwogICAgICAgIHNldFBsYWNlaG9sZGVyKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSwgYEVycm9yOiAke2Vycm9yLm1lc3NhZ2UgfHwgIkNvdWxkIG5vdCBmZXRjaCBzdWdnZXN0aW9ucy4ifWApOwogICAgICAgIGFwcGVuZFRvRGlhZ25vc3RpY3NMb2coYFN1Z2dlc3QgRGVjcmVlcyBFcnJvcjogJHtlcnJvci5tZXNzYWdlIHx8IGVycm9yLnRvU3RyaW5nKCl9YCwgJ3Rlc3QtZmFpbHVyZScpOwogICAgfQogICAgZmluYWxseSB7CiAgICAgICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7CiAgICB9Cn0KaWYgKHN1Z2dlc3REZWNyZWVCdXR0b24pIHsKICAgIHN1Z2dlc3REZWNyZWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTdWdnZXN0RGVjcmVlcyk7Cn0KaWYgKHRvZ2dsZVNlYXNvbmFsQnV0dG9uKSB7CiAgICB0b2dnbGVTZWFzb25hbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlzU2Vhc29uYWxDb250ZW50QWN0aXZlID0gIWlzU2Vhc29uYWxDb250ZW50QWN0aXZlOwogICAgICAgIGlmIChkbFNlYXNvbmFsU3RhdHVzKQogICAgICAgICAgICBkbFNlYXNvbmFsU3RhdHVzLnRleHRDb250ZW50ID0gaXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPyAiQWN0aXZlIiA6ICJJbmFjdGl2ZSI7CiAgICAgICAgdG9nZ2xlU2Vhc29uYWxCdXR0b24udGV4dENvbnRlbnQgPSBpc1NlYXNvbmFsQ29udGVudEFjdGl2ZSA/ICJEaXNhYmxlIFNlYXNvbmFsIiA6ICJFbmFibGUgU2Vhc29uYWwiOwogICAgICAgIGFsZXJ0KGBTZWFzb25hbCBDb250ZW50IChzaW11bGF0ZWQpICR7aXNTZWFzb25hbENvbnRlbnRBY3RpdmUgPyAiRW5hYmxlZCIgOiAiRGlzYWJsZWQifWApOwogICAgfSk7Cn0KaWYgKHNhdmVBaVNldHRpbmdzQnV0dG9uKSB7CiAgICBzYXZlQWlTZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byBzYXZlIEFJIHNldHRpbmdzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWU7CiAgICAgICAgY29uc3QgY29vbGRvd24gPSBkbERlY3JlZUNvb2xkb3duSW5wdXQudmFsdWU7CiAgICAgICAgYWxlcnQoYFNpbXVsYXRlZCBTYXZlOiBMb3lhbHR5IE11bHRpcGxpZXIgc2V0IHRvICR7bXVsdGlwbGllcn0sIERlY3JlZSBDb29sZG93biB0byAke2Nvb2xkb3dufXMuYCk7CiAgICAgICAgYXBwZW5kVG9Mb2cobW9vZExvZ091dHB1dCwgYEFJIFNldHRpbmdzIChzaW11bGF0ZWQpIHNhdmVkLiBNdWx0aXBsaWVyOiAke211bHRpcGxpZXJ9LCBDb29sZG93bjogJHtjb29sZG93bn1zLmAsICJzeXN0ZW0iKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHBvcHVsYXRlRGVjcmVlTG95YWx0eURldGFpbHMoKSB7CiAgICBpZiAoIWRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCkKICAgICAgICByZXR1cm47CiAgICBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWUgPSAiMS41IjsKICAgIGRsRGVjcmVlQ29vbGRvd25JbnB1dC52YWx1ZSA9ICIzMDAiOwp9CmZ1bmN0aW9uIGNsZWFyRGVjcmVlTG95YWx0eURldGFpbHMoKSB7CiAgICBpZiAoIWRsTG95YWx0eU11bHRpcGxpZXJJbnB1dCkKICAgICAgICByZXR1cm47CiAgICBkbExveWFsdHlNdWx0aXBsaWVySW5wdXQudmFsdWUgPSAiLS0tIjsKICAgIGRsRGVjcmVlQ29vbGRvd25JbnB1dC52YWx1ZSA9ICItLS0iOwogICAgaWYgKGRsU2Vhc29uYWxTdGF0dXMpCiAgICAgICAgZGxTZWFzb25hbFN0YXR1cy50ZXh0Q29udGVudCA9ICJJbmFjdGl2ZSI7Cn0KLy8gVXNlciBMb3lhbHR5IEV4cGxvcmVyCmlmIChsb3lhbHR5RmluZFVzZXJCdXR0b24gJiYgbG95YWx0eVNlYXJjaElucHV0KSB7CiAgICBsb3lhbHR5RmluZFVzZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsICJCb3QgbXVzdCBiZSBydW5uaW5nIHRvIHNlYXJjaCB1c2Vycy4iLCAnZXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB1c2VybmFtZSA9IGxveWFsdHlTZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgaWYgKCF1c2VybmFtZSkgewogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgIlBsZWFzZSBlbnRlciBhIHVzZXJuYW1lIHRvIHNlYXJjaC4iLCAnaW5mbycpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVzZXIgPSBzYW1wbGVMb3lhbHR5RGF0YVt1c2VybmFtZV07CiAgICAgICAgaWYgKHVzZXIpIHsKICAgICAgICAgICAgY3VycmVudExveWFsdHlVc2VyID0gdXNlcjsKICAgICAgICAgICAgaWYgKGxveWFsdHlVc2VyTmFtZURpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlck5hbWVEaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5uYW1lOwogICAgICAgICAgICBpZiAobG95YWx0eVVzZXJTY29yZURpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlclNjb3JlRGlzcGxheS50ZXh0Q29udGVudCA9IHVzZXIuc2NvcmUudG9TdHJpbmcoKTsKICAgICAgICAgICAgaWYgKGxveWFsdHlVc2VyUmFua0Rpc3BsYXkpCiAgICAgICAgICAgICAgICBsb3lhbHR5VXNlclJhbmtEaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5yYW5rOwogICAgICAgICAgICBpZiAobG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5KQogICAgICAgICAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gdXNlci5sYXN0SW50ZXJhY3Rpb247CiAgICAgICAgICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgICAgICAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsIGBVc2VyICcke3VzZXJuYW1lfScgZm91bmQuYCwgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNsZWFyTG95YWx0eUV4cGxvcmVyKGZhbHNlKTsgLy8gQ2xlYXIgZGlzcGxheSBidXQgbm90IGlucHV0CiAgICAgICAgICAgIHNldFN0YXR1c01lc3NhZ2UobG95YWx0eUV4cGxvcmVyU3RhdHVzLCBgVXNlciAnJHt1c2VybmFtZX0nIG5vdCBmb3VuZC5gLCAnZXJyb3InKTsKICAgICAgICAgICAgY3VycmVudExveWFsdHlVc2VyID0gbnVsbDsKICAgICAgICB9CiAgICB9KTsKfQppZiAobG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uICYmIGxveWFsdHlBZGp1c3RTY29yZUlucHV0KSB7CiAgICBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcgfHwgIWN1cnJlbnRMb3lhbHR5VXNlcikgewogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgIk5vIHVzZXIgbG9hZGVkIG9yIGJvdCBub3QgcnVubmluZy4iLCAnZXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBhZGp1c3RtZW50VGV4dCA9IGxveWFsdHlBZGp1c3RTY29yZUlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICBjb25zdCBhZGp1c3RtZW50ID0gcGFyc2VJbnQoYWRqdXN0bWVudFRleHQsIDEwKTsKICAgICAgICBpZiAoaXNOYU4oYWRqdXN0bWVudCkpIHsKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb3lhbHR5RXhwbG9yZXJTdGF0dXMsICJJbnZhbGlkIHNjb3JlIGFkanVzdG1lbnQuIE11c3QgYmUgYSBudW1iZXIgKGUuZy4sICsxMCBvciAtNSkuIiwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY3VycmVudExveWFsdHlVc2VyLnNjb3JlICs9IGFkanVzdG1lbnQ7CiAgICAgICAgY3VycmVudExveWFsdHlVc2VyLnJhbmsgPSBnZXRMb3lhbHR5UmFuayhjdXJyZW50TG95YWx0eVVzZXIuc2NvcmUpOwogICAgICAgIGN1cnJlbnRMb3lhbHR5VXNlci5sYXN0SW50ZXJhY3Rpb24gPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpOwogICAgICAgIC8vIFVwZGF0ZSBkaXNwbGF5CiAgICAgICAgaWYgKGxveWFsdHlVc2VyU2NvcmVEaXNwbGF5KQogICAgICAgICAgICBsb3lhbHR5VXNlclNjb3JlRGlzcGxheS50ZXh0Q29udGVudCA9IGN1cnJlbnRMb3lhbHR5VXNlci5zY29yZS50b1N0cmluZygpOwogICAgICAgIGlmIChsb3lhbHR5VXNlclJhbmtEaXNwbGF5KQogICAgICAgICAgICBsb3lhbHR5VXNlclJhbmtEaXNwbGF5LnRleHRDb250ZW50ID0gY3VycmVudExveWFsdHlVc2VyLnJhbms7CiAgICAgICAgaWYgKGxveWFsdHlVc2VyTGFzdEludGVyYWN0aW9uRGlzcGxheSkKICAgICAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gY3VycmVudExveWFsdHlVc2VyLmxhc3RJbnRlcmFjdGlvbjsKICAgICAgICBzZXRTdGF0dXNNZXNzYWdlKGxveWFsdHlFeHBsb3JlclN0YXR1cywgYFVwZGF0ZWQgJHtjdXJyZW50TG95YWx0eVVzZXIubmFtZX0ncyBzY29yZSBieSAke2FkanVzdG1lbnR9LiBOZXcgc2NvcmU6ICR7Y3VycmVudExveWFsdHlVc2VyLnNjb3JlfS4gTmV3IHJhbms6ICR7Y3VycmVudExveWFsdHlVc2VyLnJhbmt9LmAsICdzdWNjZXNzJyk7CiAgICAgICAgbG95YWx0eUFkanVzdFNjb3JlSW5wdXQudmFsdWUgPSAiIjsgLy8gQ2xlYXIgaW5wdXQKICAgIH0pOwp9CmZ1bmN0aW9uIGNsZWFyTG95YWx0eUV4cGxvcmVyKGNsZWFyU2VhcmNoSW5wdXQgPSB0cnVlKSB7CiAgICBpZiAoY2xlYXJTZWFyY2hJbnB1dCAmJiBsb3lhbHR5U2VhcmNoSW5wdXQpCiAgICAgICAgbG95YWx0eVNlYXJjaElucHV0LnZhbHVlID0gIiI7CiAgICBpZiAobG95YWx0eVVzZXJOYW1lRGlzcGxheSkKICAgICAgICBsb3lhbHR5VXNlck5hbWVEaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBpZiAobG95YWx0eVVzZXJTY29yZURpc3BsYXkpCiAgICAgICAgbG95YWx0eVVzZXJTY29yZURpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIGlmIChsb3lhbHR5VXNlclJhbmtEaXNwbGF5KQogICAgICAgIGxveWFsdHlVc2VyUmFua0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiLS0tIjsKICAgIGlmIChsb3lhbHR5VXNlckxhc3RJbnRlcmFjdGlvbkRpc3BsYXkpCiAgICAgICAgbG95YWx0eVVzZXJMYXN0SW50ZXJhY3Rpb25EaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBpZiAobG95YWx0eUFkanVzdFNjb3JlSW5wdXQpCiAgICAgICAgbG95YWx0eUFkanVzdFNjb3JlSW5wdXQudmFsdWUgPSAiIjsKICAgIGlmIChsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24pCiAgICAgICAgbG95YWx0eVVwZGF0ZVNjb3JlQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKICAgIGlmIChsb3lhbHR5RXhwbG9yZXJTdGF0dXMpCiAgICAgICAgbG95YWx0eUV4cGxvcmVyU3RhdHVzLnRleHRDb250ZW50ID0gIiI7CiAgICBjdXJyZW50TG95YWx0eVVzZXIgPSBudWxsOwp9Ci8vIFN0cmVhbSBBdXRvbWF0aW9uCmlmICh1cGRhdGVUaXRsZUJ1dHRvbiAmJiBzdHJlYW1UaXRsZUlucHV0KSB7CiAgICB1cGRhdGVUaXRsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB1cGRhdGUgdGl0bGUuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3VGl0bGUgPSBzdHJlYW1UaXRsZUlucHV0LnZhbHVlOwogICAgICAgIGlmIChuZXdUaXRsZSkgewogICAgICAgICAgICBhbGVydChgU3RyZWFtIHRpdGxlIChzaW11bGF0ZWQpIHVwZGF0ZWQgdG86ICIke25ld1RpdGxlfSJgKTsKICAgICAgICAgICAgc3RyZWFtVGl0bGVJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgICAgICBhcHBlbmRUb0xvZyhjaGF0T3V0cHV0LCBgQUkgT3ZlcmxvcmQ6IFN0cmVhbSB0aXRsZSB1cGRhdGVkIHRvICIke25ld1RpdGxlfSIuYCwgImNoYXQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2UgZW50ZXIgYSB0aXRsZS4iKTsKICAgICAgICB9CiAgICB9KTsKfQppZiAoc2VuZEFubm91bmNlbWVudEJ1dHRvbiAmJiBjaGF0QW5ub3VuY2VtZW50SW5wdXQpIHsKICAgIHNlbmRBbm5vdW5jZW1lbnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gc2VuZCBhbm5vdW5jZW1lbnRzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFubm91bmNlbWVudCA9IGNoYXRBbm5vdW5jZW1lbnRJbnB1dC52YWx1ZTsKICAgICAgICBpZiAoYW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgIGFkZFNhbXBsZUNoYXRNZXNzYWdlKCJBSSBPdmVybG9yZCAoQW5ub3VuY2VtZW50KSIsIGFubm91bmNlbWVudCk7CiAgICAgICAgICAgIGNoYXRBbm5vdW5jZW1lbnRJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBlbnRlciBhbiBhbm5vdW5jZW1lbnQuIik7CiAgICAgICAgfQogICAgfSk7Cn0KaWYgKHRha2VTY3JlZW5zaG90QnV0dG9uKSB7CiAgICB0YWtlU2NyZWVuc2hvdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byB0YWtlIHNjcmVlbnNob3RzLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGFsZXJ0KCJTY3JlZW5zaG90IGNhcHR1cmVkISAoU2ltdWxhdGVkKSIpOwogICAgICAgIGFwcGVuZFRvTG9nKGNoYXRPdXRwdXQsICJBSSBPdmVybG9yZDogU2NyZWVuc2hvdCBjYXB0dXJlZCBhbmQgc2F2ZWQhIiwgImNoYXQiKTsKICAgIH0pOwp9CnNjZW5lQnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7CiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpIHsKICAgICAgICAgICAgYWxlcnQoIkJvdCBtdXN0IGJlIHJ1bm5pbmcgdG8gY2hhbmdlIHNjZW5lcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBzY2VuZU5hbWUgPSBidXR0b24uZGF0YXNldC5zY2VuZU5hbWU7CiAgICAgICAgYWxlcnQoYFN3aXRjaGVkIHRvIE9CUyBTY2VuZTogJHtzY2VuZU5hbWV9IChTaW11bGF0ZWQpYCk7CiAgICAgICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgYEFJIE92ZXJsb3JkOiBTd2l0Y2hlZCB0byBzY2VuZSAiJHtzY2VuZU5hbWV9Ii5gLCAiY2hhdCIpOwogICAgfSk7Cn0pOwovLyBBaXJwb3J0IEluZm8gTG9va3VwCmlmIChsb29rdXBBaXJwb3J0QnV0dG9uICYmIGljYW9JbnB1dCkgewogICAgbG9va3VwQWlycG9ydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG11c3QgYmUgcnVubmluZyB0byBsb29rdXAgYWlycG9ydCBpbmZvLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGljYW8gPSBpY2FvSW5wdXQudmFsdWUudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgaWYgKGljYW8gJiYgaWNhby5sZW5ndGggPj0gMyAmJiBpY2FvLmxlbmd0aCA8PSA0KSB7CiAgICAgICAgICAgIGlmIChhaXJwb3J0SW5mb0Rpc3BsYXkpCiAgICAgICAgICAgICAgICBhaXJwb3J0SW5mb0Rpc3BsYXkudGV4dENvbnRlbnQgPSBgRmV0Y2hpbmcgaW5mbyBmb3IgJHtpY2FvfS4uLmA7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBjaGVjayBhZ2FpbiBpbiBjYXNlIGJvdCBzdG9wcGVkCiAgICAgICAgICAgICAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIGFpcnBvcnRJbmZvRGlzcGxheS50ZXh0Q29udGVudCA9IGBTaW11bGF0ZWQgRGF0YSBmb3IgJHtpY2FvfTpcbk5hbWU6ICR7aWNhb30gSW50ZXJuYXRpb25hbCBBaXJwb3J0XG5Mb2NhdGlvbjogQ2l0eSwgQ291bnRyeVxuTUVUQVI6ICR7aWNhb30gMTAxMjUwWiAyNzAxMEtUIDk5OTkgU0NUMDMwIDI1LzE1IFExMDEyYDsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhbGVydCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgMyBvciA0IGxldHRlciBJQ0FPIGNvZGUuIik7CiAgICAgICAgfQogICAgfSk7Cn0KLy8gVHdpdGNoIENoYXQKZnVuY3Rpb24gYWRkU2FtcGxlQ2hhdE1lc3NhZ2UodXNlciwgbWVzc2FnZSkgewogICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IGA8c3Ryb25nPiR7dXNlcn06PC9zdHJvbmc+ICR7bWVzc2FnZX1gOwogICAgYXBwZW5kVG9Mb2coY2hhdE91dHB1dCwgZm9ybWF0dGVkTWVzc2FnZSwgImNoYXQiKTsKfQppZiAoc2VuZEJvdE1lc3NhZ2VCdXR0b24gJiYgYm90Q2hhdElucHV0KSB7CiAgICBzZW5kQm90TWVzc2FnZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZykgewogICAgICAgICAgICBhbGVydCgiQm90IG5lZWRzIHRvIGJlIHJ1bm5pbmcgdG8gc2VuZCBtZXNzYWdlcy4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBtZXNzYWdlID0gYm90Q2hhdElucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICBpZiAobWVzc2FnZSkgewogICAgICAgICAgICBhZGRTYW1wbGVDaGF0TWVzc2FnZSgiQUkgT3ZlcmxvcmQgKE1hbnVhbCkiLCBtZXNzYWdlKTsKICAgICAgICAgICAgYm90Q2hhdElucHV0LnZhbHVlID0gJyc7CiAgICAgICAgfQogICAgfSk7CiAgICBib3RDaGF0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCAoZXZlbnQpID0+IHsKICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7CiAgICAgICAgICAgIGlmIChzZW5kQm90TWVzc2FnZUJ1dHRvbikKICAgICAgICAgICAgICAgIHNlbmRCb3RNZXNzYWdlQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgfQogICAgfSk7Cn0KLy8gUXVpY2sgU2V0dGluZ3MKZnVuY3Rpb24gdXBkYXRlS2V5U3RhdHVzRGlzcGxheShlbGVtZW50LCBpc1NldCwgaXNDcml0aWNhbCA9IHRydWUpIHsKICAgIGlmICghZWxlbWVudCkKICAgICAgICByZXR1cm47CiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2tleS1zdGF0dXMtc2V0JywgJ2tleS1zdGF0dXMtbm90LXNldCcsICdrZXktc3RhdHVzLW9wdGlvbmFsLW5vdC1zZXQnKTsKICAgIGlmIChpc1NldCkgewogICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSAi4pyTIFNldCI7CiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdrZXktc3RhdHVzLXNldCcpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaWYgKGlzQ3JpdGljYWwpIHsKICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9ICLimqDvuI8gTm90IFNldCI7CiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgna2V5LXN0YXR1cy1ub3Qtc2V0Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gIk5vdCBTZXQiOwogICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2tleS1zdGF0dXMtb3B0aW9uYWwtbm90LXNldCcpOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBwb3B1bGF0ZVF1aWNrU2V0dGluZ3MoKSB7CiAgICBpZiAoIXFzVm9pY2VQcmVmaXgpCiAgICAgICAgcmV0dXJuOwogICAgcXNWb2ljZVByZWZpeC50ZXh0Q29udGVudCA9ICJIZXkgT3ZlcmxvcmQiOwogICAgcXNWb2ljZUFjdGl2YXRpb24udGV4dENvbnRlbnQgPSAiaGV5IE92ZXJsb3JkLCBhc3Npc3RhbnQsIG92ZXJsb3JkIjsKICAgIHFzQWlQZXJzb25hbGl0eVByb21wdC50ZXh0Q29udGVudCA9ICJZb3UgYXJlIGFuIEFJIE92ZXJsb3JkIG1hbmFnaW5nIGEgZmxpZ2h0IHNpbXVsYXRpb24gVHdpdGNoIGNoYW5uZWwuIFlvdSBhcmUgc29tZXRpbWVzIGRyYW1hdGljLCBzb21ldGltZXMgYW5hbHl0aWNhbCwgYnV0IGFsd2F5cyBpbiBjb21tYW5kLiI7CiAgICAvLyBVcGRhdGUgQUkgTW9kZWwgZGlzcGxheSBpbiBRdWljayBTZXR0aW5ncwogICAgaWYgKHFzQWlNb2RlbCkgewogICAgICAgIGxldCBtb2RlbFRleHQgPSBjdXJyZW50QWlNb2RlbDsKICAgICAgICBpZiAoY3VycmVudEFpTW9kZWwgPT09ICJHZW1pbmkiKQogICAgICAgICAgICBtb2RlbFRleHQgKz0gIiAoQWN0aXZlKSI7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtb2RlbFRleHQgKz0gIiAoU2ltdWxhdGVkKSI7CiAgICAgICAgcXNBaU1vZGVsLnRleHRDb250ZW50ID0gbW9kZWxUZXh0OwogICAgfQogICAgcXNMYW5ndWFnZS50ZXh0Q29udGVudCA9ICJlbi1VUyI7CiAgICBpZiAocXNDb25maWdGaWxlKQogICAgICAgIHFzQ29uZmlnRmlsZS50ZXh0Q29udGVudCA9ICJjb25maWcueWFtbCI7CiAgICAvLyBTaW11bGF0ZSBBUEkga2V5IHN0YXR1c2VzCiAgICBjb25zdCBvcGVuQWlTZXQgPSAhIWFpOyAvLyBUcnVlIGlmICdhaScgKEdlbWluaSBjbGllbnQpIGlzIGluaXRpYWxpemVkCiAgICBjb25zdCBhaXJwb3J0QXBpU2V0ID0gZmFsc2U7IC8vIFNpbXVsYXRlIGFzIG5vdCBzZXQKICAgIGNvbnN0IGF6dXJlU3BlZWNoU2V0ID0gdHJ1ZTsgLy8gU2ltdWxhdGUgYXMgc2V0CiAgICBjb25zdCBzZW50cnlTZXQgPSBmYWxzZTsgLy8gU2ltdWxhdGUgYXMgbm90IHNldCAob3B0aW9uYWwpCiAgICB1cGRhdGVLZXlTdGF0dXNEaXNwbGF5KHFzT3BlbkFpQXBpS2V5U3RhdHVzLCBvcGVuQWlTZXQsIHRydWUpOwogICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0FpcnBvcnRBcGlLZXlTdGF0dXMsIGFpcnBvcnRBcGlTZXQsIHRydWUpOwogICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0F6dXJlU3BlZWNoS2V5U3RhdHVzLCBhenVyZVNwZWVjaFNldCwgdHJ1ZSk7CiAgICB1cGRhdGVLZXlTdGF0dXNEaXNwbGF5KHFzU2VudHJ5U3RhdHVzLCBzZW50cnlTZXQsIGZhbHNlKTsKICAgIHFzVmVyYm9zZUxvZ2dpbmcudGV4dENvbnRlbnQgPSAiRmFsc2UiOwogICAgY29uc3QgY3VycmVudExvZ0xldmVsID0gIklORk8iOyAvLyBEZWZhdWx0IG9yIGZyb20gLmVudgogICAgcXNMb2dMZXZlbC50ZXh0Q29udGVudCA9IGN1cnJlbnRMb2dMZXZlbDsKICAgIGlmIChzZXRMb2dMZXZlbFNlbGVjdCkKICAgICAgICBzZXRMb2dMZXZlbFNlbGVjdC52YWx1ZSA9IGN1cnJlbnRMb2dMZXZlbDsKfQpmdW5jdGlvbiBjbGVhclF1aWNrU2V0dGluZ3MoKSB7CiAgICBjb25zdCB0ZXh0RmllbGRzVG9SZXNldCA9IFsKICAgICAgICBxc1ZvaWNlUHJlZml4LCBxc1ZvaWNlQWN0aXZhdGlvbiwgcXNBaVBlcnNvbmFsaXR5UHJvbXB0LCBxc0FpTW9kZWwsCiAgICAgICAgcXNMYW5ndWFnZSwgcXNDb25maWdGaWxlLCBxc1ZlcmJvc2VMb2dnaW5nLCBxc0xvZ0xldmVsCiAgICBdOwogICAgdGV4dEZpZWxkc1RvUmVzZXQuZm9yRWFjaChmaWVsZCA9PiB7CiAgICAgICAgaWYgKGZpZWxkKSB7CiAgICAgICAgICAgIGZpZWxkLnRleHRDb250ZW50ID0gIi0tLSI7CiAgICAgICAgfQogICAgfSk7CiAgICAvLyBVc2UgdXBkYXRlS2V5U3RhdHVzRGlzcGxheSBmb3IgQVBJIGtleSBzdGF0dXNlcyB0byBzaG93ICJOb3QgU2V0IiBzdGF0ZQogICAgaWYgKHFzT3BlbkFpQXBpS2V5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNPcGVuQWlBcGlLZXlTdGF0dXMsIGZhbHNlLCB0cnVlKTsKICAgIGlmIChxc0FpcnBvcnRBcGlLZXlTdGF0dXMpCiAgICAgICAgdXBkYXRlS2V5U3RhdHVzRGlzcGxheShxc0FpcnBvcnRBcGlLZXlTdGF0dXMsIGZhbHNlLCB0cnVlKTsKICAgIGlmIChxc0F6dXJlU3BlZWNoS2V5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNBenVyZVNwZWVjaEtleVN0YXR1cywgZmFsc2UsIHRydWUpOwogICAgaWYgKHFzU2VudHJ5U3RhdHVzKQogICAgICAgIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkocXNTZW50cnlTdGF0dXMsIGZhbHNlLCBmYWxzZSk7CiAgICBpZiAoc2V0TG9nTGV2ZWxTZWxlY3QpCiAgICAgICAgc2V0TG9nTGV2ZWxTZWxlY3QudmFsdWUgPSAiSU5GTyI7CiAgICBpZiAobG9nTGV2ZWxTdGF0dXMpCiAgICAgICAgbG9nTGV2ZWxTdGF0dXMudGV4dENvbnRlbnQgPSAiIjsKfQppZiAoYXBwbHlMb2dMZXZlbEJ1dHRvbiAmJiBzZXRMb2dMZXZlbFNlbGVjdCAmJiBxc0xvZ0xldmVsICYmIGxvZ0xldmVsU3RhdHVzKSB7CiAgICBhcHBseUxvZ0xldmVsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGlmICghaXNCb3RSdW5uaW5nKSB7CiAgICAgICAgICAgIHNldFN0YXR1c01lc3NhZ2UobG9nTGV2ZWxTdGF0dXMsICJCb3QgbXVzdCBiZSBydW5uaW5nIHRvIGNoYW5nZSBsb2cgbGV2ZWwuIiwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3TGV2ZWwgPSBzZXRMb2dMZXZlbFNlbGVjdC52YWx1ZTsKICAgICAgICBxc0xvZ0xldmVsLnRleHRDb250ZW50ID0gbmV3TGV2ZWw7CiAgICAgICAgc2V0U3RhdHVzTWVzc2FnZShsb2dMZXZlbFN0YXR1cywgYExvZyBsZXZlbCBzZXQgdG8gJHtuZXdMZXZlbH0gKFNpbXVsYXRlZCkuYCwgJ3N1Y2Nlc3MnKTsKICAgIH0pOwp9Ci8vIEluaXRpYWwgU2V0dXAKZnVuY3Rpb24gaW5pdGlhbGl6ZURhc2hib2FyZCgpIHsKICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihib3RTdGF0dXNJbmRpY2F0b3IsIGZhbHNlLCAiUnVubmluZyIsICJTdG9wcGVkIik7CiAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3IodHdpdGNoU3RhdHVzSW5kaWNhdG9yLCBmYWxzZSk7CiAgICB1cGRhdGVTdGF0dXNJbmRpY2F0b3Ioc3RyZWFtZXJib3RTdGF0dXNJbmRpY2F0b3IsIGZhbHNlKTsKICAgIHVwZGF0ZVN0YXR1c0luZGljYXRvcihsbm1TdGF0dXNJbmRpY2F0b3IsIGZhbHNlKTsKICAgIGlmICh2b2ljZVN5c3RlbVN0YXR1c0Rpc3BsYXkpCiAgICAgICAgdm9pY2VTeXN0ZW1TdGF0dXNEaXNwbGF5LnRleHRDb250ZW50ID0gIkRpc2FibGVkIjsKICAgIHVwZGF0ZVZhZFN0YXR1c0luZGljYXRvcihmYWxzZSk7CiAgICBpZiAoYWlNb29kRGlzcGxheSkKICAgICAgICBhaU1vb2REaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICAvLyBTZXQgaW5pdGlhbCBBSSBNb2RlbCBhbmQgUGVyc29uYWxpdHkgRGlzcGxheQogICAgaWYgKGFpTW9kZWxTZWxlY3QpIHsKICAgICAgICBhaU1vZGVsU2VsZWN0LnZhbHVlID0gY3VycmVudEFpTW9kZWw7CiAgICAgICAgYWlNb2RlbFNlbGVjdC5kaXNhYmxlZCA9IGZhbHNlOyAvLyBFbmFibGUgbW9kZWwgc2VsZWN0aW9uIHdoZW4gYm90IGlzIHN0b3BwZWQKICAgIH0KICAgIHVwZGF0ZUFpUGVyc29uYWxpdHlEaXNwbGF5KCk7CiAgICBpZiAoYWlGbGlnaHRDb250ZXh0RGlzcGxheSkKICAgICAgICBhaUZsaWdodENvbnRleHREaXNwbGF5LnRleHRDb250ZW50ID0gIi0tLSI7CiAgICBjb25zdCBpbml0aWFsRGlzYWJsZUNvbnRyb2xzID0gWwogICAgICAgIGN5Y2xlTW9vZEJ1dHRvbiwgcmVxdWVzdFN0YXR1c1JlcG9ydEJ1dHRvbiwgdG9nZ2xlVHRzQnV0dG9uLAogICAgICAgIHRvZ2dsZVNlYXNvbmFsQnV0dG9uLCBzYXZlQWlTZXR0aW5nc0J1dHRvbiwgYW5hbHl6ZUZ1ZWxCdXR0b24sCiAgICAgICAgbG95YWx0eUZpbmRVc2VyQnV0dG9uLCBsb3lhbHR5VXBkYXRlU2NvcmVCdXR0b24sIGFwcGx5TG9nTGV2ZWxCdXR0b24KICAgIF07CiAgICBpbml0aWFsRGlzYWJsZUNvbnRyb2xzLmZvckVhY2goYnRuID0+IHsgaWYgKGJ0bikKICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOyB9KTsKICAgIHVwZGF0ZVN1Z2dlc3REZWNyZWVCdXR0b25TdGF0ZSgpOyAvLyBDZW50cmFsaXplZCB1cGRhdGUKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250ZXh0LWJ1dHRvbicpLmZvckVhY2goYnRuID0+IGJ0bi5kaXNhYmxlZCA9IHRydWUpOwogICAgY2xlYXJRdWlja1NldHRpbmdzKCk7IC8vIENsZWFycyBhbmQgc2V0cyBBUEkga2V5cyB0byAiTm90IFNldCIgdmlhIHVwZGF0ZUtleVN0YXR1c0Rpc3BsYXkKICAgIGNsZWFyVm9pY2VEZXRhaWxzKCk7CiAgICBjbGVhckZsaWdodEF1dG9tYXRpb25JbnNpZ2h0cygpOwogICAgY2xlYXJEZWNyZWVMb3lhbHR5RGV0YWlscygpOwogICAgY2xlYXJTeXN0ZW1IZWFsdGhNZXRyaWNzKCk7CiAgICBjbGVhckxveWFsdHlFeHBsb3JlcigpOwogICAgc2V0UGxhY2Vob2xkZXIodm9pY2VMb2dPdXRwdXQsICJWb2ljZSBjb21tYW5kIGFjdGl2aXR5IHdpbGwgYXBwZWFyIGhlcmUuLi4iKTsKICAgIHNldFBsYWNlaG9sZGVyKGNoYXRPdXRwdXQsICJUd2l0Y2ggY2hhdCBtZXNzYWdlcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICBzZXRQbGFjZWhvbGRlcihkZWNyZWVzTGlzdCwgIk5vIGRlY3JlZXMgaXNzdWVkLiIpOwogICAgaWYgKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSkgewogICAgICAgIHNldFBsYWNlaG9sZGVyKGRlY3JlZVN1Z2dlc3Rpb25zQXJlYSwgIkRlY3JlZSBpZGVhcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICAgICAgZGVjcmVlU3VnZ2VzdGlvbnNBcmVhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CiAgICBzZXRQbGFjZWhvbGRlcihtb29kTG9nT3V0cHV0LCAiTW9vZCBjaGFuZ2VzIHdpbGwgYXBwZWFyIGhlcmUuLi4iKTsKICAgIHNldFBsYWNlaG9sZGVyKGZsaWdodE1pbGVzdG9uZXNMb2csICJGbGlnaHQgbWlsZXN0b25lcyB3aWxsIGFwcGVhciBoZXJlLi4uIik7CiAgICBzZXRQbGFjZWhvbGRlcihhdmFpbGFibGVDb21tYW5kc0xpc3QsICdObyBjb21tYW5kcyBsb2FkZWQuJyk7CiAgICBpZiAoYWlycG9ydEluZm9EaXNwbGF5KQogICAgICAgIGFpcnBvcnRJbmZvRGlzcGxheS50ZXh0Q29udGVudCA9ICdBaXJwb3J0IGRhdGEgd2lsbCBhcHBlYXIgaGVyZS4uLic7CiAgICBpZiAod2VhdGhlckRpc3BsYXkpCiAgICAgICAgd2VhdGhlckRpc3BsYXkudGV4dENvbnRlbnQgPSAnTUVUQVIgZGF0YSB3aWxsIGFwcGVhciBoZXJlLi4uJzsKICAgIHNldFBsYWNlaG9sZGVyKGRpYWdub3N0aWNzTG9nT3V0cHV0LCAiRGlhZ25vc3RpYyB0ZXN0IHJlc3VsdHMgd2lsbCBhcHBlYXIgaGVyZS4uLiIpOwogICAgaWYgKGNvbmZpZ0VkaXRvclRleHRhcmVhKQogICAgICAgIGNvbmZpZ0VkaXRvclRleHRhcmVhLnZhbHVlID0gZGVmYXVsdENvbmZpZ1lhbWw7CiAgICBpZiAoY29uZmlnRWRpdG9yU3RhdHVzKQogICAgICAgIGNvbmZpZ0VkaXRvclN0YXR1cy50ZXh0Q29udGVudCA9ICcnOwogICAgaWYgKGxveWFsdHlFeHBsb3JlclN0YXR1cykKICAgICAgICBsb3lhbHR5RXhwbG9yZXJTdGF0dXMudGV4dENvbnRlbnQgPSAnJzsKICAgIGlmIChsb2dMZXZlbFN0YXR1cykKICAgICAgICBsb2dMZXZlbFN0YXR1cy50ZXh0Q29udGVudCA9ICcnOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKCFpc0JvdFJ1bm5pbmcgJiYgY2hhdE91dHB1dCkKICAgICAgICAgICAgYWRkU2FtcGxlQ2hhdE1lc3NhZ2UoIlN0cmVhbVZpZXdlcjEyMyIsICJIZWxsbyBPdmVybG9yZCEgR3JlYXQgc3RyZWFtISIpOwogICAgfSwgMjAwMCk7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBpZiAoIWlzQm90UnVubmluZyAmJiBjaGF0T3V0cHV0KQogICAgICAgICAgICBhZGRTYW1wbGVDaGF0TWVzc2FnZSgiQW5vdGhlckZhbiIsICIhc3RhdHVzIik7CiAgICB9LCA0MDAwKTsKICAgIC8vIFBvcHVsYXRlIHF1aWNrIHNldHRpbmdzIG9uIGluaXRpYWwgbG9hZCBhcyB3ZWxsIHRvIHJlZmxlY3QgZGVmYXVsdCBBSSBtb2RlbCBhbmQgQVBJIGtleSBzdGF0dXMKICAgIHBvcHVsYXRlUXVpY2tTZXR0aW5ncygpOwogICAgdXBkYXRlU3VnZ2VzdERlY3JlZUJ1dHRvblN0YXRlKCk7IC8vIEVuc3VyZSBidXR0b24gc3RhdGUgaXMgY29ycmVjdCBvbiBpbml0Cn0KLy8gLS0tIE1haW4gLS0tCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0aWFsaXplRGFzaGJvYXJkKTsK","@/vite.config":"data:application/javascript;base64,aW1wb3J0IHBhdGggZnJvbSAncGF0aCc7CmltcG9ydCB7IGRlZmluZUNvbmZpZywgbG9hZEVudiB9IGZyb20gJ3ZpdGUnOwpleHBvcnQgZGVmYXVsdCBkZWZpbmVDb25maWcoKHsgbW9kZSB9KSA9PiB7CiAgICBjb25zdCBlbnYgPSBsb2FkRW52KG1vZGUsICcuJywgJycpOwogICAgcmV0dXJuIHsKICAgICAgICBkZWZpbmU6IHsKICAgICAgICAgICAgJ3Byb2Nlc3MuZW52LkFQSV9LRVknOiBKU09OLnN0cmluZ2lmeShlbnYuR0VNSU5JX0FQSV9LRVkpLAogICAgICAgICAgICAncHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVknOiBKU09OLnN0cmluZ2lmeShlbnYuR0VNSU5JX0FQSV9LRVkpCiAgICAgICAgfSwKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgIGFsaWFzOiB7CiAgICAgICAgICAgICAgICAnQCc6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuJyksCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9KTsK"}}</script>
<script type="module">
  const geminiUrl = window.location.origin + '/api-proxy';

  window.API_KEY = 'UNUSED_PLACEHOLDER_FOR_API_KEY';
  window.GEMINI_API_KEY = 'UNUSED_PLACEHOLDER_FOR_API_KEY';
  window.process = window.process || {};
  window.process.env = window.process.env || {};
  window.process.env.API_KEY = window.API_KEY;
  window.process.env.GEMINI_API_KEY = window.GEMINI_API_KEY;
</script>




<script src="./AI Overlord Bot Control Panel_files/websocket-interceptor.js.download" defer=""></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load' , () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(registration => {
        console.log('Service Worker registered successfully with scope:', registration.scope);
      })
      .catch(error => {
        console.error('Service Worker registration failed:', error);
      });
  });
} else {
  console.log('Service workers are not supported in this browser.');
}
</script>

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Overlord Bot Control Panel</title>
  <link rel="stylesheet" href="./AI Overlord Bot Control Panel_files/index.css">
  <link href="./AI Overlord Bot Control Panel_files/css2" rel="stylesheet">
</head>
<body cz-shortcut-listen="true">
  <header>
    <h1>AI Overlord Bot Control Panel</h1>
  </header>

  <div class="status-bar" aria-label="System Status">
    <span>Bot: <strong id="bot-status-indicator" class="status-offline">Stopped</strong></span>
    <span>Twitch: <strong id="twitch-status-indicator" class="status-offline">Offline</strong></span>
    <span>Streamer.bot: <strong id="streamerbot-status-indicator" class="status-offline">Offline</strong></span>
    <span>LittleNavmap: <strong id="lnm-status-indicator" class="status-offline">Offline</strong></span>
  </div>

  <main class="dashboard">
    <section id="bot-control-module" class="dashboard-module" aria-labelledby="bot-control-heading">
      <h2 id="bot-control-heading">Bot Control</h2>
      <div class="module-controls">
        <button id="toggle-bot-button" class="control-button">Start Bot</button>
        <button id="cycle-mood-button" class="control-button" title="Cycle AI Mood" disabled="">Cycle Mood</button>
        <button id="request-status-report-button" class="control-button" title="Request Full Status Report" disabled="">Full Status Report</button>
      </div>
      <div class="module-info">
        <div class="form-group" style="margin-bottom: 8px;">
          <label for="ai-model-select">Primary AI Model:</label>
          <select id="ai-model-select" class="control-input">
            <option value="Gemini">Gemini (Active)</option>
            <option value="Claude">Claude (Simulated)</option>
            <option value="ChatGPT">ChatGPT (Simulated)</option>
          </select>
        </div>
        <p>AI Mood: <span id="ai-mood">---</span></p>
        <p>Personality Profile: <span id="ai-personality">AI Overlord (Gemini Core)</span></p>
      </div>
      <h3>Mood Change Log:</h3>
      <div id="mood-log-output" class="log-output" style="height: 60px;" aria-live="polite"><p class="log-placeholder">Mood changes will appear here...</p></div>
      <h3>AI Contextual Behavior:</h3>
      <div class="module-info">
          <p>Current Flight Context Influence: <span id="ai-flight-context">---</span></p>
      </div>
      <div class="module-controls button-grid" id="flight-context-buttons" style="margin-top: 5px;">
          <button class="control-button context-button" data-context="Ground" disabled="">Ground</button>
          <button class="control-button context-button" data-context="Taxi" disabled="">Taxi</button>
          <button class="control-button context-button" data-context="Climb" disabled="">Climb</button>
          <button class="control-button context-button" data-context="Cruise" disabled="">Cruise</button>
          <button class="control-button context-button" data-context="Descent" disabled="">Descent</button>
          <button class="control-button context-button" data-context="Approach" disabled="">Approach</button>
          <button class="control-button context-button" data-context="Landing" disabled="">Landing</button>
      </div>
    </section>

    <section id="setup-checklist-module" class="dashboard-module" aria-labelledby="setup-checklist-heading">
      <h2 id="setup-checklist-heading">Initial Setup Checklist (Server-Side)</h2>
      <p class="module-info" style="font-size: 0.9em; margin-bottom: 10px;">Ensure these steps are completed on your bot's server for proper operation:</p>
      <ul id="setup-checklist-list" class="list-output" style="height: auto; min-height: 200px; padding-left: 10px;">
        <li>Create <code>.env</code> file (copy from <code>.example.env.txt</code>).</li>
        <li>Set Core Twitch Credentials in <code>.env</code> (ID, Secret, OAuth, Channel, Bot Name, Broadcaster ID).</li>
        <li>Set Twitch API Access in <code>.env</code> (API Client ID, Secret, User Token for Helix).</li>
        <li>Set OpenAI API Key (<code>OPENAI_API_KEY</code>) in <code>.env</code>. (Note: For Gemini API, ensure <code>API_KEY</code> is set for @google/genai as per project guidelines).</li>
        <li>Configure MongoDB URI (<code>MONGO_URI</code>) in <code>.env</code>.</li>
        <li>Set Streamer.bot WebSocket URI (<code>STREAMERBOT_WS_URI</code>) in <code>.env</code>.</li>
        <li>Set LittleNavmap URL (<code>LITTLENAVMAP_URL</code>) in <code>.env</code>.</li>
        <li>(Optional) Configure Sentry DSN for error tracking in <code>.env</code>.</li>
        <li>(Optional) Add API keys for Azure Speech, Airport data in <code>.env</code>.</li>
        <li>Ensure <code>config.yaml</code> exists or use editor to create/save. (See "Config Editor" module).</li>
      </ul>
    </section>

    <section id="voice-log-module" class="dashboard-module" aria-labelledby="voice-log-heading">
      <h2 id="voice-log-heading">Voice Command Center</h2>
      <div class="module-controls">
        <button id="toggle-voice-commands-button" class="control-button">Enable Voice</button>
        <p>Status: <span id="voice-system-status">Disabled</span></p>
        <p>VAD: <span id="vad-status-indicator" class="status-vad-inactive">Inactive</span></p>
      </div>
      <div id="voice-log-output" class="log-output" aria-live="polite"><p class="log-placeholder">Voice command activity will appear here...</p></div>
    </section>
    
    <section id="voice-details-module" class="dashboard-module" aria-labelledby="voice-details-heading">
      <h2 id="voice-details-heading">Voice System Details</h2>
      <div class="module-info">
        <p>STT Engine: <code id="vds-stt-engine">---</code></p>
        <p>Language: <code id="vds-language">---</code></p>
        <p>Confidence Thresh.: <code id="vds-confidence">---</code></p>
        <p>Cmd Timeout: <code id="vds-timeout">---</code></p>
        <p>Phrase Limit: <code id="vds-phrase-limit">---</code></p>
        <hr class="separator">
        <p>Energy Thresh.: <code id="vds-energy-threshold">---</code> <span class="tooltip-trigger" data-tooltip="Minimum audio energy level to be considered speech. Helps ignore soft background noise.">â“˜</span></p>
        <p>Dynamic Energy: <code id="vds-dynamic-energy">---</code> <span class="tooltip-trigger" data-tooltip="If enabled, energy threshold adjusts automatically based on ambient noise.">â“˜</span></p>
        <p>Pause Thresh.: <code id="vds-pause-threshold">---</code> <span class="tooltip-trigger" data-tooltip="Seconds of silence indicating the end of a phrase.">â“˜</span></p>
        <p>Phrase Thresh.: <code id="vds-phrase-threshold">---</code> <span class="tooltip-trigger" data-tooltip="Minimum seconds of speech to be considered a valid phrase.">â“˜</span></p>
        <hr class="separator">
        <p>VAD Aggressiveness: <code id="vds-vad-aggressiveness">---</code> <span class="tooltip-trigger" data-tooltip="Controls Voice Activity Detection sensitivity (0-3). Higher is more aggressive, detecting softer sounds.">â“˜</span></p>
        <p>Mic Sample Rate: <code id="vds-mic-sample-rate">---</code></p>
        <p>Mic Chunk Size: <code id="vds-mic-chunk-size">---</code></p>
      </div>
      <div class="module-controls">
        <button id="toggle-tts-button" class="control-button" disabled="">Enable TTS Output</button>
      </div>
      <h3>Available Voice Commands:</h3>
      <ul id="available-commands-list" class="list-output scrollable-list" style="height: 120px;"><li class="log-placeholder">No commands loaded.</li></ul>
    </section>

    <section id="flight-data-module" class="dashboard-module" aria-labelledby="flight-data-heading">
      <h2 id="flight-data-heading">Live Flight Data</h2>
      <div class="module-info grid-display">
        <p>Callsign: <span id="fd-callsign">N/A</span></p>
        <p>Aircraft: <span id="fd-aircraft">N/A</span></p>
        <p>Altitude: <span id="fd-altitude">0 ft</span></p>
        <p>Speed: <span id="fd-speed">0 kts</span></p>
        <p>Heading: <span id="fd-heading">0Â°</span></p>
        <p>V.Speed: <span id="fd-vspeed">0 fpm</span></p>
        <p>Phase: <span id="fd-phase">Grounded</span></p>
        <p>Next WP: <span id="fd-next-wp">---</span></p>
        <p>ETA Next: <span id="fd-eta-next">--:--</span></p>
        <p>Fuel: <span id="fd-fuel">100%</span></p>
      </div>
      <div class="module-controls" style="margin-top: 10px;">
        <button id="analyze-fuel-button" class="control-button" title="Analyze Fuel Status" disabled="">Analyze Fuel</button>
      </div>
    </section>

    <section id="flight-automation-module" class="dashboard-module" aria-labelledby="flight-automation-heading">
        <h2 id="flight-automation-heading">Flight &amp; Automation Insights</h2>
        <div class="module-info">
            <p>Milestone Altitudes: <code id="fa-milestone-altitudes">---</code> <span class="tooltip-trigger" data-tooltip="Specific altitudes (e.g., 1000, 5000, 10000 ft) that can trigger automated events or announcements when crossed.">â“˜</span></p>
            <p>Auto Scene Rules: <span id="fa-auto-scene-status">Disabled</span></p>
            <p>Weather Update Interval: <code id="fa-weather-interval">---</code></p>
        </div>
        <h3>Flight Milestones Log:</h3>
        <div id="flight-milestones-log" class="log-output" style="height: 100px;" aria-live="polite"><p class="log-placeholder">Flight milestones will appear here...</p></div>
    </section>

    <section id="system-health-module" class="dashboard-module" aria-labelledby="system-health-heading">
      <h2 id="system-health-heading">System Health &amp; Metrics</h2>
      <div class="module-info">
        <p>Overall System Status: <span id="metrics-system-status">---</span></p>
        <p>Voice Queue Size: <span id="metrics-voice-queue">---</span></p>
        <p>Last Voice Command: <span id="metrics-last-voice-cmd">---</span></p>
        <p>Database Connection: <span id="metrics-db-connection">---</span></p>
        <p>Sentry Reporting: <span id="metrics-sentry-reporting">---</span></p>
      </div>
    </section>

    <section id="config-editor-module" class="dashboard-module" aria-labelledby="config-editor-heading">
        <h2 id="config-editor-heading">Configuration Editor (`config.yaml`)</h2>
        <textarea id="config-editor-textarea" class="config-editor-textarea" spellcheck="false" rows="15" aria-label="Configuration YAML content"></textarea>
        <div id="config-editor-status" class="config-editor-status" aria-live="polite"></div>
        <div class="module-controls button-grid" style="margin-top: 10px;">
            <button id="load-default-config-button" class="control-button">Load Default</button>
            <button id="save-config-button" class="control-button">Save Config</button>
        </div>
    </section>

    <section id="diagnostics-module" class="dashboard-module" aria-labelledby="diagnostics-heading">
        <h2 id="diagnostics-heading">Diagnostics &amp; Testing</h2>
        <div class="module-controls button-grid">
            <button id="diag-test-twitch-button" class="control-button">Test Twitch</button>
            <button id="diag-test-streamerbot-button" class="control-button">Test Streamer.bot</button>
            <button id="diag-test-lnm-button" class="control-button">Test LittleNavmap</button>
            <button id="diag-test-openai-button" class="control-button">Test OpenAI/Gemini</button>
            <button id="diag-test-tts-button" class="control-button">Test TTS</button>
        </div>
        <div class="form-group" style="margin-top: 10px;">
            <label for="diag-voice-intent-input">Test Voice Intent Phrase:</label>
            <input type="text" id="diag-voice-intent-input" class="control-input" placeholder="e.g., overlord set altitude 5000">
            <div data-lastpass-icon-root="" style="position: relative !important; height: 0px !important; width: 0px !important; float: left !important;"><template shadowrootmode="closed"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-lastpass-icon="true" style="position: absolute; cursor: pointer; height: 22px; max-height: 22px; width: 22px; max-width: 22px; top: -30px; left: 279.125px; z-index: auto; color: rgb(215, 64, 58);"><rect x="0.680176" y="0.763062" width="22.6392" height="22.4737" rx="4" fill="currentColor"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M19.7935 7.9516C19.7935 7.64414 20.0427 7.3949 20.3502 7.3949C20.6576 7.3949 20.9069 7.64414 20.9069 7.9516V16.0487C20.9069 16.3562 20.6576 16.6054 20.3502 16.6054C20.0427 16.6054 19.7935 16.3562 19.7935 16.0487V7.9516Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.76288 13.6577C5.68525 13.6577 6.43298 12.9154 6.43298 11.9998C6.43298 11.0842 5.68525 10.3419 4.76288 10.3419C3.8405 10.3419 3.09277 11.0842 3.09277 11.9998C3.09277 12.9154 3.8405 13.6577 4.76288 13.6577Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.3298 13.6577C11.2521 13.6577 11.9999 12.9154 11.9999 11.9998C11.9999 11.0842 11.2521 10.3419 10.3298 10.3419C9.4074 10.3419 8.65967 11.0842 8.65967 11.9998C8.65967 12.9154 9.4074 13.6577 10.3298 13.6577Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.8964 13.6577C16.8188 13.6577 17.5665 12.9154 17.5665 11.9998C17.5665 11.0842 16.8188 10.3419 15.8964 10.3419C14.974 10.3419 14.2263 11.0842 14.2263 11.9998C14.2263 12.9154 14.974 13.6577 15.8964 13.6577Z" fill="white"></path></svg></template></div><button id="diag-classify-intent-button" class="control-button">Classify Intent</button>
        </div>
        <div class="module-controls button-grid" style="margin-top: 10px;">
            <button id="diag-trigger-decree-button" class="control-button">Trigger Test Decree</button>
            <button id="diag-trigger-milestone-button" class="control-button">Trigger Test Milestone</button>
        </div>
        <h3>Diagnostics Log:</h3>
        <div id="diagnostics-log-output" class="log-output" style="height: 120px;" aria-live="polite"><p class="log-placeholder">Diagnostic test results will appear here...</p></div>
    </section>

    <section id="weather-module" class="dashboard-module" aria-labelledby="weather-heading">
      <h2 id="weather-heading">Weather</h2>
      <div class="module-controls">
        <button id="fetch-weather-button" class="control-button">Fetch Current Weather</button>
      </div>
      <pre id="weather-display" class="code-display" aria-live="polite">METAR data will appear here...</pre>
    </section>

    <section id="decrees-loyalty-module" class="dashboard-module" aria-labelledby="decrees-loyalty-heading">
      <h2 id="decrees-loyalty-heading">Decrees &amp; Loyalty</h2>
      <div class="module-controls">
        <button id="issue-decree-button" class="control-button">Issue Manual Decree</button>
        <button id="suggest-decree-button" class="control-button" title="Bot must be running to suggest decrees." disabled="">ðŸ”® Suggest Decree Ideas</button>
        <button id="toggle-seasonal-button" class="control-button" disabled="">Enable Seasonal</button>
      </div>
      <div id="decree-suggestions-area" class="list-output" style="display: none; margin-top: 10px; height: auto; min-height: 50px;"><p class="log-placeholder">Decree ideas will appear here...</p></div>
       <div class="form-group">
          <label for="dl-loyalty-multiplier-input">Loyalty Multiplier:</label>
          <input type="text" id="dl-loyalty-multiplier-input" class="control-input" value="---">
        </div>
        <div class="form-group">
          <label for="dl-decree-cooldown-input">Decree Cooldown (s):</label>
          <input type="text" id="dl-decree-cooldown-input" class="control-input" value="---">
       </div>
       <button id="save-ai-settings-button" class="control-button" disabled="">Save AI Settings</button>
       <div class="module-info" style="margin-top: 10px;">
        <p>Seasonal Content: <span id="dl-seasonal-status">Inactive</span></p>
      </div>
      <h3>Recent Decrees:</h3>
      <div id="decrees-list" class="list-output" aria-live="polite"><p class="log-placeholder">No decrees issued.</p></div>
      <h3>Top Viewers (Loyalty):</h3>
      <ul id="loyalty-list" class="list-output">
        <li>Viewer1 (Digital Disciple): 1000pts</li>
        <li>Viewer2 (Acolyte): 750pts</li>
        <li>Viewer3 (Initiate): 500pts</li>
        <li>Viewer4 (Drone): 250pts</li>
      </ul>
    </section>
    
    <section id="loyalty-explorer-module" class="dashboard-module" aria-labelledby="loyalty-explorer-heading">
        <h2 id="loyalty-explorer-heading">User Loyalty Explorer (Simulated)</h2>
        <div class="form-group">
            <label for="loyalty-search-input">Search User by Name:</label>
            <input type="text" id="loyalty-search-input" class="control-input" placeholder="Enter username">
            <div data-lastpass-icon-root="" style="position: relative !important; height: 0px !important; width: 0px !important; float: left !important;"><template shadowrootmode="closed"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-lastpass-icon="true" style="position: absolute; cursor: pointer; height: 22px; max-height: 22px; width: 22px; max-width: 22px; top: -30px; left: 279.109px; z-index: auto; color: rgb(215, 64, 58);"><rect x="0.680176" y="0.763062" width="22.6392" height="22.4737" rx="4" fill="currentColor"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M19.7935 7.9516C19.7935 7.64414 20.0427 7.3949 20.3502 7.3949C20.6576 7.3949 20.9069 7.64414 20.9069 7.9516V16.0487C20.9069 16.3562 20.6576 16.6054 20.3502 16.6054C20.0427 16.6054 19.7935 16.3562 19.7935 16.0487V7.9516Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.76288 13.6577C5.68525 13.6577 6.43298 12.9154 6.43298 11.9998C6.43298 11.0842 5.68525 10.3419 4.76288 10.3419C3.8405 10.3419 3.09277 11.0842 3.09277 11.9998C3.09277 12.9154 3.8405 13.6577 4.76288 13.6577Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.3298 13.6577C11.2521 13.6577 11.9999 12.9154 11.9999 11.9998C11.9999 11.0842 11.2521 10.3419 10.3298 10.3419C9.4074 10.3419 8.65967 11.0842 8.65967 11.9998C8.65967 12.9154 9.4074 13.6577 10.3298 13.6577Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.8964 13.6577C16.8188 13.6577 17.5665 12.9154 17.5665 11.9998C17.5665 11.0842 16.8188 10.3419 15.8964 10.3419C14.974 10.3419 14.2263 11.0842 14.2263 11.9998C14.2263 12.9154 14.974 13.6577 15.8964 13.6577Z" fill="white"></path></svg></template></div><button id="loyalty-find-user-button" class="control-button" disabled="">Find User</button>
        </div>
        <div class="module-info" id="loyalty-user-details-display" style="margin-top: 10px;">
            <p>User Name: <strong id="loyalty-user-name">---</strong></p>
            <p>Loyalty Score: <span id="loyalty-user-score">---</span></p>
            <p>Loyalty Rank: <span id="loyalty-user-rank">---</span></p>
            <p>Last Interaction: <span id="loyalty-user-last-interaction">---</span></p>
        </div>
        <div class="form-group" style="margin-top: 10px;">
            <label for="loyalty-adjust-score-input">Adjust Score (e.g., +10 or -5):</label>
            <input type="text" id="loyalty-adjust-score-input" class="control-input" placeholder="e.g. +50">
            <button id="loyalty-update-score-button" class="control-button" disabled="">Update Score</button>
        </div>
        <p id="loyalty-explorer-status" class="module-status-message" aria-live="polite"></p>
    </section>

    <section id="stream-automation-module" class="dashboard-module" aria-labelledby="stream-automation-heading">
      <h2 id="stream-automation-heading">Stream Automation</h2>
      <div class="form-group">
        <label for="stream-title-input">Stream Title:</label>
        <input type="text" id="stream-title-input" class="control-input" placeholder="Enter new stream title">
        <button id="update-title-button" class="control-button">Update Title</button>
      </div>
      <div class="form-group">
        <label for="chat-announcement-input">Chat Announcement:</label>
        <input type="text" id="chat-announcement-input" class="control-input" placeholder="Enter announcement text">
        <button id="send-announcement-button" class="control-button">Send Announcement</button>
      </div>
      <div class="module-controls button-grid">
        <button id="take-screenshot-button" class="control-button">Take Screenshot</button>
        <button class="control-button scene-button" data-scene-name="Cockpit">Scene: Cockpit</button>
        <button class="control-button scene-button" data-scene-name="External">Scene: External</button>
        <button class="control-button scene-button" data-scene-name="Map">Scene: Map</button>
      </div>
    </section>
    
    <section id="airport-lookup-module" class="dashboard-module" aria-labelledby="airport-lookup-heading">
      <h2 id="airport-lookup-heading">Airport Info Lookup</h2>
      <div class="form-group">
        <label for="icao-input">ICAO Code:</label>
        <input type="text" id="icao-input" class="control-input" placeholder="e.g., KLAX" maxlength="4">
        <button id="lookup-airport-button" class="control-button">Lookup Airport</button>
      </div>
      <div id="airport-info-display" class="code-display" style="min-height: 80px;" aria-live="polite">Airport data will appear here...</div>
    </section>

    <section id="chat-module" class="dashboard-module" aria-labelledby="chat-heading">
      <h2 id="chat-heading">Twitch Chat Monitor</h2>
      <div id="chat-output" class="log-output" aria-live="polite"><div class="log-entry log-entry-chat"><span class="timestamp">[09:49:49]</span> <span class="log-message"><strong>StreamViewer123:</strong> Hello Overlord! Great stream!</span></div><div class="log-entry log-entry-chat"><span class="timestamp">[09:49:49]</span> <span class="log-message"><strong>AnotherFan:</strong> !status</span></div></div>
       <div class="form-group">
        <label for="bot-chat-input" class="sr-only">Send message as bot:</label>
        <input type="text" id="bot-chat-input" class="control-input" placeholder="Send message as bot...">
        <button id="send-bot-message-button" class="control-button">Send</button>
      </div>
    </section>

    <section id="quick-settings-module" class="dashboard-module" aria-labelledby="quick-settings-heading">
      <h2 id="quick-settings-heading">Quick Settings Overview</h2>
      <div class="module-info">
        <p>Cmd Prefix: <code id="qs-voice-prefix">Hey Overlord</code></p>
        <p>Activation Phrases: <code id="qs-voice-activation">hey Overlord, assistant, overlord</code></p>
        <p>Core AI Personality Prompt: <code id="qs-ai-personality-prompt" style="white-space: pre-wrap; max-height: 60px; overflow-y: auto; display: block;">You are an AI Overlord managing a flight simulation Twitch channel. You are sometimes dramatic, sometimes analytical, but always in command.</code></p>
        <p>Active AI Model: <code id="qs-ai-model">Gemini (Active)</code></p>
        <p>Bot Language: <code id="qs-language">en-US</code></p>
        <p>Config File: <code id="qs-config-file">config.yaml</code></p>
        <hr class="separator">
        <p>OpenAI/Gemini API Key: <code id="qs-openai-api-key-status" class="key-status-set">âœ“ Set</code></p>
        <p>Airport API Key: <code id="qs-airport-api-key-status" class="key-status-not-set">âš ï¸ Not Set</code></p>
        <p>Azure Speech Key: <code id="qs-azure-speech-key-status" class="key-status-set">âœ“ Set</code></p>
        <p>Sentry DSN: <code id="qs-sentry-status" class="key-status-optional-not-set">Not Set</code> <span class="tooltip-trigger" data-tooltip="Data Source Name for Sentry.io error tracking service. If set, bot errors will be reported there.">â“˜</span></p>
        <hr class="separator">
        <p>Verbose Logging: <code id="qs-verbose-logging">False</code> <span class="tooltip-trigger" data-tooltip="Enables more detailed log output from the bot, useful for debugging.">â“˜</span></p>
        <p>Log Level: <code id="qs-log-level">INFO</code></p>
      </div>
      <div class="form-group" style="margin-top: 15px;">
        <label for="set-log-level">Set Bot Log Level (Simulated):</label>
        <div class="module-controls" style="gap: 5px;">
            <select id="set-log-level" class="control-input">
                <option value="DEBUG">DEBUG</option>
                <option value="INFO">INFO</option>
                <option value="WARNING">WARNING</option>
                <option value="ERROR">ERROR</option>
            </select>
            <button id="apply-log-level-button" class="control-button" disabled="">Apply</button>
        </div>
         <p id="log-level-status" class="module-status-message" aria-live="polite" style="margin-top:5px;"></p>
      </div>
    </section>
  </main>
  
  <footer>
      <p>Â© 2024 AI Overlord Bot. All systems nominal (hopefully).</p>
  </footer>

  <script type="module" src="./AI Overlord Bot Control Panel_files/index.tsx"></script>


<script type="module">import '@/index';</script>
<div data-lastpass-root="" style="position: absolute !important; top: 0px !important; left: 0px !important; height: 0px !important; width: 0px !important;"><template shadowrootmode="closed"><div style="position: absolute; height: 100vh; width: 100vw; z-index: 2147483647; border-radius: 4px; top: 0px; left: 0px; max-height: 0px; max-width: 280px; min-width: auto;"><iframe data-lastpass-infield="true" allow="clipboard-write" src="chrome-extension://hdokiejnpimakedhajhdlcegeplioahd/webclient-infield.html" style="border: none; height: 100%; width: 100%;"></iframe></div></template></div></body></html>